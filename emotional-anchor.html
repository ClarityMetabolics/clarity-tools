<!--
  ============================================================
  Clarity Metabolics - Emotional Anchor: The Stability Well
  Interactive Web Tool for Post-Awakening Emotional Stability
  ============================================================
  
  Version: 3.0.0 (Final)
  Created: August 2025
  Author: Clarity Metabolics
  
  Description:
  7-step interactive tool to help users regulate emotions,
  distinguish feelings from reactions, and find grounded responses.
  Part of the Five Anchors framework for post-awakening support.
  
  Features:
  - Progressive 7-step flow
  - Light/dark theme toggle
  - Download summary functionality
  - Sacred reflection modal
  - Mobile responsive design
  - Progress tracking
  
  Usage:
  Standalone HTML file - no dependencies required
  Open in any modern web browser
  
  License: © 2025 Clarity Metabolics
  Website: https://claritymetabolics.com
  ============================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Emotional Anchor — The Stability Well</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --main-color:#C97D7D;      /* primary (bar/buttons) */
    --accent-color:#F5EAE6;    /* soft panels */
    --contrast-color:#5A3E3E;  /* deep accent text/borders */
    --text-color:#333;
    --bg-color:#fff;
    --border-color:#e6d3cf;
    --shadow:0 2px 12px rgba(0,0,0,.08);
    --success-color:#5a7c41;   /* progress dots done */
    --warning-color:#dc3545;   /* Start Over confirm */
    --green-panel:#E5EBDD;
    --yellow-panel:#FFF8CC;
    --red-panel:#F5E6E6;
  }
  [data-theme="dark"]{
    --text-color:#e6e6e6;
    --bg-color:#1c1c1c;
    --border-color:#423532;
    --accent-color:#2d2625;
    --shadow:0 2px 14px rgba(0,0,0,.35);
    --green-panel:#2d352a;
    --yellow-panel:#3a3620;
    --red-panel:#3a2828;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Open Sans',sans-serif;
    color:var(--text-color);
    background:var(--bg-color);
    line-height:1.6;
  }
  .container{max-width:780px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

  /* Header */
  .header{
    color:#fff;
    background:linear-gradient(135deg,var(--main-color),var(--contrast-color));
    padding:22px 18px 18px;
    position:relative;
    transition: box-shadow .5s ease;
  }
  .header.completed{ box-shadow:0 0 18px rgba(201,125,125,.55); }
  .header h1{
    font-family:'Libre Baskerville',serif;
    font-size:2rem;
    text-align:center;
    margin-bottom:6px;
  }
  .subtitle{ text-align:center; font-style:italic; opacity:.95; }

  .header-controls{ position:absolute; top:10px; right:10px; display:flex; gap:8px }
  .header-btn{
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.3);
    color:#fff;
    padding:.35rem .6rem;border-radius:18px;cursor:pointer;
    font-size:.8rem;transition:all .2s ease;
  }
  .header-btn:hover{background:rgba(255,255,255,.25)}

  .progress-bar{height:4px;background:rgba(255,255,255,.28);border-radius:3px;margin-top:14px;overflow:hidden}
  .progress-fill{height:100%;background:#fff;width:0%;transition:width .6s ease}

  /* Content & steps */
  main.content{flex:1;padding:22px}
  .step{display:none;animation:fade .25s ease}
  .step.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .step-indicator{ text-align:center; margin:10px 0 18px }
  .step-counter{font-weight:700;color:#ffffff; background:var(--contrast-color); display:inline-block; padding:4px 10px; border-radius:12px }
  .dots{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--border-color)}
  .dot.active{background:var(--main-color)}
  .dot.done{background:var(--success-color)}

  h2{font-family:'Libre Baskerville',serif;color:var(--main-color);font-size:1.7rem;margin:14px 0 10px}
  p.lead{opacity:.95;margin-bottom:10px}

  .tip{
    background:linear-gradient(135deg, rgba(201,125,125,.12), rgba(90,62,62,.06));
    border-left:4px solid var(--main-color);
    padding:12px;border-radius:0 8px 8px 0;margin:14px 0;font-style:italic
  }

  .form-group{margin:16px 0}
  label{display:block;font-weight:700;color:var(--contrast-color);margin-bottom:6px}
  textarea, input[type="text"]{
    width:100%;min-height:110px;resize:vertical;border:2px solid var(--border-color);
    border-radius:10px;padding:12px;font:inherit;color:inherit;background:var(--bg-color);
    transition:all .2s ease;
  }
  input[type="text"]{ min-height:auto; }
  textarea:focus, input[type="text"]:focus{
    outline:none;border-color:var(--main-color);box-shadow:0 0 0 3px rgba(201,125,125,.18)
  }

  /* Panels for G/Y/R */
  .panel{
    border:2px solid var(--border-color);
    border-radius:10px;
    padding:12px;
  }
  .panel h3{
    font-family:'Libre Baskerville',serif;
    font-size:1.1rem;
    margin-bottom:8px;
    color:var(--contrast-color);
  }

  /* Buttons */
  .nav-row{display:flex;gap:12px;align-items:center;margin-top:22px;padding-top:18px;border-top:1px solid var(--border-color)}
  .nav-row .btn{flex:1}
  .btn{
    border:none;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;
    transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--main-color);color:#fff}
  .btn-primary:hover{background:var(--contrast-color);box-shadow:var(--shadow);transform:translateY(-1px)}
  .btn-secondary{background:var(--accent-color);color:var(--contrast-color);border:1px solid var(--border-color)}
  .btn-secondary:hover{background:var(--border-color)}
  .btn-warning{background:var(--warning-color);color:#fff}
  .btn-warning:hover{background:#c82333}

  .micro{ text-align:center; margin-top:6px; font-style:italic; color:var(--contrast-color); opacity:.85 }

  /* Final actions + Next Phase CTA */
  .final-actions{
    display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;
  }
  .final-actions .btn{ display:block; width:100%; max-width:280px; min-height:50px; text-align:center; }

  .next-phase {
    margin-top: 22px;
    padding: 16px;
    background: var(--accent-color);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    text-align: center;
    box-shadow: var(--shadow);
  }
  .next-phase .lead {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.05rem;
    color: var(--contrast-color);
    margin-bottom: 10px;
  }
  .next-phase .sub {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 6px;
  }
  .next-phase .btn-next {
    margin-top: 10px;
    display: inline-block;
    padding: 12px 18px;
    border-radius: 10px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    background: var(--main-color);
    color: #fff;
    transition: transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .next-phase .btn-next:hover {
    background: var(--contrast-color);
    box-shadow: var(--shadow);
    transform: translateY(-1px);
  }

  /* Branding */
  .branding{ text-align:center; padding:18px; font-size:.85rem; color:var(--text-color); opacity:.75; border-top:1px solid var(--border-color) }
  .branding a{ color:var(--contrast-color); text-decoration:none }
  .branding a:hover{ text-decoration:underline }

  .scripture{font-style:italic;background:var(--accent-color);padding:16px;border-left:4px solid var(--main-color);border-radius:8px;margin:16px 0}

  @media (max-width:640px){
    .nav-row{flex-direction:column}
    .btn{width:100%}
  }
</style>
</head>
<body>
<div id="pageTop" style="position:absolute;top:0"></div>
<div class="container">

  <header class="header" id="mainHeader">
    <div class="header-controls">
      <button class="header-btn" id="themeBtn" title="Toggle theme">🌙</button>
    </div>
    <h1>Emotional Anchor — The Stability Well</h1>
    <p class="subtitle">🪣 Ground your emotions and respond from inner stability.</p>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </header>

  <main class="content">
    <!-- STEP 0: Welcome -->
    <section class="step active" data-step="0">
      <div class="step-indicator">
        <div class="step-counter">Step 1 of 7</div>
        <div class="dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>The Stability Well</h2>
      <p class="lead">This is your space to process intense emotions, separate feelings from reactions, and choose responses that honor your inner wisdom. Like drawing from a deep well, take a couple of deep, full breaths and allow yourself to settle in. When you're ready, let's begin.</p>
      <div class="nav-row"><button class="btn btn-primary" onclick="nextStep()">Begin</button></div>
      <div class="micro">Your feelings are valid. Your responses are your choice.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 1: Name What You're Feeling (stacked G/Y/R) -->
    <section class="step" data-step="1">
      <div class="step-indicator">
        <div class="step-counter">Step 2 of 7 — Name What You're Feeling</div>
        <div class="dots"><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Name What You're Feeling</h2>
      <p class="lead">Distinguishing core emotions from reactive stories helps you respond rather than react.</p>

      <div class="form-group">
        <label for="emotionInput"><strong>What's the strongest emotion you're experiencing right now?</strong></label>
        <textarea id="emotionInput" placeholder="Describe what you're feeling..." rows="3"></textarea>
      </div>

      <div class="form-group panel" style="background:var(--green-panel)">
        <h3>Core Feeling — What's the purest emotion underneath?</h3>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Strip away the story and find the simple, honest feeling</p>
        <textarea id="coreFeeling" placeholder="Sadness, fear, anger, joy, grief, love... what's the raw emotion?" rows="4"></textarea>
      </div>

      <div class="form-group panel" style="background:var(--yellow-panel)">
        <h3>Mixed Messages — What's confusing or unclear?</h3>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Notice where you feel pulled in different directions</p>
        <textarea id="mixedMessages" placeholder="What emotions are competing? What feels contradictory?" rows="4"></textarea>
      </div>

      <div class="form-group panel" style="background:var(--red-panel)">
        <h3>Reactive Stories — What drama is your mind adding?</h3>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Identify the interpretations, assumptions, or dramatizations layered on top</p>
        <textarea id="reactiveStories" placeholder="What stories, blame, or catastrophizing is amplifying this feeling?" rows="4"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Consider: anger, fear, sadness, joy, shame, excitement, grief, hope, disgust, love. Place your hand on your heart. Say: "I feel [core emotion] and that's okay."</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" id="saveEmotionStep" onclick="nextStep()" disabled>Save & Continue</button>
      </div>
      <div class="micro">Naming emotions reduces their intensity.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 2: Where You Feel It -->
    <section class="step" data-step="2">
      <div class="step-indicator">
        <div class="step-counter">Step 3 of 7 — Where You Feel It</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Where You Feel It</h2>
      <p class="lead">Your body holds emotional wisdom. Listen to what it's telling you.</p>

      <div class="form-group">
        <label for="bodyLocation">Body Location — Where do you feel this emotion physically?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Scan from head to toe. Notice tension, heaviness, warmth, tightness, or lightness</p>
        <textarea id="bodyLocation" placeholder="Chest tight, stomach churning, shoulders heavy, jaw clenched..."></textarea>
      </div>

      <div class="form-group">
        <label for="bodyMessage">Body Message — What is your body asking for?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Listen deeper. What does this physical sensation need?</p>
        <textarea id="bodyMessage" placeholder="Rest, movement, space, comfort, expression, boundaries..."></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Take 5 deep breaths into wherever you feel the emotion strongest. Send a soft sort of kindness there like when you comfort a friend.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      </div>
      <div class="micro">Your body never lies.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 3: What It's Protecting -->
    <section class="step" data-step="3">
      <div class="step-indicator">
        <div class="step-counter">Step 4 of 7 — What It's Protecting</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>What It's Protecting</h2>
      <p class="lead">Every emotion has intelligence. It's trying to protect something you value.</p>

      <div class="form-group">
        <label for="emotionProtecting">What Value is Being Protected — What does this emotion care about?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Every emotion guards something precious - safety, connection, justice, truth, love</p>
        <textarea id="emotionProtecting" placeholder="What important value or need is this emotion defending?"></textarea>
      </div>

      <div class="form-group">
        <label for="emotionWisdom">Emotional Wisdom — What truth is this feeling revealing?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Honor the messenger, even if you don't follow its suggestions</p>
        <textarea id="emotionWisdom" placeholder="What is this emotion trying to tell you about your situation or needs?"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Even difficult emotions guard what you value most. Can you feel grateful that something in you cares so deeply about protecting what matters?</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Choose Response</button>
      </div>
      <div class="micro">Emotions are allies, not enemies.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 4: Choose Your Response -->
    <section class="step" data-step="4">
      <div class="step-indicator">
        <div class="step-counter">Step 5 of 7 — Choose Your Response</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Choose Your Response</h2>
      <p class="lead">You can honor your feelings while choosing wise actions.</p>

      <div class="form-group">
        <label for="honorFeeling">Honor the Feeling — How can you validate this emotion without reactive actions?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Feel it fully, express it safely, or simply acknowledge its presence</p>
        <textarea id="honorFeeling" placeholder="Journal, cry, move your body, talk to a trusted friend, create art..."></textarea>
      </div>

      <div class="form-group">
        <label for="wiseAction">Wise Action — What response honors both your values and your wisdom?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Choose actions that align with your deeper truth, not just immediate impulses</p>
        <textarea id="wiseAction" placeholder="What would your wisest, most grounded self do in this situation?"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Ask: "How can I honor what this emotion is protecting while choosing my wisest response?"</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      </div>
      <div class="micro">Wise responses create lasting peace.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 5: Recap + Sacred Reflection -->
    <section class="step" data-step="5">
      <div class="step-indicator">
        <div class="step-counter">Step 6 of 7 — Summary</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div></div>
      </div>
      <h2>Your Stability Well Summary</h2>
      <p>You named your emotions, honored your body's wisdom, discovered what you're protecting, and chose a grounded response. You've transformed emotional overwhelm into stable, wise action.</p>

      <div style="background:var(--accent-color);padding:16px;border-radius:10px;margin:12px 0">
        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color)">Name What You're Feeling</h3>
        <p id="sumEmotions">—</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">Where You Feel It</h3>
        <p id="sumBody">—</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">What It's Protecting</h3>
        <p id="sumProtecting">—</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">Choose Your Response</h3>
        <p id="sumResponse">—</p>
      </div>

      <div class="final-actions">
        <button class="btn btn-primary" onclick="downloadSummary()">📄 Download Summary</button>
        <button class="btn btn-secondary" onclick="openSacred()">✨ Sacred Reflection</button>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="nextStep()">Next Steps</button>
      </div>

      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 6: Physical Anchor lead-in -->
    <section class="step" data-step="6">
      <div class="step-indicator">
        <div class="step-counter">Step 7 of 7 — Next Step</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div></div>
      </div>
      <h2>Your Next Anchor: Spiritual</h2>
      <p class="lead">Now that your emotions are stable, let's create sacred space for Divine communion.</p>

      <div class="next-phase" aria-label="Move to Spiritual Anchor">
        <div class="lead"><strong>Connect with the Trinity from a place of inner peace and emotional groundedness.</strong></div>
        <button class="btn-next" onclick="goToSpiritualAnchor()">→ Begin the Spiritual Anchor</button>
        <div class="sub">Connect with the Trinity from a place of inner peace and emotional groundedness.</div>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:22px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="prevStep()">Back</button>
        <button class="btn btn-secondary" id="startOverBtn" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="confirmStartOver()">🔄 Start Over</button>
      </div>

      <div class="branding">
        <div><strong>Created by Clarity Metabolics</strong></div>
        <div style="font-style:italic;margin-top:4px">Quiet the world. Reconnect with what's real.</div>
        <div><a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
      </div>

      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>
  </main>
</div>

<!-- Sacred Reflection Modal (Trinity) -->
<div id="sacredModal" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000">
  <div style="background:var(--bg-color);color:var(--text-color);max-width:560px;width:100%;border-radius:12px;box-shadow:var(--shadow);padding:22px">
    <h3 style="font-family:'Libre Baskerville',serif;color:var(--main-color);margin-bottom:8px">Sacred Reflection</h3>
    <div class="scripture" style="margin:10px 0 16px 0">
      <p><strong>Father:</strong> Help me feel my emotions without being overwhelmed by them.</p>
      <p><strong>Son:</strong> Thank You for showing me how to respond with both compassion and wisdom.</p>
      <p><strong>Holy Spirit:</strong> Guide my heart to peace and my actions to love.</p>
    </div>
    <div style="text-align:center">
      <button class="btn btn-primary" onclick="closeSacred()">Amen</button>
    </div>
  </div>
</div>

<script>
  // --- State
  let currentStep = 0;
  const totalSteps = 7;
  const responses = {
    emotionInput:'', coreFeeling:'', mixedMessages:'', reactiveStories:'',
    bodyLocation:'', bodyMessage:'',
    emotionProtecting:'', emotionWisdom:'',
    honorFeeling:'', wiseAction:''
  };

  // Light / Dark toggle
  document.getElementById('themeBtn').addEventListener('click', () => {
    const body = document.body;
    const btn = document.getElementById('themeBtn');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme'); btn.textContent = '🌙';
    } else {
      body.setAttribute('data-theme','dark'); btn.textContent = '☀️';
    }
  });

  // Step navigation helpers
  function showStep(i){
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    const stepEl = document.querySelector(`.step[data-step="${i}"]`);
    if (stepEl) stepEl.classList.add('active');

    document.getElementById('progressFill').style.width = ((i)/ (totalSteps-1)) * 100 + '%';
    document.querySelectorAll('.step .dots').forEach(group => {
      [...group.children].forEach((d, idx) => {
        d.classList.remove('active','done');
        if (idx < i) d.classList.add('done');
        if (idx === i) d.classList.add('active');
      });
    });

    requestAnimationFrame(()=>{
      document.getElementById('pageTop').scrollIntoView({behavior:'auto',block:'start'});
      setTimeout(()=>{
        if (i===1) document.getElementById('emotionInput')?.focus();
        if (i===2) document.getElementById('bodyLocation')?.focus();
        if (i===3) document.getElementById('emotionProtecting')?.focus();
        if (i===4) document.getElementById('honorFeeling')?.focus();
      },100);
    });

    if (i===5){ document.getElementById('mainHeader')?.classList.add('completed'); updateSummary(); }
  }

  function nextStep(){ saveCurrent(); if (currentStep < totalSteps-1){ currentStep++; showStep(currentStep); } }
  function prevStep(){ if (currentStep>0){ currentStep--; showStep(currentStep);} }

  // Save per-step
  function saveCurrent(){
    switch(currentStep){
      case 1:
        responses.emotionInput = document.getElementById('emotionInput').value.trim();
        responses.coreFeeling = document.getElementById('coreFeeling').value.trim();
        responses.mixedMessages = document.getElementById('mixedMessages').value.trim();
        responses.reactiveStories = document.getElementById('reactiveStories').value.trim();
        break;
      case 2:
        responses.bodyLocation = document.getElementById('bodyLocation').value.trim();
        responses.bodyMessage = document.getElementById('bodyMessage').value.trim();
        break;
      case 3:
        responses.emotionProtecting = document.getElementById('emotionProtecting').value.trim();
        responses.emotionWisdom = document.getElementById('emotionWisdom').value.trim();
        break;
      case 4:
        responses.honorFeeling = document.getElementById('honorFeeling').value.trim();
        responses.wiseAction = document.getElementById('wiseAction').value.trim();
        break;
    }
  }

  // Summary
  function updateSummary(){
    const emotionsHTML = [
      '<strong>Original Emotion:</strong> ' + (responses.emotionInput || '—'),
      '<strong>Core Feeling:</strong> ' + (responses.coreFeeling || '—'),
      '<strong>Mixed Messages:</strong> ' + (responses.mixedMessages || '—'),
      '<strong>Reactive Stories:</strong> ' + (responses.reactiveStories || '—')
    ].join('<br>');

    document.getElementById('sumEmotions').innerHTML = emotionsHTML;
    document.getElementById('sumBody').innerHTML = [
      '<strong>Body Location:</strong> ' + (responses.bodyLocation || '—'),
      '<strong>Body Message:</strong> ' + (responses.bodyMessage || '—')
    ].join('<br>');

    document.getElementById('sumProtecting').innerHTML = [
      '<strong>Value Being Protected:</strong> ' + (responses.emotionProtecting || '—'),
      '<strong>Emotional Wisdom:</strong> ' + (responses.emotionWisdom || '—')
    ].join('<br>');

    document.getElementById('sumResponse').innerHTML = [
      '<strong>Honor the Feeling:</strong> ' + (responses.honorFeeling || '—'),
      '<strong>Wise Action:</strong> ' + (responses.wiseAction || '—')
    ].join('<br>');
  }

  // Start Over confirm
  let startOverArmed = false;
  function confirmStartOver(){
    const btn = document.getElementById('startOverBtn');
    if (!startOverArmed){
      startOverArmed = true;
      btn.classList.remove('btn-secondary'); btn.classList.add('btn-warning');
      btn.textContent = 'Confirm Start Over';
      setTimeout(()=>{ if(startOverArmed){
        startOverArmed=false; btn.classList.remove('btn-warning'); btn.classList.add('btn-secondary'); btn.textContent='🔄 Start Over';
      }},3000);
    } else { restartTool(); }
  }

  function restartTool(){
    Object.keys(responses).forEach(k => responses[k] = '');
    document.querySelectorAll('textarea, input[type="text"]').forEach(t => t.value='');
    const btn = document.getElementById('startOverBtn');
    if (btn){ startOverArmed=false; btn.className='btn btn-secondary'; btn.textContent='🔄 Start Over'; }
    const saveBtn = document.getElementById('saveEmotionStep'); if (saveBtn) saveBtn.disabled = true;
    currentStep = 0; showStep(currentStep);
  }

  // Download summary
  function downloadSummary(){
    const lines = [
      'Emotional Anchor — The Stability Well (Session Summary)',
      'Generated: ' + new Date().toLocaleString(),
      '',
      'NAME WHAT YOU\'RE FEELING:',
      'Original Emotion: ' + (responses.emotionInput || '—'),
      'Core Feeling: ' + (responses.coreFeeling || '—'),
      'Mixed Messages: ' + (responses.mixedMessages || '—'),
      'Reactive Stories: ' + (responses.reactiveStories || '—'),
      '',
      'WHERE YOU FEEL IT:',
      'Body Location: ' + (responses.bodyLocation || '—'),
      'Body Message: ' + (responses.bodyMessage || '—'),
      '',
      'WHAT IT\'S PROTECTING:',
      'Value Being Protected: ' + (responses.emotionProtecting || '—'),
      'Emotional Wisdom: ' + (responses.emotionWisdom || '—'),
      '',
      'CHOOSE YOUR RESPONSE:',
      'Honor the Feeling: ' + (responses.honorFeeling || '—'),
      'Wise Action: ' + (responses.wiseAction || '—'),
      '',
      '— © 2025 Clarity Metabolics | claritymetabolics.com'
    ].join('\n');

    const blob = new Blob([lines],{type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href=url; a.download='emotional-anchor-stability-well-summary.txt';
    document.body.appendChild(a); a.click();
    document.body.removeChild(a); URL.revokeObjectURL(url);
  }

  // Sacred Reflection modal
  function openSacred(){ document.getElementById('sacredModal').style.display='flex'; }
  function closeSacred(){ document.getElementById('sacredModal').style.display='none'; }

  // Spiritual Anchor link (update route when ready)
  function goToSpiritualAnchor(){
    alert('The Spiritual Anchor tool will be available soon! This would normally navigate to the next tool in the Five Anchors series.');
  }

  // Enable/disable Save on STEP 1
  function checkEmotionInputs() {
    const core = document.getElementById('coreFeeling')?.value.trim() || '';
    const mixed = document.getElementById('mixedMessages')?.value.trim() || '';
    const reactive = document.getElementById('reactiveStories')?.value.trim() || '';
    const saveBtn = document.getElementById('saveEmotionStep');
    if (saveBtn) saveBtn.disabled = !(core || mixed || reactive);
  }

  // Init
  function init(){ 
    showStep(0);
    setTimeout(() => {
      ['coreFeeling','mixedMessages','reactiveStories'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', checkEmotionInputs);
      });
    }, 100);
  }
  if (document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
</script>
</body>
</html>
