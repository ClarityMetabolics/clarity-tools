<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>The Five Anchors Dashboard - Your Stability Center</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&amp;family=Libre+Baskerville:wght@400;700&amp;display=swap" rel="stylesheet"/>
<style>
  :root{
    /* Five Anchors Color System */
    --physical-color: #7C8B60;
    --mental-color: #B7AFA3;
    --emotional-color: #C97D7D;
    --spiritual-color: #B6B0C3;
    --relational-color: #CBAF94;

    /* Base Theme */
    --text-color: #333;
    --bg-color: #fff;
    --border-color: #ddd;
    --accent-color: #f8f9fa;
    --shadow: 0 2px 12px rgba(0,0,0,.08);
    --success-color: #5a7c41;
    --warning-color: #dc3545;
  }
  [data-theme="dark"] {
    --text-color: #e6e6e6;
    --bg-color: #1a1a1a;
    --border-color: #444;
    --accent-color: #2a2a2a;
    --shadow: 0 2px 14px rgba(0,0,0,.35);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Open Sans', sans-serif;
    color: var(--text-color);
    background: var(--bg-color);
    line-height: 1.6;
  }

  .container {
  @keyframes dayFlash { from { box-shadow: 0 0 0 6px rgba(124,139,96,0.28);} to { box-shadow: 0 0 0 0 rgba(124,139,96,0);} }
  .flash-once { animation: dayFlash 900ms ease-out; border-radius: 12px; }

    max-width: 1200px;
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  .header {
    background: linear-gradient(135deg, var(--physical-color), var(--mental-color), var(--emotional-color), var(--spiritual-color), var(--relational-color));
    color: #fff;
    padding: 24px 20px;
    position: relative;
    text-align: center;
  }
  .header h1 {
    font-family: 'Libre Baskerville', serif;
    font-size: 2.2rem;
    margin-bottom: 8px;
  }
  .header .subtitle {
    font-style: italic;
    opacity: 0.9;
    margin-bottom: 16px;
  }
  .header-controls {
    position: absolute;
    top: 16px;
    right: 16px;
    display: flex;
    gap: 8px;
  }
  .header-btn {
    background: rgba(255,255,255,.15);
    border: 1px solid rgba(255,255,255,.3);
    color: #fff;
    padding: 8px 12px;
    border-radius: 18px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.2s ease;
  }
  .header-btn:hover { background: rgba(255,255,255,.25); }

  /* Main Content */
  .main-content { flex: 1; padding: 24px 20px; }

  /* Navigation Tabs */
  .nav-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 32px;
    border-bottom: 2px solid var(--border-color);
    flex-wrap: wrap;
    gap: 8px;
  }
  .nav-tab {
    padding: 12px 20px;
    border: none;
    background: none;
    color: var(--text-color);
    cursor: pointer;
    font-weight: 600;
    border-bottom: 3px solid transparent;
    transition: all 0.2s ease;
    white-space: nowrap;
  }
  .nav-tab:hover { background: var(--accent-color); }
  .nav-tab.active { color: var(--physical-color); border-bottom-color: var(--physical-color); }
  .nav-tab.active.mental { color: var(--mental-color); border-bottom-color: var(--mental-color); }
  .nav-tab.active.emotional { color: var(--emotional-color); border-bottom-color: var(--emotional-color); }
  .nav-tab.active.spiritual { color: var(--spiritual-color); border-bottom-color: var(--spiritual-color); }
  .nav-tab.active.relational { color: var(--relational-color); border-bottom-color: var(--relational-color); }

  /* Tab Content */
  .tab-content { display: none; animation: fadeIn 0.3s ease; }
  .tab-content.active { display: block; }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Daily Check-in Grid */
  .daily-checkin {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  .anchor-card {
    background: var(--accent-color);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s ease;
  }
  .anchor-card:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
  .anchor-card.physical { border-left: 4px solid var(--physical-color); }
  .anchor-card.mental { border-left: 4px solid var(--mental-color); }
  .anchor-card.emotional { border-left: 4px solid var(--emotional-color); }
  .anchor-card.spiritual { border-left: 4px solid var(--spiritual-color); }
  .anchor-card.relational { border-left: 4px solid var(--relational-color); }
  .anchor-card h3 {
    font-family: 'Libre Baskerville', serif;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .anchor-icon { font-size: 1.2rem; }

  .anchor-status {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 16px;
  }
  .status-indicator { width: 12px; height: 12px; border-radius: 50%; background: var(--border-color); }
  .status-indicator.good { background: var(--success-color); }
  .status-indicator.okay { background: #ffc107; }
  .status-indicator.needs-attention { background: var(--warning-color); }

  .quick-assessment { margin-bottom: 16px; }
  .quick-assessment label { display: block; font-size: 0.9rem; margin-bottom: 8px; font-weight: 600; }
  .rating-scale { display: flex; gap: 8px; justify-content: center; }
  .rating-button {
    width: 32px; height: 32px; border: 2px solid var(--border-color);
    border-radius: 50%; background: var(--bg-color); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-weight: 600; transition: all 0.2s ease;
  }
  .rating-button:hover { background: var(--accent-color); }
  .rating-button.selected { background: var(--physical-color); color: #fff; border-color: var(--physical-color); }
  .rating-button.selected.mental { background: var(--mental-color); border-color: var(--mental-color); }
  .rating-button.selected.emotional { background: var(--emotional-color); border-color: var(--emotional-color); }
  .rating-button.selected.spiritual { background: var(--spiritual-color); border-color: var(--spiritual-color); }
  .rating-button.selected.relational { background: var(--relational-color); border-color: var(--relational-color); }

  .anchor-actions { display: flex; gap: 8px; flex-wrap: wrap; }
  .btn {
    padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;
    font-weight: 600; font-size: 0.85rem; transition: all 0.2s ease;
    text-decoration: none; display: inline-block; text-align: center;
  }
  .btn-primary { background: var(--physical-color); color: #fff; }
  .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
  .btn-primary.mental { background: var(--mental-color); }
  .btn-primary.emotional { background: var(--emotional-color); }
  .btn-primary.spiritual { background: var(--spiritual-color); }
  .btn-primary.relational { background: var(--relational-color); }
  .btn-secondary { background: var(--accent-color); color: var(--text-color); border: 1px solid var(--border-color); }
  .btn-secondary:hover { background: var(--border-color); }

  /* Progress Overview */
  .progress-overview {
    background: var(--accent-color); border: 1px solid var(--border-color);
    border-radius: 12px; padding: 24px; margin-bottom: 32px;
  }
  .progress-overview h2 { font-family: 'Libre Baskerville', serif; margin-bottom: 20px; text-align: center; }
  .progress-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px; margin-bottom: 20px;
  }
  .progress-item { text-align: center; padding: 16px; border-radius: 8px; background: var(--bg-color); border: 1px solid var(--border-color); }
  .progress-circle {
    width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 12px;
    display: flex; align-items: center; justify-content: center; font-weight: 700; color: #fff; font-size: 0.9rem;
  }
  .progress-circle.physical { background: var(--physical-color); }
  .progress-circle.mental { background: var(--mental-color); }
  .progress-circle.emotional { background: var(--emotional-color); }
  .progress-circle.spiritual { background: var(--spiritual-color); }
  .progress-circle.relational { background: var(--relational-color); }
  .progress-label { font-weight: 600; margin-bottom: 4px; }
  .progress-trend { font-size: 0.8rem; color: var(--success-color); }

  /* Anchor Statements */
  .anchor-statements {
    background: var(--accent-color); border: 1px solid var(--border-color);
    border-radius: 12px; padding: 24px; margin-bottom: 32px;
  }
  .anchor-statements h2 { font-family: 'Libre Baskerville', serif; margin-bottom: 20px; text-align: center; }
  .statement-item { margin-bottom: 16px; padding: 16px; border-radius: 8px; background: var(--bg-color); border-left: 4px solid var(--physical-color); }
  .statement-item.mental { border-left-color: var(--mental-color); }
  .statement-item.emotional { border-left-color: var(--emotional-color); }
  .statement-item.spiritual { border-left-color: var(--spiritual-color); }
  .statement-item.relational { border-left-color: var(--relational-color); }
  .statement-label { font-weight: 600; margin-bottom: 8px; color: var(--physical-color); }
  .statement-label.mental { color: var(--mental-color); }
  .statement-label.emotional { color: var(--emotional-color); }
  .statement-label.spiritual { color: var(--spiritual-color); }
  .statement-label.relational { color: var(--relational-color); }
  .statement-text { font-style: italic; line-height: 1.6; }

  /* Action Plan */
  .action-plan {
    background: var(--accent-color); border: 1px solid var(--border-color);
    border-radius: 12px; padding: 24px; margin-bottom: 32px;
  }
  .action-plan h2 { font-family: 'Libre Baskerville', serif; margin-bottom: 20px; text-align: center; }
  .action-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px; margin-bottom: 8px; border-radius: 6px; background: var(--bg-color); border: 1px solid var(--border-color); }
  .action-checkbox { margin-top: 4px; }
  .action-content { flex: 1; }
  .action-title { font-weight: 600; margin-bottom: 4px; }
  .action-description { font-size: 0.9rem; color: var(--text-color); opacity: 0.8; }

  /* Crisis Navigation */
  .crisis-navigation {
    background: linear-gradient(135deg, var(--warning-color), #e74c3c);
    color: #fff; border-radius: 12px; padding: 24px; margin-bottom: 32px; text-align: center;
  }
  .crisis-navigation h2 { font-family: 'Libre Baskerville', serif; margin-bottom: 16px; }
  .crisis-actions { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
  .crisis-btn {
    background: rgba(255,255,255,0.2); color: #fff; border: 1px solid rgba(255,255,255,0.3);
    padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s ease;
  }
  .crisis-btn:hover { background: rgba(255,255,255,0.3); }

  /* Footer */
  .footer { text-align: center; padding: 24px; border-top: 1px solid var(--border-color); color: var(--text-color); opacity: 0.75; }
  .footer a { color: inherit; text-decoration: none; }
  .footer a:hover { text-decoration: underline; }

  /* Responsive Design */
  @media (max-width: 768px) {
    .header h1 { font-size: 1.8rem; }
    .header-controls { position: static; justify-content: center; margin-top: 16px; }
    .daily-checkin { grid-template-columns: 1fr; }
    .progress-grid { grid-template-columns: repeat(2, 1fr); }
    .nav-tabs { justify-content: flex-start; overflow-x: auto; padding-bottom: 8px; }
    .crisis-actions { flex-direction: column; align-items: center; }
    .crisis-btn { width: 100%; max-width: 220px; }
  }
  @media (prefers-reduced-motion: reduce) {
    .tab-content { animation: none; }
    .anchor-card, .btn { transition: none; }
  }

  /* Calendar Styles */
  .calendar-container { margin-bottom: 32px; }
  .calendar-weekdays {
    display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 4px;
  }
  .weekday {
    padding: 12px; text-align: center; font-weight: 600; color: var(--text-color);
    background: var(--accent-color); border-radius: 4px;
  }
  .calendar-grid {
    display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;
  }
  
  .calendar-day.note-only { 
    border: 2px dashed var(--border-color); 
    background: var(--bg-color) !important;
  }
  .calendar-day.has-note .day-note { display: block; }
  .day-note { position: absolute; top: 6px; right: 6px; font-size: 0.85rem; opacity: 0.9; }
  .rating-editor { margin-top: 12px; display: none; }
  .rating-row { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
  .rating-label { min-width: 90px; font-weight: 600; }
  .pill { padding: 4px 8px; border-radius: 16px; border: 1px solid var(--border-color); cursor: pointer; font-size: 0.85rem; }
  .pill-selected { background: var(--accent-color); }
.calendar-day {
    aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
    border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer;
    transition: all 0.2s ease; position: relative; background: var(--bg-color);
    padding: 8px; min-height: 60px;
  }
  .calendar-day:hover { 
    background: var(--accent-color); 
    transform: scale(1.02); 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .calendar-day:focus {
    outline: 2px solid var(--physical-color);
    outline-offset: 2px;
  }
  .calendar-day.other-month { 
    opacity: 0.3; 
    color: var(--border-color); 
    cursor: default;
  }
  .calendar-day.other-month:hover {
    transform: none;
    background: var(--bg-color);
    box-shadow: none;
  }
  .calendar-day.today { 
    border: 3px solid var(--physical-color); 
    font-weight: 700; 
    box-shadow: 0 0 0 1px var(--physical-color);
    background: rgba(124, 139, 96, 0.1);
  }
  .calendar-day.has-data { 
    background: linear-gradient(45deg, var(--physical-color), var(--spiritual-color)) !important; 
    color: white !important; 
    font-weight: 600;
  }
  .calendar-day.has-data .day-wellness {
    color: white !important;
    opacity: 1 !important;
  }
  .calendar-day.selected { 
    box-shadow: 0 0 12px var(--physical-color) !important;
    transform: scale(1.05) !important;
    z-index: 10;
  }
  .calendar-day.today.has-data {
    border: 3px solid #fff;
    box-shadow: 0 0 0 2px var(--physical-color), 0 0 12px var(--physical-color);
  }
  .day-number { 
    font-size: 1rem; 
    margin-bottom: 2px; 
    line-height: 1;
  }
  .day-wellness { 
    font-size: 0.8rem; 
    opacity: 0.9; 
    line-height: 1;
  }

  .calendar-stats {
    background: var(--accent-color); border: 1px solid var(--border-color);
    border-radius: 12px; padding: 24px; margin-bottom: 32px;
  }
  .calendar-stats h3 { font-family: 'Libre Baskerville', serif; margin-bottom: 20px; text-align: center; }
  .stats-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px;
  }
  .stat-item { text-align: center; padding: 16px; border-radius: 8px; background: var(--bg-color); }
  .stat-number { font-size: 1.5rem; font-weight: 700; color: var(--physical-color); margin-bottom: 4px; }
  .stat-label { font-size: 0.8rem; opacity: 0.8; }

  .day-detail {
    background: var(--accent-color); border: 1px solid var(--border-color);
    border-radius: 12px; padding: 24px; margin-bottom: 32px;
  }
  .day-detail h3 { font-family: 'Libre Baskerville', serif; margin-bottom: 20px; text-align: center; }
  .day-anchors { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 24px; }
  .day-anchor {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px; background: var(--bg-color); border-radius: 6px; border: 1px solid var(--border-color);
  }
  .anchor-name { font-weight: 600; }
  .anchor-rating { font-weight: 700; color: var(--physical-color); }
  .day-notes { margin-top: 20px; }
  .day-notes label { display: block; font-weight: 600; margin-bottom: 8px; }
  .day-notes textarea { 
    width: 100%; 
    margin-bottom: 12px; 
    padding: 12px; 
    border: 1px solid var(--border-color); 
    border-radius: 6px; 
    font-family: inherit; 
    background: var(--bg-color); 
    color: var(--text-color); 
    resize: vertical;
    min-height: 80px;
  }

  @media (max-width: 768px) {
    .calendar-day { font-size: 0.8rem; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .day-anchors { grid-template-columns: 1fr; }
  }

  .modal { 
    position: fixed; 
    inset: 0; 
    background: rgba(0,0,0,0.5); 
    display: none; 
    align-items: center; 
    justify-content: center; 
    padding: 16px; 
    z-index: 1000; 
  }
  .modal.active { display: flex; }
  .modal-content {
    background: var(--bg-color); 
    color: var(--text-color); 
    max-width: 600px; 
    width: 100%; 
    max-height: 90vh;
    border-radius: 12px; 
    box-shadow: var(--shadow); 
    padding: 24px; 
    overflow-y: auto;
  }
  .modal-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 20px; 
    padding-bottom: 16px; 
    border-bottom: 1px solid var(--border-color); 
  }
  .modal-title { font-family: 'Libre Baskerville', serif; font-size: 1.3rem; margin: 0; }
  .modal-close { 
    background: none; 
    border: none; 
    font-size: 1.5rem; 
    cursor: pointer; 
    color: var(--text-color); 
    opacity: 0.7; 
    padding: 4px;
    line-height: 1;
  }
  .modal-close:hover { opacity: 1; }
  .reflection-content { text-align: center; }
  .trinity-prayer { 
    background: var(--accent-color); 
    border-left: 4px solid var(--spiritual-color); 
    border-radius: 8px; 
    padding: 20px; 
    margin: 20px 0; 
    font-style: italic; 
    line-height: 1.7; 
  }
  .trinity-section { margin-bottom: 20px; }
  .trinity-title { font-weight: 700; color: var(--spiritual-color); margin-bottom: 8px; }
  .trinity-text { margin-left: 16px; }
  .scripture-verse { margin-top: 24px; font-weight: 600; opacity: 0.9; }
</style>
</head>
<body>
<div class="container">
<header class="header">
<div class="header-controls">
<button aria-label="Toggle theme" class="header-btn" id="themeBtn">üåô</button>
<button class="header-btn" onclick="openReflection()">‚ú® Reflect</button>
<button class="header-btn" onclick="exportData()">üìÑ Export</button>


</div>
<h1>The Five Anchors Dashboard</h1>
<p class="subtitle">Your Stability Center ‚Äî navigate life from a grounded, conscious place</p>
</header>
<main class="main-content">
<!-- Navigation Tabs -->
<div aria-label="Dashboard sections" class="nav-tabs" role="tablist">
<button aria-selected="true" class="nav-tab active" onclick="switchTab(event,'overview')" role="tab">üìä Overview</button>
<button aria-selected="false" class="nav-tab physical" onclick="switchTab(event,'daily-checkin')" role="tab">üß≠ Daily Check-in</button>
<button aria-selected="false" class="nav-tab mental" onclick="switchTab(event,'action-plan')" role="tab">üìã Action Plan</button>
<button aria-selected="false" class="nav-tab emotional" onclick="switchTab(event,'progress-calendar')" role="tab">üìÖ Progress Calendar</button>
<button aria-selected="false" class="nav-tab spiritual" onclick="switchTab(event,'anchor-statements')" role="tab">‚öì Anchor Statements</button>
<button aria-selected="false" class="nav-tab relational" onclick="switchTab(event,'crisis-navigation')" role="tab">üö® Crisis Navigation</button>
</div>
<!-- Overview Tab -->
<div class="tab-content active" id="overview" role="tabpanel">
<div class="progress-overview">
<h2>Your Five Anchors Progress</h2>
<div class="progress-grid">
<div class="progress-item">
<div class="progress-circle physical" id="physical-progress">100%</div>
<div class="progress-label">Physical Anchor</div>
<div class="progress-trend">‚Üó Improving</div>
</div>
<div class="progress-item">
<div class="progress-circle mental" id="mental-progress">80%</div>
<div class="progress-label">Mental Anchor</div>
<div class="progress-trend">‚Üí Stable</div>
</div>
<div class="progress-item">
<div class="progress-circle emotional" id="emotional-progress">80%</div>
<div class="progress-label">Emotional Anchor</div>
<div class="progress-trend">‚Üó Improving</div>
</div>
<div class="progress-item">
<div class="progress-circle spiritual" id="spiritual-progress">100%</div>
<div class="progress-label">Spiritual Anchor</div>
<div class="progress-trend">‚Üó Strong</div>
</div>
<div class="progress-item">
<div class="progress-circle relational" id="relational-progress">60%</div>
<div class="progress-label">Relational Anchor</div>
<div class="progress-trend">‚Üó Growing</div>
</div>
</div>
</div>
<div class="action-plan">
<h2>Today's Recommended Actions</h2>
<div class="action-item">
<input class="action-checkbox" id="action1" type="checkbox"/>
<div class="action-content">
<div class="action-title">Morning Body Scan (Physical)</div>
<div class="action-description">Take 5 minutes to check in with your body's signals</div>
</div>
</div>
<div class="action-item">
<input class="action-checkbox" id="action2" type="checkbox"/>
<div class="action-content">
<div class="action-title">Boundary Practice (Relational)</div>
<div class="action-description">Practice saying "no" kindly to one small request today</div>
</div>
</div>
<div class="action-item">
<input class="action-checkbox" id="action3" type="checkbox"/>
<div class="action-content">
<div class="action-title">Sacred Pause (Spiritual)</div>
<div class="action-description">Take 3 minutes for prayer or quiet</div>
</div>
</div>
</div>
</div>
<!-- Daily Check-in Tab -->
<div class="tab-content" id="daily-checkin" role="tabpanel">
<h2 style="text-align: center; margin-bottom: 24px; font-family: 'Libre Baskerville', serif;">Daily Anchor Check-in</h2>
<div class="daily-checkin">
<!-- Physical -->
<div class="anchor-card physical">
<h3><span class="anchor-icon">üß≠</span> Physical Anchor</h3>
<div class="anchor-status">
<span>Body Awareness &amp; Grounding</span>
<div class="status-indicator good" id="physical-status"></div>
</div>
<div class="quick-assessment">
<label>How grounded do you feel in your body today?</label>
<div class="rating-scale">
<button class="rating-button physical" data-anchor="physical" data-rating="1">1</button>
<button class="rating-button physical" data-anchor="physical" data-rating="2">2</button>
<button class="rating-button physical" data-anchor="physical" data-rating="3">3</button>
<button class="rating-button physical" data-anchor="physical" data-rating="4">4</button>
<button class="rating-button physical selected" data-anchor="physical" data-rating="5">5</button>
</div>
</div>
<div class="anchor-actions">
<a class="btn btn-primary physical" href="#">Deep Dive</a>
<button class="btn btn-secondary" onclick="quickPractice('physical')">Quick Practice</button>
</div>
</div>
<!-- Mental -->
<div class="anchor-card mental">
<h3><span class="anchor-icon">üîç</span> Mental Anchor</h3>
<div class="anchor-status">
<span>Mental Clarity &amp; Focus</span>
<div class="status-indicator okay" id="mental-status"></div>
</div>
<div class="quick-assessment">
<label>How clear and focused is your thinking today?</label>
<div class="rating-scale">
<button class="rating-button mental" data-anchor="mental" data-rating="1">1</button>
<button class="rating-button mental" data-anchor="mental" data-rating="2">2</button>
<button class="rating-button mental" data-anchor="mental" data-rating="3">3</button>
<button class="rating-button mental selected" data-anchor="mental" data-rating="4">4</button>
<button class="rating-button mental" data-anchor="mental" data-rating="5">5</button>
</div>
</div>
<div class="anchor-actions">
<a class="btn btn-primary mental" href="#">Deep Dive</a>
<button class="btn btn-secondary" onclick="quickPractice('mental')">Quick Practice</button>
</div>
</div>
<!-- Emotional -->
<div class="anchor-card emotional">
<h3><span class="anchor-icon">ü©∑</span> Emotional Anchor</h3>
<div class="anchor-status">
<span>Emotional Stability &amp; Wisdom</span>
<div class="status-indicator okay" id="emotional-status"></div>
</div>
<div class="quick-assessment">
<label>How steady and wise do your emotions feel today?</label>
<div class="rating-scale">
<button class="rating-button emotional" data-anchor="emotional" data-rating="1">1</button>
<button class="rating-button emotional" data-anchor="emotional" data-rating="2">2</button>
<button class="rating-button emotional" data-anchor="emotional" data-rating="3">3</button>
<button class="rating-button emotional selected" data-anchor="emotional" data-rating="4">4</button>
<button class="rating-button emotional" data-anchor="emotional" data-rating="5">5</button>
</div>
</div>
<div class="anchor-actions">
<a class="btn btn-primary emotional" href="#">Deep Dive</a>
<button class="btn btn-secondary" onclick="quickPractice('emotional')">Quick Practice</button>
</div>
</div>
<!-- Spiritual -->
<div class="anchor-card spiritual">
<h3><span class="anchor-icon">‚ú®</span> Spiritual Anchor</h3>
<div class="anchor-status">
<span>Divine Connection &amp; Purpose</span>
<div class="status-indicator good" id="spiritual-status"></div>
</div>
<div class="quick-assessment">
<label>How connected do you feel to what's sacred today?</label>
<div class="rating-scale">
<button class="rating-button spiritual" data-anchor="spiritual" data-rating="1">1</button>
<button class="rating-button spiritual" data-anchor="spiritual" data-rating="2">2</button>
<button class="rating-button spiritual" data-anchor="spiritual" data-rating="3">3</button>
<button class="rating-button spiritual" data-anchor="spiritual" data-rating="4">4</button>
<button class="rating-button spiritual selected" data-anchor="spiritual" data-rating="5">5</button>
</div>
</div>
<div class="anchor-actions">
<a class="btn btn-primary spiritual" href="#">Deep Dive</a>
<button class="btn btn-secondary" onclick="quickPractice('spiritual')">Quick Practice</button>
</div>
</div>
<!-- Relational -->
<div class="anchor-card relational">
<h3><span class="anchor-icon">üåê</span> Relational Anchor</h3>
<div class="anchor-status">
<span>Conscious Connection &amp; Community</span>
<div class="status-indicator needs-attention" id="relational-status"></div>
</div>
<div class="quick-assessment">
<label>How authentic and connected are your relationships today?</label>
<div class="rating-scale">
<button class="rating-button relational" data-anchor="relational" data-rating="1">1</button>
<button class="rating-button relational" data-anchor="relational" data-rating="2">2</button>
<button class="rating-button relational selected" data-anchor="relational" data-rating="3">3</button>
<button class="rating-button relational" data-anchor="relational" data-rating="4">4</button>
<button class="rating-button relational" data-anchor="relational" data-rating="5">5</button>
</div>
</div>
<div class="anchor-actions">
<a class="btn btn-primary relational" href="#">Deep Dive</a>
<button class="btn btn-secondary" onclick="quickPractice('relational')">Quick Practice</button>
</div>
</div>
</div>
</div>
<!-- Progress Calendar Tab -->
<div class="tab-content" id="progress-calendar" role="tabpanel">
<div class="progress-overview">
<h2>Your Progress Calendar</h2>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
<button class="btn btn-secondary" onclick="changeMonth(-1)">‚Üê Previous</button>
<h3 id="calendar-month-year" style="margin: 0; font-family: 'Libre Baskerville', serif;">December 2024</h3>
<button class="btn btn-secondary" onclick="changeMonth(1)">Next ‚Üí</button>
</div>
<div class="calendar-container">
<div class="calendar-weekdays">
<div class="weekday">Sun</div>
<div class="weekday">Mon</div>
<div class="weekday">Tue</div>
<div class="weekday">Wed</div>
<div class="weekday">Thu</div>
<div class="weekday">Fri</div>
<div class="weekday">Sat</div>
</div>
<div class="calendar-grid" id="calendar-grid">
<!-- Calendar days will be generated here -->
</div>
</div>
</div>
<div class="calendar-stats">
<h3>This Month's Insights</h3>
<div class="stats-grid">
<div class="stat-item">
<div class="stat-number" id="avg-physical">4.2</div>
<div class="stat-label">Physical Average</div>
</div>
<div class="stat-item">
<div class="stat-number" id="avg-mental">3.8</div>
<div class="stat-label">Mental Average</div>
</div>
<div class="stat-item">
<div class="stat-number" id="avg-emotional">4.1</div>
<div class="stat-label">Emotional Average</div>
</div>
<div class="stat-item">
<div class="stat-number" id="avg-spiritual">4.5</div>
<div class="stat-label">Spiritual Average</div>
</div>
<div class="stat-item">
<div class="stat-number" id="avg-relational">3.6</div>
<div class="stat-label">Relational Average</div>
</div>
<div class="stat-item">
<div class="stat-number" id="best-day">Dec 15</div>
<div class="stat-label">Best Day</div>
</div>
</div>
</div>
<div class="day-detail" id="day-detail" style="display: none;">
<h3 id="detail-date">Select a day</h3><p id="no-ratings-hint" style="opacity:.7; font-size:.95rem; margin:4px 0 10px 0; display:none;">No ratings yet ‚Äî add a quick note if you like.</p>
<div class="day-anchors">
<div class="day-anchor">
<span class="anchor-name">Physical:</span>
<span class="anchor-rating" id="detail-physical">‚Äî</span>
</div>
<div class="day-anchor">
<span class="anchor-name">Mental:</span>
<span class="anchor-rating" id="detail-mental">‚Äî</span>
</div>
<div class="day-anchor">
<span class="anchor-name">Emotional:</span>
<span class="anchor-rating" id="detail-emotional">‚Äî</span>
</div>
<div class="day-anchor">
<span class="anchor-name">Spiritual:</span>
<span class="anchor-rating" id="detail-spiritual">‚Äî</span>
</div>
<div class="day-anchor">
<span class="anchor-name">Relational:</span>
<span class="anchor-rating" id="detail-relational">‚Äî</span>
</div>
</div>

<div class="day-edit-controls">
  <button id="edit-ratings-btn" class="btn btn-secondary">Edit ratings</button>
  <div id="rating-editor" class="rating-editor">
    <div class="rating-row"><span class="rating-label">Physical</span>
      "></button>`).join('')}
    </div>
    <div class="rating-row"><span class="rating-label">Mental</span>
      "></button>`).join('')}
    </div>
    <div class="rating-row"><span class="rating-label">Emotional</span>
      "></button>`).join('')}
    </div>
    <div class="rating-row"><span class="rating-label">Spiritual</span>
      "></button>`).join('')}
    </div>
    <div class="rating-row"><span class="rating-label">Relational</span>
      "></button>`).join('')}
    </div>
    <div style="margin-top:10px; display:flex; gap:8px;">
      <button id="save-day-ratings" class="btn btn-primary">Save Ratings</button>
      <button id="cancel-edit-ratings" class="btn btn-secondary">Cancel</button>
    </div>
  </div>
</div>

<div class="day-edit-controls">
  <button id="edit-ratings-btn" class="btn btn-secondary">Edit ratings</button>
  <div id="rating-editor" class="rating-editor">
    <div class="rating-row"><span class="rating-label">Physical</span>
      <button class="pill" data-anchor="physical" data-value="1">1</button>
      <button class="pill" data-anchor="physical" data-value="2">2</button>
      <button class="pill" data-anchor="physical" data-value="3">3</button>
      <button class="pill" data-anchor="physical" data-value="4">4</button>
      <button class="pill" data-anchor="physical" data-value="5">5</button>
    </div>
    <div class="rating-row"><span class="rating-label">Mental</span>
      <button class="pill" data-anchor="mental" data-value="1">1</button>
      <button class="pill" data-anchor="mental" data-value="2">2</button>
      <button class="pill" data-anchor="mental" data-value="3">3</button>
      <button class="pill" data-anchor="mental" data-value="4">4</button>
      <button class="pill" data-anchor="mental" data-value="5">5</button>
    </div>
    <div class="rating-row"><span class="rating-label">Emotional</span>
      <button class="pill" data-anchor="emotional" data-value="1">1</button>
      <button class="pill" data-anchor="emotional" data-value="2">2</button>
      <button class="pill" data-anchor="emotional" data-value="3">3</button>
      <button class="pill" data-anchor="emotional" data-value="4">4</button>
      <button class="pill" data-anchor="emotional" data-value="5">5</button>
    </div>
    <div class="rating-row"><span class="rating-label">Spiritual</span>
      <button class="pill" data-anchor="spiritual" data-value="1">1</button>
      <button class="pill" data-anchor="spiritual" data-value="2">2</button>
      <button class="pill" data-anchor="spiritual" data-value="3">3</button>
      <button class="pill" data-anchor="spiritual" data-value="4">4</button>
      <button class="pill" data-anchor="spiritual" data-value="5">5</button>
    </div>
    <div class="rating-row"><span class="rating-label">Community</span>
      <button class="pill" data-anchor="relational" data-value="1">1</button>
      <button class="pill" data-anchor="relational" data-value="2">2</button>
      <button class="pill" data-anchor="relational" data-value="3">3</button>
      <button class="pill" data-anchor="relational" data-value="4">4</button>
      <button class="pill" data-anchor="relational" data-value="5">5</button>
    </div>
    <div style="margin-top:10px; display:flex; gap:8px;">
      <button id="save-day-ratings" class="btn btn-primary">Save Ratings</button>
      <button id="cancel-edit-ratings" class="btn btn-secondary">Cancel</button>
    </div>
  </div>
</div>
<div class="day-notes">
<label for="day-notes-input">Notes for this day:</label>
<textarea id="day-notes-input" placeholder="How was this day? Any insights or victories?" rows="3"></textarea>
<button class="btn btn-primary" onclick="saveNotes()">Update Day</button>
</div>
</div>
</div>
<!-- Action Plan Tab -->
<div class="tab-content" id="action-plan" role="tabpanel">
<div class="action-plan">
<h2>Your Personalized Action Plan</h2>
<p style="text-align:center; opacity:.8; margin-bottom:16px;">(Auto-generated ideas based on lower-rated anchors)</p>
<div id="actionList"></div>
</div>
</div>
<!-- Anchor Statements Tab -->
<div class="tab-content" id="anchor-statements" role="tabpanel">
<div class="anchor-statements">
<h2>Your Anchor Statements</h2>
<p style="text-align: center; margin-bottom: 24px; opacity: 0.8;">Return to these truths when each anchor feels unstable.</p>
<div class="statement-item">
<div class="statement-label">Physical</div>
<div class="statement-text">My body is a trustworthy signal system. I can listen without fear.</div>
</div>
<div class="statement-item mental">
<div class="statement-label mental">Mental</div>
<div class="statement-text">Clarity grows when I align thoughts with truth, not noise.</div>
</div>
<div class="statement-item emotional">
<div class="statement-label emotional">Emotional</div>
<div class="statement-text">Emotions are information, not commands. I can respond with wisdom.</div>
</div>
<div class="statement-item spiritual">
<div class="statement-label spiritual">Spiritual</div>
<div class="statement-text">God is near. In His presence I find direction and peace.</div>
</div>
<div class="statement-item relational">
<div class="statement-label relational">Relational</div>
<div class="statement-text">I build honest, life-giving connections rooted in truth.</div>
</div>
</div>
</div>
<!-- Crisis Navigation Tab -->
<div class="tab-content" id="crisis-navigation" role="tabpanel">
<div class="crisis-navigation">
<h2>üö® When Everything Feels Overwhelming</h2>
<p style="margin-bottom: 20px;">Emergency protocols for when multiple anchors feel unstable.</p>
<div class="crisis-actions">
<button class="crisis-btn" onclick="emergencyGrounding()">üß≠ Emergency Grounding</button>
<button class="crisis-btn" onclick="breathingProtocol()">üí® Breathing Protocol</button>
<button class="crisis-btn" onclick="sacredPause()">‚ú® Sacred Pause</button>
<button class="crisis-btn" onclick="crisisSupport()">üìû Crisis Support</button>
</div>
</div>
<ol style="max-width:720px;margin:16px auto 0;line-height:1.7;color:var(--text-color);">
<li><strong>Stop + Breathe:</strong> 4 slow breaths. In through the nose, out through the mouth.</li>
<li><strong>Name what's true:</strong> One sentence about what's real right now (no catastrophizing).</li>
<li><strong>Pick one anchor:</strong> Choose the lowest one and do one small action for 2 minutes.</li>
<li><strong>Text a safe person:</strong> "I'm taking a reset. Back in 10."</li>
</ol>
</div>
</main>
<footer class="footer">
<div><strong>Created by Clarity Metabolics</strong></div>
<div style="font-style: italic; margin-top: 4px;">Quiet the world. Reconnect with what's real.</div>
<div><a href="https://claritymetabolics.com" rel="noopener" target="_blank">claritymetabolics.com</a></div>
</footer>
</div>
<!-- Sacred Reflection Modal -->
<div aria-hidden="true" aria-labelledby="modal-title" class="modal" id="reflectionModal" role="dialog">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title" id="modal-title">Sacred Reflection</h3>
<button aria-label="Close modal" class="modal-close" onclick="closeReflection()">√ó</button>
</div>
<div class="reflection-content">
<div class="trinity-prayer">
<div class="trinity-section">
<div class="trinity-title">FATHER</div>
<div class="trinity-text">Thank You for being my anchor when everything else feels unstable. In Your presence I find steady ground.</div>
</div>
<div class="trinity-section">
<div class="trinity-title">SON</div>
<div class="trinity-text">Jesus, teach me to live from truth and love, even when the world is loud.</div>
</div>
<div class="trinity-section">
<div class="trinity-title">HOLY SPIRIT</div>
<div class="trinity-text">Guide my thoughts, emotions, body, and relationships back into alignment today.</div>
</div>
<div class="scripture-verse">‚ú® "He will be like a tree planted by the water‚Ä¶" ‚Äî Jeremiah 17:8</div>
</div>
<button class="btn btn-primary spiritual" onclick="closeReflection()">Amen</button>
</div>
</div>
</div>
<script>
/* ---------- State ---------- */
const dashboardState = {
  ratings: { physical: 5, mental: 4, emotional: 4, spiritual: 5, relational: 3 },
  currentTab: 'overview',
  theme: 'light',
  dailyData: {}, // Store daily ratings and notes
  currentCalendarDate: new Date(),
  selectedDay: null
};

/* ---------- Persistence ---------- */
function saveState() {
  try { 
    localStorage.setItem('fiveAnchorsState', JSON.stringify(dashboardState)); 
  } catch(e) {
    console.warn('Could not save state to localStorage:', e);
  }
}

function loadState() {
  try {
    const raw = localStorage.getItem('fiveAnchorsState');
    if (raw) {
      const saved = JSON.parse(raw);
      if (saved.ratings) dashboardState.ratings = saved.ratings;
      if (saved.currentTab) dashboardState.currentTab = saved.currentTab;
      if (saved.theme) dashboardState.theme = saved.theme;
      if (saved.dailyData) dashboardState.dailyData = saved.dailyData;
      // Restore calendar date properly
      if (saved.currentCalendarDate) {
        dashboardState.currentCalendarDate = new Date(saved.currentCalendarDate);
      }
    }
  } catch(e) {
    console.warn('Could not load state from localStorage:', e);
  }
}

/* ---------- Daily Data Management ---------- */
function getTodayDateString() {
  // Get local date string in YYYY-MM-DD format
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  return `--`;
}

function saveDailyRatings() {
  const today = getTodayDateString();
  if (!dashboardState.dailyData[today]) {
    dashboardState.dailyData[today] = {};
  }
  dashboardState.dailyData[today].ratings = { ...dashboardState.ratings };
  dashboardState.dailyData[today].timestamp = new Date().toISOString();
  saveState();
  
  // Always update calendar when ratings change, regardless of current tab
  setTimeout(() => {
    generateCalendar();
    updateCalendarStats();
  }, 100);
}

function getDailyData(dateStr) {
  return dashboardState.dailyData[dateStr] || null;
}

function saveNotes() {
  if (!dashboardState.selectedDay) return;
  const notes = document.getElementById('day-notes-input').value;
  const dateStr = dashboardState.selectedDay;
  
  if (!dashboardState.dailyData[dateStr]) {
    dashboardState.dailyData[dateStr] = {};
  }
  dashboardState.dailyData[dateStr].notes = notes;
  saveState();
  alert('Notes saved for ' + new Date(dateStr + 'T12:00:00').toLocaleDateString());
}

/* ---------- Theme ---------- */
function applyTheme() {
  const btn = document.getElementById('themeBtn');
  if (dashboardState.theme === 'dark') {
    document.body.setAttribute('data-theme','dark');
    if (btn) btn.textContent = '‚òÄÔ∏è';
  } else {
    document.body.removeAttribute('data-theme');
    if (btn) btn.textContent = 'üåô';
  }
}

/* ---------- DOM Ready ---------- */
document.addEventListener('DOMContentLoaded', () => {
  loadState();
  applyTheme();
  wireUpRatings();
  setInitialRatingsSelection();
  updateProgress();
  updateStatusIndicators();
  generateActionPlan();
  generateCalendar();
  
  // Save ratings only after the first user input (no auto-save on load)
  // saveDailyRatings();

  // Restore tab - improved logic
  restoreActiveTab();

  // Theme button handler
  const themeBtn = document.getElementById('themeBtn');
  if (themeBtn) {
    themeBtn.addEventListener('click', () => {
      dashboardState.theme = (dashboardState.theme === 'dark') ? 'light' : 'dark';
      applyTheme();
      saveState();
    });
  }

  // Modal click outside to close
  const modal = document.getElementById('reflectionModal');
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeReflection();
      }
    });
  }

  // Escape key to close modal
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal && modal.classList.contains('active')) {
      closeReflection();
    }
  });
});

function restoreActiveTab() {
  if (dashboardState.currentTab && dashboardState.currentTab !== 'overview') {
    const targetContent = document.getElementById(dashboardState.currentTab);
    if (targetContent) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      targetContent.classList.add('active');
      
      // Update tab buttons
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.setAttribute('aria-selected','false');
      });
      
      // Find and activate the correct tab button
      const tabBtn = Array.from(document.querySelectorAll('.nav-tab')).find(tab => {
        const onclick = tab.getAttribute('onclick');
        return onclick && onclick.includes(dashboardState.currentTab);
      });
      
      if (tabBtn) {
        tabBtn.classList.add('active');
        tabBtn.setAttribute('aria-selected','true');
      }
    }
  }
}

/* ---------- Tabs ---------- */
function switchTab(event, tabName) {
  // Remove active from all tabs
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
    tab.setAttribute('aria-selected','false');
  });
  
  // Add active to clicked tab
  if (event && event.currentTarget) {
    event.currentTarget.classList.add('active');
    event.currentTarget.setAttribute('aria-selected','true');
  }
  
  // Switch tab content
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  const targetTab = document.getElementById(tabName);
  if (targetTab) {
    targetTab.classList.add('active');
  }
  
  dashboardState.currentTab = tabName;
  saveState();
  
  // Special handling for calendar tab to ensure it renders properly
  if (tabName === 'progress-calendar') {
    setTimeout(() => {
      generateCalendar();
      updateCalendarStats();
    }, 50);
  }
}

/* ---------- Ratings ---------- */
function wireUpRatings() {
  document.querySelectorAll('.rating-button').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      const anchor = btn.dataset.anchor;
      const rating = parseInt(btn.dataset.rating, 10);
      
      if (!anchor || isNaN(rating)) return;
      
      dashboardState.ratings[anchor] = rating;

      // Update button selection for this anchor
      document.querySelectorAll(`.rating-button[data-anchor=""]`).forEach(b => {
        b.classList.toggle('selected', parseInt(b.dataset.rating,10) === rating);
      });

      updateProgress();
      updateStatusIndicators();
      generateActionPlan();
      saveDailyRatings(); // Save daily data when ratings change
      saveState();
    });
  });
}

function setInitialRatingsSelection() {
  Object.entries(dashboardState.ratings).forEach(([anchor, rating]) => {
    document.querySelectorAll(`.rating-button[data-anchor=""]`).forEach(btn => {
      btn.classList.toggle('selected', parseInt(btn.dataset.rating,10) === rating);
    });
  });
}

/* ---------- Overview Progress & Status ---------- */
function updateProgress() {
  Object.keys(dashboardState.ratings).forEach(anchor => {
    const percentage = Math.round((dashboardState.ratings[anchor] / 5) * 100);
    const el = document.getElementById(`-progress`);
    if (el) el.textContent = `%`;
  });
}

function updateStatusIndicators() {
  Object.keys(dashboardState.ratings).forEach(anchor => {
    const statusEl = document.getElementById(`-status`);
    if (!statusEl) return;
    statusEl.className = 'status-indicator';
    const r = dashboardState.ratings[anchor];
    if (r >= 4) statusEl.classList.add('good');
    else if (r >= 3) statusEl.classList.add('okay');
    else statusEl.classList.add('needs-attention');
  });
}

/* ---------- Action Plan (simple demo) ---------- */
function generateActionPlan() {
  const suggestions = {
    physical: '5-minute body scan + water',
    mental: 'Thought audit: name one noisy thought and one true thought',
    emotional: 'Name the core emotion; one gentle regulation breath',
    spiritual: '2-minute sacred pause: "God is with me."',
    relational: 'Send one honest, kind message to a safe person'
  };
  
  // Sort anchors from lowest-rated to highest-rated
  const allSorted = Object.entries(dashboardState.ratings)
    .sort((a, b) => a[1] - b[1]);
  
  const list = document.getElementById('actionList');
  if (!list) return;
  
  list.innerHTML = '';
  
  // Display all anchors regardless of rating
  allSorted.forEach(([anchor, rating]) => {
    const div = document.createElement('div');
    div.className = 'action-item';
    div.innerHTML = `
      <input type="checkbox" class="action-checkbox">
      <div class="action-content">
        <div class="action-title"> Focus (rated /5)</div>
        <div class="action-description"></div>
      </div>`;
    list.appendChild(div);
  });
}

/* ---------- Quick Practices ---------- */
function quickPractice(anchor) {
  const practices = {
    physical: "Take 3 slow breaths and scan from head to toe. Release one area of tension.",
    mental: "Write one sentence of what's true right now. Let go of the rest.",
    emotional: 'Name it without judgment: "I feel _____." Breathe once into that truth.',
    spiritual: 'Whisper: "God, steady me." Sit for 60 seconds in quiet.',
    relational: "Offer one honest check-in to a safe person, or set one clean boundary."
  };
  
  const practice = practices[anchor];
  if (practice) {
    // Create a more user-friendly modal instead of alert
    showPracticeModal(anchor, practice);
  } else {
    alert('Take a gentle next step.');
  }
}

function showPracticeModal(anchor, practice) {
  // Create modal elements
  const modal = document.createElement('div');
  modal.className = 'modal active';
  modal.setAttribute('aria-hidden', 'false');
  modal.setAttribute('role', 'dialog');
  
  const anchorColors = {
    physical: 'var(--physical-color)',
    mental: 'var(--mental-color)', 
    emotional: 'var(--emotional-color)',
    spiritual: 'var(--spiritual-color)',
    relational: 'var(--relational-color)'
  };
  
  const anchorIcons = {
    physical: 'üß≠',
    mental: 'üîç',
    emotional: 'ü©∑',
    spiritual: '‚ú®',
    relational: 'üåê'
  };
  
  modal.innerHTML = `
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">  Quick Practice</h3>
        <button class="modal-close" onclick="closePracticeModal()" aria-label="Close practice">√ó</button>
      </div>
      <div style="text-align: center; padding: 20px 0;">
        <div style="background: var(--accent-color); border-left: 4px solid ; border-radius: 8px; padding: 20px; margin: 20px 0; line-height: 1.6; font-size: 1.1rem;">
          
        </div>
        <button class="btn btn-primary " onclick="closePracticeModal()" style="margin-top: 16px;">Got it! ‚úì</button>
      </div>
    </div>
  `;
  
  // Add to page
  document.body.appendChild(modal);
  
  // Focus management
  const closeBtn = modal.querySelector('.modal-close');
  if (closeBtn) closeBtn.focus();
  
  // Click outside to close
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closePracticeModal();
    }
  });
  
  // Escape key to close
  const escapeHandler = (e) => {
    if (e.key === 'Escape') {
      closePracticeModal();
      document.removeEventListener('keydown', escapeHandler);
    }
  };
  document.addEventListener('keydown', escapeHandler);
  
  // Store reference for cleanup
  modal._escapeHandler = escapeHandler;
}

function closePracticeModal() {
  const modal = document.querySelector('.modal:not(#reflectionModal)');
  if (modal) {
    // Remove escape handler
    if (modal._escapeHandler) {
      document.removeEventListener('keydown', modal._escapeHandler);
    }
    modal.remove();
  }
}

/* ---------- Crisis Buttons ---------- */
function emergencyGrounding() { 
  alert('Grounding: Feel your feet. Name 5 things you see, 4 you feel, 3 you hear, 2 you smell, 1 you taste.'); 
}

function breathingProtocol() { 
  alert('Breathing: In 4 ‚Ä¢ Hold 4 ‚Ä¢ Out 6 ‚Ä¢ Repeat x4.'); 
}

function sacredPause() { 
  openReflection(); 
}

function crisisSupport() {
  alert("Reach out to a trusted person or local support line. You're not alone.");
}

/* ---------- Reflection Modal ---------- */
function openReflection() {
  const m = document.getElementById('reflectionModal');
  if (m) {
    m.classList.add('active');
    m.setAttribute('aria-hidden','false');
    // Focus management for accessibility
    const closeBtn = m.querySelector('.modal-close');
    if (closeBtn) closeBtn.focus();
  }
}

function closeReflection() {
  const m = document.getElementById('reflectionModal');
  if (m) {
    m.classList.remove('active');
    m.setAttribute('aria-hidden','true');
  }
}

/* ---------- Calendar Functions ---------- */
function generateCalendar() {
  const year = dashboardState.currentCalendarDate.getFullYear();
  const month = dashboardState.currentCalendarDate.getMonth();
  
  // Update month/year display
  const monthNames = ["January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"];
  
  const monthYearEl = document.getElementById('calendar-month-year');
  if (monthYearEl) {
    monthYearEl.textContent = ` `;
  }
  
  // Get first day of month and number of days
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const daysInMonth = lastDay.getDate();
  const startingDay = firstDay.getDay();
  
  const grid = document.getElementById('calendar-grid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  // Add empty cells for days before month starts
  for (let i = 0; i < startingDay; i++) {
    const prevMonth = new Date(year, month, 0);
    const dayNum = prevMonth.getDate() - startingDay + i + 1;
    const dayEl = createCalendarDay(dayNum, true, year, month - 1);
    grid.appendChild(dayEl);
  }
  
  // Add days of current month
  for (let day = 1; day <= daysInMonth; day++) {
    const dayEl = createCalendarDay(day, false, year, month);
    grid.appendChild(dayEl);
  }
  
  // Add days from next month to fill grid
  const totalCells = grid.children.length;
  const remainingCells = Math.min(42 - totalCells, 14); // 6 rows √ó 7 days, max 2 weeks
  for (let day = 1; day <= remainingCells; day++) {
    const dayEl = createCalendarDay(day, true, year, month + 1);
    grid.appendChild(dayEl);
  }
  
  updateCalendarStats();
}

function createCalendarDay(dayNum, isOtherMonth, year, month) {
  const dayEl = document.createElement('div');
  dayEl.className = 'calendar-day';
  if (isOtherMonth) dayEl.classList.add('other-month');
  
  // Calculate the actual date for this day
  let actualYear = year;
  let actualMonth = month;
  
  if (isOtherMonth) {
    if (actualMonth < 0) {
      actualMonth = 11;
      actualYear = year - 1;
    } else if (actualMonth > 11) {
      actualMonth = 0;
      actualYear = year + 1;
    }
  }
  
  const dateStr = `--`;
  
  // Check if this is today
  const today = getTodayDateString();
  if (dateStr === today) {
    dayEl.classList.add('today');
  }
  
  // Check if we have data for this day
  const dayData = getDailyData(dateStr);
  if (dayData && dayData.ratings) {
    dayEl.classList.add('has-data');
    const avg = Object.values(dayData.ratings).reduce((a, b) => a + b, 0) / 5;
    dayEl.style.opacity = Math.max(0.6, 0.6 + (avg / 5) * 0.4); // Visual intensity based on average
  }
  
    const hasRatings = !!(dayData && dayData.ratings);
  const hasNote = !!(dayData && dayData.notes && dayData.notes.trim().length);
  if (hasRatings) dayEl.classList.add('has-data');
  if (hasNote) dayEl.classList.add('has-note');
  if (!hasRatings && hasNote) dayEl.classList.add('note-only');
  if (hasRatings) {
    const avg = Object.values(dayData.ratings).reduce((a, b) => a + b, 0) / 5;
    dayEl.style.opacity = Math.max(0.6, 0.6 + (avg / 5) * 0.4);
  }
  dayEl.innerHTML = `
    <div class="day-number"></div>
    
    
  `;
dayEl.setAttribute('data-date', dateStr);
  dayEl.setAttribute('tabindex', '0'); // Make focusable
  dayEl.setAttribute('role', 'button');
  dayEl.setAttribute('aria-label', `View details for `);
  
  // Click handler
  const clickHandler = (e) => {
    e.preventDefault();
    e.stopPropagation();
    const clickedDate = e.currentTarget.getAttribute('data-date');
    const clickedData = getDailyData(clickedDate);
    selectDay(clickedDate, clickedData);
  };
  
  // Keyboard handler
  const keyHandler = (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      clickHandler(e);
    }
  };
  
  dayEl.addEventListener('click', clickHandler);
  dayEl.addEventListener('keydown', keyHandler);
  
  return dayEl;
}


/* ---------- Day Detail Rating Editor ---------- */
function toggleRatingEditor(show) {
  const ed = document.getElementById('rating-editor');
  const btn = document.getElementById('edit-ratings-btn');
  if (!ed || !btn) return;
  ed.style.display = show ? 'block' : 'none';
  btn.style.display = show ? 'none' : 'inline-block';
}

function initRatingEditor(dayData) {
  const ed = document.getElementById('rating-editor');
  if (!ed) return;
  // Clear selected states
  ed.querySelectorAll('.pill').forEach(p => p.classList.remove('pill-selected'));
  // Pre-select if data exists
  const ratings = dayData && dayData.ratings ? dayData.ratings : null;
  if (ratings) {
    Object.entries(ratings).forEach(([k, v]) => {
      const pill = ed.querySelector(`.pill[data-anchor=""][data-value=""]`);
      if (pill) pill.classList.add('pill-selected');
    });
  }
  // Click behavior
  ed.querySelectorAll('.pill').forEach(pill => {
    pill.onclick = () => {
      const anchor = pill.getAttribute('data-anchor');
      ed.querySelectorAll(`.pill[data-anchor=""]`).forEach(x => x.classList.remove('pill-selected'));
      pill.classList.add('pill-selected');
    };
  });
}

function collectEditorRatings() {
  const ed = document.getElementById('rating-editor');
  const anchors = ['physical','mental','emotional','spiritual','relational'];
  const ratings = {};
  let complete = true;
  anchors.forEach(a => {
    const sel = ed.querySelector(`.pill[data-anchor=""].pill-selected`);
    if (sel) {
      ratings[a] = parseInt(sel.getAttribute('data-value'), 10);
    } else {
      complete = false;
    }
  });
  return { ratings, complete };
}
function selectDay(dateStr, dayData) {
  // Update selected day
  dashboardState.selectedDay = dateStr;
  
  // Update visual selection
  document.querySelectorAll('.calendar-day').forEach(day => day.classList.remove('selected'));
  
  // Find and select the clicked day
  const clickedDay = document.querySelector(`[data-date=""]`);
  if (clickedDay) {
    clickedDay.classList.add('selected');
  }
  
  // Show day detail - with better error handling
  const detailEl = document.getElementById('day-detail');
  if (!detailEl) {
    console.error('day-detail element not found');
    return;
  }
  
  
detailEl.style.display = 'block';
  const hint = document.getElementById('no-ratings-hint');
  if (hint) { hint.style.display = (dayData && dayData.ratings) ? 'none' : 'block'; }
  // Init editor controls
  const editBtn = document.getElementById('edit-ratings-btn');
  if (editBtn) {
    editBtn.onclick = () => { initRatingEditor(dayData); toggleRatingEditor(true); };
    toggleRatingEditor(false);
  }
  const saveBtn = document.getElementById('save-day-ratings');
  if (saveBtn) {
    saveBtn.onclick = () => {
      const { ratings, complete } = collectEditorRatings();
      if (!complete) { alert('Please select a value (1‚Äì5) for each anchor.'); return; }
      const dateStr = dashboardState.selectedDay;
      if (!dashboardState.dailyData[dateStr]) { dashboardState.dailyData[dateStr] = {}; }
      dashboardState.dailyData[dateStr].ratings = ratings;
      dashboardState.dailyData[dateStr].timestamp = new Date().toISOString();
      saveState();
      // Refresh UI
      generateCalendar();
      updateCalendarStats();
      // Re-render detail with updated data
      selectDay(dateStr, dashboardState.dailyData[dateStr]);
      // Hide editor
      toggleRatingEditor(false);
      alert('Ratings updated.');
    };
  }
  const cancelBtn = document.getElementById('cancel-edit-ratings');
  if (cancelBtn) {
    cancelBtn.onclick = () => { toggleRatingEditor(false); };
  }
// Init editor controls
  const editBtn = document.getElementById('edit-ratings-btn');
  if (editBtn) {
    editBtn.onclick = () => { initRatingEditor(dayData); toggleRatingEditor(true); };
    toggleRatingEditor(false);
  }
  const saveBtn = document.getElementById('save-day-ratings');
  const cancelBtn = document.getElementById('cancel-edit-ratings');
  if (saveBtn) {
    saveBtn.onclick = () => {
      const { ratings, complete } = collectEditorRatings();
      if (!complete) { alert('Please pick a value 1‚Äì5 for each anchor.'); return; }
      const dateStr = dashboardState.selectedDay;
      if (!dashboardState.dailyData[dateStr]) dashboardState.dailyData[dateStr] = {};
      dashboardState.dailyData[dateStr].ratings = ratings;
      dashboardState.dailyData[dateStr].timestamp = new Date().toISOString();
      saveState();
      generateCalendar();
      updateCalendarStats();
      // reflect in detail view
      Object.keys(ratings).forEach(anchor => {
        const el = document.getElementById(`detail-`);
        if (el) el.textContent = `/5`;
      });
      toggleRatingEditor(false);
      alert('Ratings updated.');
    };
  }
  if (cancelBtn) {
    cancelBtn.onclick = () => toggleRatingEditor(false);
  }
  
  // Update date display
  const date = new Date(dateStr + 'T12:00:00'); // Add time to avoid timezone issues
  const dateEl = document.getElementById('detail-date');
  if (dateEl) {
    dateEl.textContent = date.toLocaleDateString('en-US', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });
  } else {
    console.error('detail-date element not found');
  }
  
  // Update ratings display
  if (dayData && dayData.ratings) {
    Object.keys(dayData.ratings).forEach(anchor => {
      const el = document.getElementById(`detail-`);
      if (el) {
        el.textContent = `/5`;
      } else {
        console.error(`detail- element not found`);
      }
    });
    
    const notesInput = document.getElementById('day-notes-input');
    if (notesInput) {
      notesInput.value = dayData.notes || '';
    } else {
      console.error('day-notes-input element not found');
    }
  } else {
    // No data for this day - show empty state
    ['physical', 'mental', 'emotional', 'spiritual', 'relational'].forEach(anchor => {
      const el = document.getElementById(`detail-`);
      if (el) {
        el.textContent = '‚Äî';
      }
    });
    
    const notesInput = document.getElementById('day-notes-input');
    if (notesInput) {
      notesInput.value = (dayData && dayData.notes) ? dayData.notes : '';
    }
  }
  
  // Scroll to the detail section smoothly
  setTimeout(() => {
    detailEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    // Flash highlight
    detailEl.classList.remove('flash-once');
    void detailEl.offsetWidth; // reflow to restart animation
    detailEl.classList.add('flash-once');
  }, 100);
}


function changeMonth(direction) {
  dashboardState.currentCalendarDate.setMonth(dashboardState.currentCalendarDate.getMonth() + direction);
  generateCalendar();
  saveState(); // Save the calendar date change
}

function updateCalendarStats() {
  const year = dashboardState.currentCalendarDate.getFullYear();
  const month = dashboardState.currentCalendarDate.getMonth();
  
  // Get all days in current month that have data
  const monthData = Object.entries(dashboardState.dailyData)
    .filter(([dateStr, data]) => {
      const date = new Date(dateStr + 'T12:00:00');
      return date.getFullYear() === year && date.getMonth() === month && data.ratings;
    })
    .map(([dateStr, data]) => ({ date: dateStr, ...data }));
  
  if (monthData.length === 0) {
    // No data for this month
    ['physical', 'mental', 'emotional', 'spiritual', 'relational'].forEach(anchor => {
      const el = document.getElementById(`avg-`);
      if (el) el.textContent = '‚Äî';
    });
    const bestDayEl = document.getElementById('best-day');
    if (bestDayEl) bestDayEl.textContent = '‚Äî';
    return;
  }
  
  // Calculate averages
  const anchors = ['physical', 'mental', 'emotional', 'spiritual', 'relational'];
  anchors.forEach(anchor => {
    const ratings = monthData.map(day => day.ratings[anchor]).filter(rating => rating !== undefined);
    if (ratings.length > 0) {
      const avg = ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length;
      const el = document.getElementById(`avg-`);
      if (el) el.textContent = avg.toFixed(1);
    }
  });
  
  
  // Find best day(s) (highest total score, show ties)
  let bestScore = -Infinity;
  const bestDays = [];
  monthData.forEach(day => {
    if (day.ratings) {
      const total = Object.values(day.ratings).reduce((a, b) => a + b, 0);
      if (total > bestScore) {
        bestScore = total;
        bestDays.length = 0;
        bestDays.push(day);
      } else if (total === bestScore) {
        bestDays.push(day);
      }
    }
  });
  const bestDayEl = document.getElementById('best-day');
  if (bestDayEl) {
    if (bestDays.length === 0) {
      bestDayEl.textContent = '‚Äî';
    } else {
      const labels = bestDays.map(d => new Date(d.date + 'T12:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
      bestDayEl.textContent = labels.length <= 2 ? labels.join(' & ') : labels.slice(0,2).join(' & ') + ` (+)`;
    }
  }
}

/* ---------- Export Function ---------- */
function exportData() {
  const data = {
    exportedAt: new Date().toISOString(),
    ratings: dashboardState.ratings,
    dailyData: dashboardState.dailyData,
    currentTab: dashboardState.currentTab,
    theme: dashboardState.theme
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; 
  a.download = `five-anchors-dashboard-.json`;
  document.body.appendChild(a); 
  a.click(); 
  a.remove();
  URL.revokeObjectURL(url);
}

/* ---------- Debug Function - Remove this after testing ---------- */
function debugCalendar() {
  console.log('=== DEBUG CALENDAR FUNCTION ===');
  const detailEl = document.getElementById('day-detail');
  console.log('day-detail element:', detailEl);
  if (detailEl) {
    console.log('Current display style:', getComputedStyle(detailEl).display);
    console.log('Current visibility:', getComputedStyle(detailEl).visibility);
    console.log('Element innerHTML:', detailEl.innerHTML.substring(0, 200));
    
    // Force show the element for testing
    detailEl.style.display = 'block';
    detailEl.style.visibility = 'visible';
    detailEl.style.opacity = '1';
    console.log('Forced element to show - check if it appears');
  } else {
    console.log('ERROR: day-detail element not found in DOM');
  }
  console.log('=== END DEBUG ===');
}

// Make debugCalendar available globally for testing
if (typeof window !== 'undefined') {
  window.debugCalendar = debugCalendar;
}
</script>
</body>
</html>