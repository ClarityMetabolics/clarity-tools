<!--
  ============================================================
  Clarity Metabolics - Belief Threader: From Autopilot to Intentional Living
  Interactive Web Tool for Examining Crystallized Thoughts and Beliefs
  ============================================================
  
  Version: 2.2.1 (Step Counter Correction)
  Created: August 2025
  Author: Clarity Metabolics
  
  Key Updates:
  - Fixed step counters to show correct "X of 7" progression
  - Professional, solution-focused language throughout
  - Consistent 4-part framework: Lead/Label/Helper/Clue
  - Fixed button functionality for Step 6
  - Belief Insights modal with educational content
  
  ============================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>🧵 Belief Threader — From Autopilot to Intentional Living</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --main-color:#7A94A8;      /* discernment blue-gray */
    --accent-color:#E7EEF1;    /* soft panels */
    --contrast-color:#4A5A6A;  /* deep accent text/borders */
    --text-color:#333;
    --bg-color:#fff;
    --border-color:#d9d6cf;
    --shadow:0 2px 12px rgba(0,0,0,.08);
    --success-color:#5a7c41;   /* progress dots done */
    --warning-color:#dc3545;   /* Start Over confirm */
    --green-panel:#E5EBDD;
    --yellow-panel:#FFF8CC;
    --red-panel:#F5E6E6;
  }
  [data-theme="dark"]{
    --text-color:#e6e6e6;
    --bg-color:#1c1c1c;
    --border-color:#3b3a36;
    --accent-color:#2a2825;
    --shadow:0 2px 14px rgba(0,0,0,.35);
    --green-panel:#2d352a;
    --yellow-panel:#3a3620;
    --red-panel:#3a2828;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Open Sans',sans-serif;
    color:var(--text-color);
    background:var(--bg-color);
    line-height:1.6;
  }
  .container{max-width:780px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

  /* Header */
  .header{
    color:#fff;
    background:linear-gradient(135deg,var(--main-color),var(--contrast-color));
    padding:22px 18px 18px;
    position:relative;
    transition: box-shadow .5s ease;
  }
  .header.completed{ box-shadow:0 0 18px rgba(122,148,168,.55); }
  .header h1{
    font-family:'Libre Baskerville',serif;
    font-size:2rem;
    text-align:center;
    margin-bottom:6px;
  }
  .subtitle{ text-align:center; font-style:italic; opacity:.95; }

  .header-controls{ position:absolute; top:10px; right:10px; display:flex; gap:8px }
  .header-btn{
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.3);
    color:#fff;
    padding:.35rem .6rem;border-radius:18px;cursor:pointer;
    font-size:.8rem;transition:all .2s ease;
  }
  .header-btn:hover{background:rgba(255,255,255,.25)}

  .progress-bar{height:4px;background:rgba(255,255,255,.28);border-radius:3px;margin-top:14px;overflow:hidden}
  .progress-fill{height:100%;background:#fff;width:0%;transition:width .6s ease}

  /* Content & steps */
  main.content{flex:1;padding:22px}
  .step{display:none;animation:fade .25s ease}
  .step.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .step-indicator{ text-align:center; margin:10px 0 18px }
  .step-counter{font-weight:700;color:#ffffff; background:var(--contrast-color); display:inline-block; padding:4px 10px; border-radius:12px }
  .dots{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--border-color)}
  .dot.active{background:var(--main-color)}
  .dot.done{background:var(--success-color)}

  h2{font-family:'Libre Baskerville',serif;color:var(--main-color);font-size:1.7rem;margin:14px 0 10px}
  h2 .subtitle{font-weight:400;font-style:italic;opacity:0.7;font-size:1.1rem}
  p.lead{opacity:.95;margin-bottom:10px}

  .tip{
    background:linear-gradient(135deg, rgba(122,148,168,.12), rgba(74,90,106,.06));
    border-left:4px solid var(--main-color);
    padding:12px;border-radius:0 8px 8px 0;margin:14px 0;font-style:italic
  }

  .form-group{margin:16px 0}
  label{display:block;font-weight:700;color:var(--contrast-color);margin-bottom:6px}
  textarea, input[type="text"]{
    width:100%;min-height:110px;resize:vertical;border:2px solid var(--border-color);
    border-radius:10px;padding:12px;font:inherit;color:inherit;background:var(--bg-color);
    transition:all .2s ease;
  }
  input[type="text"]{ min-height:auto; }
  textarea:focus, input[type="text"]:focus{
    outline:none;border-color:var(--main-color);box-shadow:0 0 0 3px rgba(122,148,168,.18)
  }

  /* Enhanced Character Count */
  .char-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    font-size: 0.85rem;
  }
  
  .char-count {
    color: var(--text-color);
    opacity: 0.7;
  }
  
  .encouragement {
    color: var(--main-color);
    font-style: italic;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .encouragement.show {
    opacity: 1;
  }

  /* Buttons */
  .nav-row{display:flex;gap:12px;align-items:center;margin-top:22px;padding-top:18px;border-top:1px solid var(--border-color)}
  .nav-row .btn{flex:1}
  .btn{
    border:none;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;
    transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--main-color);color:#fff}
  .btn-primary:hover{background:var(--contrast-color);box-shadow:var(--shadow);transform:translateY(-1px)}
  .btn-secondary{background:var(--accent-color);color:var(--contrast-color);border:1px solid var(--border-color)}
  .btn-secondary:hover{background:var(--border-color)}
  .btn-warning{background:var(--warning-color);color:#fff}
  .btn-warning:hover{background:#c82333}
  .btn:disabled{background:var(--border-color);color:var(--text-color);opacity:0.6;cursor:not-allowed;transform:none}

  .micro{ text-align:center; margin-top:6px; font-style:italic; color:var(--contrast-color); opacity:.85 }

  /* Final actions */
  .final-actions{
    display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;
  }
  .final-actions .btn{ display:block; width:100%; max-width:280px; min-height:50px; text-align:center; }

  /* Trinity Modal Styles */
  .modal{
    position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000;
  }
  .modal-content{
    background:var(--bg-color);color:var(--text-color);max-width:600px;width:100%;max-height:90vh;
    border-radius:12px;box-shadow:var(--shadow);padding:24px;overflow-y:auto;
  }
  .modal h3{
    font-family:'Libre Baskerville',serif;color:var(--main-color);margin-bottom:16px;font-size:1.4rem;
  }
  .trinity-section{
    margin-bottom:20px;padding:16px;background:var(--accent-color);border-radius:8px;
  }
  .trinity-role{
    font-size:1.1rem;font-weight:700;color:var(--main-color);margin-bottom:8px;
  }
  .scripture{
    font-style:italic;background:var(--accent-color);padding:16px;border-left:4px solid var(--main-color);
    border-radius:8px;margin:16px 0;text-align:center;
  }

  /* Branding */
  .branding{ text-align:center; padding:18px; font-size:.85rem; color:var(--text-color); opacity:.75; border-top:1px solid var(--border-color) }
  .branding a{ color:var(--contrast-color); text-decoration:none }
  .branding a:hover{ text-decoration:underline }

  @media (max-width:640px){
    .nav-row{flex-direction:column}
    .btn{width:100%}
    .header h1{font-size:1.7rem}
  }

  @media (prefers-reduced-motion: reduce) {
    .step { animation: none; }
    .progress-fill { transition: none; }
    .btn { transition: none; }
  }
</style>
</head>
<body>
<div id="pageTop" style="position:absolute;top:0"></div>
<div class="container">

  <header class="header" id="mainHeader">
    <div class="header-controls">
      <button class="header-btn" id="themeBtn" aria-label="Toggle light and dark theme" title="Toggle theme">🌙</button>
    </div>
    <h1>🧵 Belief Threader — From Autopilot to Intentional Living</h1>
    <p class="subtitle">You don't have to carry beliefs that weren't meant for you.</p>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </header>

  <main class="content">
    <!-- STEP 0: Welcome -->
    <section class="step active" data-step="0">
      <div class="step-indicator">
        <div class="step-counter">Step 1 of 7</div>
        <div class="dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🧵 Why Examine Your Beliefs?</h2>
      
      <p style="margin: 16px 0; line-height: 1.7;">Beliefs can feel all interconnected and garbled - like they're tied in knots. It's hard to see where one ends and another begins. But here's what helps: following just one thread. When you gently follow one belief thread, you can start to untangle the mess without pulling everything apart at once.</p>
      
      <div class="tip">
        <strong>How this works:</strong> We'll follow one belief thread that doesn't feel quite right. We'll trace where it came from, learn why you might have needed it at the time, see how it affects you now, and discover what feels more aligned with truth.
      </div>
      
      <p style="margin: 20px 0; line-height: 1.7;">Like going through your closet with a friend, deciding what still fits and what you've outgrown. So take a deep, full breath to settle in, and when you're ready, let's begin.</p>
      
      <p style="font-style: italic; color: var(--main-color); font-weight: 500; text-align: center; margin: 20px 0;">What belief thread feels tangled or doesn't quite fit anymore?</p>
      
      <div class="nav-row"><button class="btn btn-primary" onclick="nextStep()">Begin Examination →</button></div>
      <div class="micro">This is your journey toward intentional belief.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 1: What belief feels off? -->
    <section class="step" data-step="1">
      <div class="step-indicator">
        <div class="step-counter">Step 2 of 7</div>
        <div class="dots"><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🎯 What Belief Feels Off? <span class="subtitle">— When something doesn't align with truth</span></h2>
      <p class="lead">There's probably a belief you hold that sounds reasonable when you say it, but something about it doesn't align with what you know to be true. Maybe it creates pressure you can't name, or limits you in ways that feel smaller than what God intended for your life.</p>

      <!-- Optional Overflow Section for Crisis Moments -->
      <div style="margin: 20px 0; padding: 16px; background: rgba(122,148,168,0.05); border-radius: 10px; border-left: 3px solid var(--main-color);">
        <div style="cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 12px;" onclick="toggleOverflow()">
          <span style="font-weight: 600; color: var(--main-color);">Feeling overwhelmed about your beliefs? Start here</span>
          <span id="overflowToggle" style="color: var(--main-color); font-size: 1.2rem;">↓</span>
        </div>
        <div id="overflowSection" style="display: none;">
          <p style="font-size: 0.9rem; font-style: italic; color: var(--contrast-color); margin-bottom: 12px;">If examining beliefs feels overwhelming right now - like maybe everything you've believed is tangled - use this space to get that out. We're just looking at one thread, not pulling apart your whole foundation. This won't appear in your summary.</p>
          <textarea id="overflowDump" placeholder="If you're feeling like your whole belief system is a mess, write about that here. Get it out so you can focus on just one thread..." style="width:100%; min-height:120px; resize:vertical; border:2px solid var(--border-color); border-radius:10px; padding:12px; font:inherit; color:inherit; background:var(--bg-color); transition:all .2s ease; opacity: 0.8;"></textarea>
          <p style="font-size: 0.8rem; color: var(--text-color); opacity: 0.6; margin-top: 8px; text-align: center;">When you're ready, continue below to follow just one belief thread.</p>
        </div>
      </div>

      <div class="form-group">
        <label for="beliefFeelsOff">What specific belief keeps coming to mind - one that doesn't seem to align with what you sense is true?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Look for beliefs that create "shoulds," pressure, or seem to contradict God's character of love and freedom</p>
        <textarea id="beliefFeelsOff" placeholder="Write about the belief that doesn't feel aligned with truth - even if you think you 'should' believe it..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count1">0 characters</div>
          <div class="encouragement" id="enc1">Sometimes what sounds right doesn't align with truth.</div>
        </div>
      </div>

      <div class="tip"><strong>Clue:</strong> Often these are beliefs we inherited from family, absorbed from culture or tradition, or picked up from media and education.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()" id="next1" disabled>Share your observations to continue</button>
      </div>
      <div class="micro">Sometimes the most obvious beliefs are the hardest to see clearly.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 2: Where did it come from? -->
    <section class="step" data-step="2">
      <div class="step-indicator">
        <div class="step-counter">Step 3 of 7</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🌱 Where Did It Come From? <span class="subtitle">— Every story has a beginning</span></h2>
      <p class="lead">Some beliefs feel so natural we forget they were ever learned. But every automatic thought pattern has a history - specific moments when it first made sense to think this way. Tracing that history helps you see whether this belief still fits your current reality or if it's operating on outdated information.</p>

      <div class="form-group">
        <label for="beliefOrigins">Can you trace this belief back to its source? When did this way of thinking first become necessary or logical?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Look for specific moments, repeated messages, or gradually absorbed assumptions</p>
        <textarea id="beliefOrigins" placeholder="Trace the origins of this belief - where and how did it first take root?"></textarea>
        <div class="char-info">
          <div class="char-count" id="count2">0 characters</div>
          <div class="encouragement" id="enc2">Context reveals whether old logic still applies to your current life.</div>
        </div>
      </div>

      <div class="tip"><strong>Clue:</strong> Look for patterns - Whose voices do you hear when this belief speaks? What circumstances or emotions might have made this belief feel necessary or safe to adopt?</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()" id="next2" disabled>Complete the origin analysis to continue</button>
      </div>
      <div class="micro">What made sense then might not serve you now.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 3: What does it protect? -->
    <section class="step" data-step="3">
      <div class="step-indicator">
        <div class="step-counter">Step 4 of 7</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🛡️ What Does It Protect? <span class="subtitle">— Understanding the purpose behind beliefs</span></h2>
      <p class="lead">Beliefs that limit us today often started as solutions to yesterday's problems. Every restrictive thought pattern usually has a protective job - even if that job is outdated. To understand why this belief has staying power, you need to identify what it's been hired to do.</p>

      <div class="form-group">
        <label for="beliefProtects">What job has this belief been doing for you? What would feel risky or dangerous if you stopped thinking this way?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Look for what this belief prevents, avoids, or keeps at bay</p>
        <textarea id="beliefProtects" placeholder="What has this belief been shielding you from experiencing or risking?"></textarea>
        <div class="char-info">
          <div class="char-count" id="count3">0 characters</div>
          <div class="encouragement" id="enc3">Understanding the protective function helps clarify its purpose.</div>
        </div>
      </div>

      <div class="tip"><strong>Clue:</strong> Listen for the belief's job description - does it manage expectations, control risks, avoid judgment, prevent failure, or maintain safety? Notice what it's trying to spare you from experiencing.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()" id="next3" disabled>Complete the protection analysis to continue</button>
      </div>
      <div class="micro">Protection can become limitation when circumstances change.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 4: How does it limit you? -->
    <section class="step" data-step="4">
      <div class="step-indicator">
        <div class="step-counter">Step 5 of 7</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🚧 How Does It Limit You? <span class="subtitle">— When protection becomes restriction</span></h2>
      <p class="lead">Now that you know what job this belief was hired to do, it's time to evaluate its current performance. Sometimes beliefs keep doing their protective job even when the original threat is gone - creating roadblocks where you need open roads.</p>

      <div class="form-group">
        <label for="beliefDistorts">Where has this belief become a roadblock rather than protection? What opportunities, growth, or authentic expression does it prevent?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Look for areas where the belief creates 'no' when you might want 'yes' or 'maybe'</p>
        <textarea id="beliefDistorts" placeholder="How does this belief limit or restrict you now, even if it once served a purpose?"></textarea>
        <div class="char-info">
          <div class="char-count" id="count4">0 characters</div>
          <div class="encouragement" id="enc4">Recognizing limitations is the first step toward greater freedom.</div>
        </div>
      </div>

      <div class="tip"><strong>Clue:</strong> Notice where the belief acts like an overprotective security guard - blocking healthy risks, shrinking your capabilities, avoiding growth opportunities, or keeping your self-image smaller than reality.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()" id="next4" disabled>Complete the limitation analysis to continue</button>
      </div>
      <div class="micro">What once protected can sometimes restrict when circumstances change.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 5: Alternative Perspective -->
    <section class="step" data-step="5">
      <div class="step-indicator">
        <div class="step-counter">Step 6 of 7</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div></div>
      </div>
      <h2>✨ Alternative Perspective <span class="subtitle">— What would you choose from truth rather than fear?</span></h2>
      <p class="lead">Now that you've reviewed this belief's job performance, it's time to consider what you'd hire instead. This isn't about forcing change, but about consciously choosing what thoughts you want working for you going forward - beliefs hired for growth rather than just protection.</p>

      <div class="form-group">
        <label for="trueBelief">If you were hiring a new belief for this area of your life, what qualities would you want? What would you choose if you prioritized growth over safety?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Look for beliefs that create possibility rather than restriction, expansion rather than contraction</p>
        <textarea id="trueBelief" placeholder="What alternative belief or perspective feels more true and life-giving?"></textarea>
        <div class="char-info">
          <div class="char-count" id="count5">0 characters</div>
          <div class="encouragement" id="enc5">Truth-based beliefs create space for growth and possibility.</div>
        </div>
      </div>

      <div class="tip"><strong>Clue:</strong> Listen for beliefs that sound like a good coach rather than an overprotective parent - ones that encourage healthy risks, expand your capabilities, and trust your potential for growth.</div>

      <div style="text-align:center;margin:20px 0;">
        <button class="btn btn-primary" onclick="openExaminationModal()" style="box-shadow: 0 0 20px rgba(122,148,168,0.5), 0 4px 15px rgba(122,148,168,0.3);">Belief Insights</button>
      </div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()" id="next5" disabled>Consider alternatives to continue</button>
      </div>
      <div class="micro">Choosing beliefs consciously is different from inheriting them unconsciously.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 6: Summary & Integration -->
    <section class="step" data-step="6">
      <div class="step-indicator">
        <div class="step-counter">Step 7 of 7</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div></div>
      </div>
      <h2>🧵 Examination Complete</h2>
      <p class="lead">You've completed a thorough examination of a belief that was operating on autopilot in your life. You've traced its origins, understood its protective purpose, identified its limitations, and considered alternatives. Below is a summary of your belief examination process.</p>

      <div style="background:var(--accent-color);padding:20px;border-radius:10px;margin:20px 0">
        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-bottom:15px">Your Belief Examination Summary</h3>
        
        <div style="margin-bottom:15px">
          <strong style="color:var(--main-color)">The Belief Examined:</strong>
          <p id="sumBeliefOff" style="margin:5px 0 0 15px;font-style:italic">—</p>
        </div>
        
        <div style="margin-bottom:15px">
          <strong style="color:var(--main-color)">Origins:</strong>
          <p id="sumOrigins" style="margin:5px 0 0 15px;font-style:italic">—</p>
        </div>
        
        <div style="margin-bottom:15px">
          <strong style="color:var(--main-color)">Protective Purpose:</strong>
          <p id="sumProtects" style="margin:5px 0 0 15px;font-style:italic">—</p>
        </div>
        
        <div style="margin-bottom:15px">
          <strong style="color:var(--main-color)">Current Limitations:</strong>
          <p id="sumDistorts" style="margin:5px 0 0 15px;font-style:italic">—</p>
        </div>
        
        <div>
          <strong style="color:var(--main-color)">Alternative Perspective:</strong>
          <p id="sumTrueBelief" style="margin:5px 0 0 15px;font-style:italic">—</p>
        </div>
      </div>

      <div class="form-group">
        <label for="finalReflection">What insights emerged from this examination? How do you want to apply this understanding?</label>
        <textarea id="finalReflection" placeholder="My key insights and next steps..." style="margin-top: 1rem;"></textarea>
        <div class="char-info">
          <div class="char-count" id="count6">0 characters</div>
          <div class="encouragement" id="enc6">Integration and application are where real change happens.</div>
        </div>
      </div>

      <div class="final-actions">
        <button class="btn btn-primary" onclick="downloadSummary()">📄 Download Summary</button>
        <button class="btn btn-secondary" onclick="openTrinityModal()">✨ Spiritual Perspective</button>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="prevStep()">← Back</button>
        <button class="btn btn-secondary" id="startOverBtn" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="confirmStartOver()">🔄 Start Over</button>
      </div>

      <div style="text-align:center;margin:20px 0;padding:16px;background:rgba(122,148,168,0.08);border-radius:8px;border:1px solid rgba(122,148,168,0.15);">
        <h3 style="color:var(--main-color);margin-bottom:8px;font-family:'Libre Baskerville',serif;">🧵 Belief Threader</h3>
        <p style="margin:0;font-size:0.9rem;line-height:1.5;color:var(--text-color);opacity:0.9;">
          Part of the comprehensive Five Anchors and Discernment Tools designed to help you find stability and clarity in overwhelming times.
        </p>
      </div>

      <div class="branding">
        <div><strong>Created by Clarity Metabolics</strong></div>
        <div style="font-style:italic;margin-top:4px">Finding balance in a chaotic world.</div>
        
        <div style="margin:16px 0;padding:16px;background:rgba(122,148,168,0.08);border-radius:8px;border:1px solid rgba(122,148,168,0.15);">
          <p style="margin:0;font-size:0.9rem;line-height:1.5;color:var(--text-color);opacity:0.9;">
            For the complete toolkit that addresses every aspect of human experience, visit <strong><a href="https://claritymetabolics.com" target="_blank" style="color:var(--main-color);text-decoration:none;">claritymetabolics.com</a></strong>
          </p>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Belief Insights Modal -->
<div id="examinationModal" class="modal">
  <div class="modal-content">
    <h3>Belief Insights</h3>
    
    <p style="margin-bottom:20px;">Understanding how beliefs work can help you approach them with greater wisdom and freedom.</p>
    
    <div style="background:var(--accent-color);padding:20px;border-radius:8px;margin:20px 0;">
      <h4 style="color:var(--main-color);margin-bottom:12px;">How Beliefs Form</h4>
      <p style="margin-bottom:12px;">Most beliefs were formed before age 7, when your brain was in a highly suggestible state.</p>
      <p>Your brain treats imagined experiences the same as real ones when forming beliefs - so dream big.</p>
    </div>
    
    <div style="background:var(--accent-color);padding:20px;border-radius:8px;margin:20px 0;">
      <h4 style="color:var(--main-color);margin-bottom:12px;">How Beliefs Function</h4>
      <p style="margin-bottom:12px;">You can hold a belief and still question whether it supports you.</p>
      <p>Confirmation bias means your brain looks for evidence that supports existing beliefs.</p>
    </div>
    
    <div style="background:var(--accent-color);padding:20px;border-radius:8px;margin:20px 0;">
      <h4 style="color:var(--main-color);margin-bottom:12px;">Your Power</h4>
      <p>You have the ability to consciously choose which beliefs to keep, modify, or release. This examination process is part of that conscious choice.</p>
    </div>
    
    <div style="text-align:center">
      <button class="btn btn-primary" onclick="closeExaminationModal()">Continue Examination</button>
    </div>
  </div>
</div>

<!-- Trinity Modal -->
<div id="trinityModal" class="modal">
  <div class="modal-content">
    <h3>✨ Spiritual Perspective on Belief Examination</h3>
    
    <div class="trinity-section">
      <div class="trinity-role">FATHER</div>
      <p>"I am the source of all truth. Every belief you hold can be examined in My light without fear. I gave you a mind capable of discernment - use it with confidence. What beliefs reflect My character of love, truth, and freedom rather than fear and limitation?"</p>
    </div>
    
    <div class="trinity-section">
      <div class="trinity-role">SON</div>
      <p>"I came to set you free from beliefs that bind you unnecessarily. Look at how I lived - I questioned religious traditions that limited people and embraced truth that brought life. Follow My example in examining what serves growth and authentic living."</p>
    </div>
    
    <div class="trinity-section">
      <div class="trinity-role">HOLY SPIRIT</div>
      <p>"I am your teacher and guide to all truth. When you're uncertain whether a belief serves you well, ask Me for wisdom. I will help you discern what builds up versus what tears down, what brings life versus what brings spiritual death."</p>
    </div>
    
    <div class="scripture">
      <p style="font-style:italic;font-weight:600;margin-bottom:8px">"Then you will know the truth, and the truth will set you free."</p>
      <p style="font-size:0.9rem;opacity:0.8">- John 8:32</p>
    </div>
    
    <p style="text-align:center;margin:15px 0;font-style:italic">You were meant to live from truth you've chosen consciously, not beliefs you've inherited unconsciously. This examination process is part of growing into spiritual maturity and authentic faith.</p>
    
    <div style="text-align:center">
      <button class="btn btn-primary" onclick="closeTrinityModal()">Continue in Truth</button>
    </div>
  </div>
</div>

<script>
  // --- State
  let currentStep = 0;
  const totalSteps = 7;
  const responses = {
    beliefFeelsOff:'', beliefOrigins:'', beliefProtects:'', beliefDistorts:'', trueBelief:'', finalReflection:''
  };

  // Light / Dark toggle
  document.getElementById('themeBtn').addEventListener('click', () => {
    const body = document.body;
    const btn = document.getElementById('themeBtn');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme'); btn.textContent = '🌙';
    } else {
      body.setAttribute('data-theme','dark'); btn.textContent = '☀️';
    }
  });

  // Character count and encouragement system
  function setupTextarea(textareaId, countId, encId, stepNum) {
    const textarea = document.getElementById(textareaId);
    const countEl = document.getElementById(countId);
    const encEl = document.getElementById(encId);
    const nextBtn = document.getElementById('next' + stepNum);
    
    if (!textarea || !countEl || !encEl) return;
    
    // Set initial button state
    if (nextBtn) updateButtonState(nextBtn, stepNum, false);
    
    textarea.addEventListener('input', () => {
      const count = textarea.value.length;
      countEl.textContent = `${count} characters`;
      
      // Show encouragement after 20 characters
      if (count > 20) {
        encEl.classList.add('show');
      } else {
        encEl.classList.remove('show');
      }
      
      // Update button state based on content
      if (nextBtn) {
        const hasContent = count > 0;
        updateButtonState(nextBtn, stepNum, hasContent);
      }
      
      // Auto-save
      saveCurrentResponse();
    });
  }

  // Toggle overflow section
  function toggleOverflow() {
    const section = document.getElementById('overflowSection');
    const toggle = document.getElementById('overflowToggle');
    
    if (section.style.display === 'none' || section.style.display === '') {
      section.style.display = 'block';
      toggle.textContent = '↑';
      // Focus on textarea after animation
      setTimeout(() => {
        document.getElementById('overflowDump')?.focus();
      }, 100);
    } else {
      section.style.display = 'none';
      toggle.textContent = '↓';
    }
  }

  // Update button text and state based on step and content
  function updateButtonState(button, stepNum, hasContent) {
    const buttonStates = {
      '1': {
        disabled: 'Share your observations to continue',
        enabled: "Explore the origins →"
      },
      '2': {
        disabled: 'Complete the origin analysis to continue', 
        enabled: "Examine the protective purpose →"
      },
      '3': {
        disabled: 'Complete the protection analysis to continue',
        enabled: "Identify current limitations →"
      },
      '4': {
        disabled: 'Complete the limitation analysis to continue',
        enabled: "Consider alternatives →"
      },
      '5': {
        disabled: 'Consider alternatives to continue',
        enabled: "Complete your examination →"
      }
    };
    
    const state = buttonStates[stepNum];
    if (state) {
      if (hasContent) {
        button.disabled = false;
        button.textContent = state.enabled;
      } else {
        button.disabled = true;
        button.textContent = state.disabled;
      }
    }
  }

  // Step navigation helpers
  function showStep(i){
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    const stepEl = document.querySelector(`.step[data-step="${i}"]`);
    if (stepEl) stepEl.classList.add('active');

    document.getElementById('progressFill').style.width = ((i)/ (totalSteps-1)) * 100 + '%';
    document.querySelectorAll('.step .dots').forEach(group => {
      [...group.children].forEach((d, idx) => {
        d.classList.remove('active','done');
        if (idx < i) d.classList.add('done');
        if (idx === i) d.classList.add('active');
      });
    });

    requestAnimationFrame(()=>{
      document.getElementById('pageTop').scrollIntoView({behavior:'smooth',block:'start'});
      setTimeout(()=>{
        if (i===1) document.getElementById('beliefFeelsOff')?.focus();
        if (i===2) document.getElementById('beliefOrigins')?.focus();
        if (i===3) document.getElementById('beliefProtects')?.focus();
        if (i===4) document.getElementById('beliefDistorts')?.focus();
        if (i===5) document.getElementById('trueBelief')?.focus();
        if (i===6) document.getElementById('finalReflection')?.focus();
      },100);
    });

    if (i===6) { 
      document.getElementById('mainHeader')?.classList.add('completed'); 
      updateSummary(); 
    }
  }

  function nextStep(){ 
    saveCurrentResponse(); 
    if (currentStep < totalSteps-1){ 
      currentStep++; 
      showStep(currentStep); 
    } 
  }
  
  function prevStep(){ 
    if (currentStep>0){ 
      currentStep--; 
      showStep(currentStep);
    } 
  }

  // Save current response
  function saveCurrentResponse(){
    const fieldMap = {
      1: 'beliefFeelsOff',
      2: 'beliefOrigins', 
      3: 'beliefProtects',
      4: 'beliefDistorts',
      5: 'trueBelief',
      6: 'finalReflection'
    };
    
    const fieldId = fieldMap[currentStep];
    if (fieldId) {
      const field = document.getElementById(fieldId);
      if (field) {
        responses[fieldId] = field.value.trim();
      }
    }
    
    // Save to localStorage
    try {
      localStorage.setItem('beliefThreaderResponses', JSON.stringify(responses));
    } catch (e) {
      console.warn('Could not save to localStorage:', e);
    }
  }

  // Update summary
  function updateSummary(){
    document.getElementById('sumBeliefOff').textContent = responses.beliefFeelsOff || '—';
    document.getElementById('sumOrigins').textContent = responses.beliefOrigins || '—';
    document.getElementById('sumProtects').textContent = responses.beliefProtects || '—';
    document.getElementById('sumDistorts').textContent = responses.beliefDistorts || '—';
    document.getElementById('sumTrueBelief').textContent = responses.trueBelief || '—';
  }

  // Start Over functionality
  let startOverArmed = false;
  function confirmStartOver(){
    const btn = document.getElementById('startOverBtn');
    if (!startOverArmed){
      startOverArmed = true;
      btn.classList.remove('btn-secondary'); 
      btn.classList.add('btn-warning');
      btn.textContent = 'Confirm Start Over';
      setTimeout(()=>{ 
        if(startOverArmed){
          startOverArmed=false; 
          btn.classList.remove('btn-warning'); 
          btn.classList.add('btn-secondary'); 
          btn.textContent='🔄 Start Over';
        }
      },3000);
    } else { 
      restartTool(); 
    }
  }

  function restartTool(){
    Object.keys(responses).forEach(k => responses[k] = '');
    document.querySelectorAll('textarea, input[type="text"]').forEach(t => t.value='');
    document.querySelectorAll('.char-count').forEach(el => el.textContent = '0 characters');
    document.querySelectorAll('.encouragement').forEach(el => el.classList.remove('show'));
    document.querySelectorAll('[id^="next"]').forEach(btn => btn.disabled = true);
    
    const btn = document.getElementById('startOverBtn');
    if (btn){ 
      startOverArmed=false; 
      btn.className='btn btn-secondary'; 
      btn.textContent='🔄 Start Over'; 
    }
    
    try {
      localStorage.removeItem('beliefThreaderResponses');
    } catch (e) {
      console.warn('Could not clear localStorage:', e);
    }
    
    currentStep = 0; 
    showStep(currentStep);
  }

  // Download summary
  function downloadSummary(){
    const timestamp = new Date().toLocaleDateString();
    let content = `Belief Examination Journey - ${timestamp}\n`;
    content += `Generated by Clarity Metabolics Discernment Toolkit\n\n`;
    content += `========================================\n\n`;
    
    if (responses.beliefFeelsOff) {
      content += `THE BELIEF EXAMINED:\n${responses.beliefFeelsOff}\n\n`;
    }
    
    if (responses.beliefOrigins) {
      content += `ORIGINS:\n${responses.beliefOrigins}\n\n`;
    }
    
    if (responses.beliefProtects) {
      content += `PROTECTIVE PURPOSE:\n${responses.beliefProtects}\n\n`;
    }
    
    if (responses.beliefDistorts) {
      content += `CURRENT LIMITATIONS:\n${responses.beliefDistorts}\n\n`;
    }
    
    if (responses.trueBelief) {
      content += `ALTERNATIVE PERSPECTIVE:\n${responses.trueBelief}\n\n`;
    }
    
    if (responses.finalReflection) {
      content += `INSIGHTS AND NEXT STEPS:\n${responses.finalReflection}\n\n`;
    }
    
    content += `========================================\n\n`;
    content += `SPIRITUAL PERSPECTIVE:\n\n`;
    content += `Father: "I am the source of all truth. Every belief you hold can be examined in My light without fear. I gave you a mind capable of discernment - use it with confidence. What beliefs reflect My character of love, truth, and freedom rather than fear and limitation?"\n\n`;
    content += `Son: "I came to set you free from beliefs that bind you unnecessarily. Look at how I lived - I questioned religious traditions that limited people and embraced truth that brought life. Follow My example in examining what serves growth and authentic living."\n\n`;
    content += `Holy Spirit: "I am your teacher and guide to all truth. When you're uncertain whether a belief serves you well, ask Me for wisdom. I will help you discern what builds up versus what tears down, what brings life versus what brings spiritual death."\n\n`;
    content += `"Then you will know the truth, and the truth will set you free." - John 8:32\n\n`;
    content += `You were meant to live from truth you've chosen consciously, not beliefs you've inherited unconsciously. This examination process is part of growing into spiritual maturity and authentic faith.\n\n`;
    content += `For more tools and support: claritymetabolics.github.io/clarity-tools`;
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `belief-examination-${timestamp.replace(/\//g, '-')}.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
  }

  // Modal functions
  function openExaminationModal(){ 
    document.getElementById('examinationModal').style.display='flex'; 
  }
  
  function closeExaminationModal(){ 
    document.getElementById('examinationModal').style.display='none'; 
  }

  function openTrinityModal(){ 
    document.getElementById('trinityModal').style.display='flex'; 
  }
  
  function closeTrinityModal(){ 
    document.getElementById('trinityModal').style.display='none'; 
  }

  // Click outside modal to close
  document.getElementById('trinityModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('trinityModal')) {
      closeTrinityModal();
    }
  });

  document.getElementById('examinationModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('examinationModal')) {
      closeExaminationModal();
    }
  });

  // Escape key to close modal
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeTrinityModal();
      closeExaminationModal();
    }
  });

  // Initialize
  function init(){ 
    // Load saved responses
    try {
      const saved = localStorage.getItem('beliefThreaderResponses');
      if (saved) {
        const savedResponses = JSON.parse(saved);
        Object.assign(responses, savedResponses);
        // Populate form fields
        Object.keys(savedResponses).forEach(key => {
          const el = document.getElementById(key);
          if (el && savedResponses[key]) {
            el.value = savedResponses[key];
            // Update character count
            const stepMapping = {
              'beliefFeelsOff': '1',
              'beliefOrigins': '2', 
              'beliefProtects': '3',
              'beliefDistorts': '4',
              'trueBelief': '5',
              'finalReflection': '6'
            };
            const stepNum = stepMapping[key];
            const countEl = document.getElementById('count' + stepNum);
            if (countEl) {
              countEl.textContent = `${savedResponses[key].length} characters`;
            }
            // Show encouragement if applicable
            if (savedResponses[key].length > 20) {
              const encEl = document.getElementById('enc' + stepNum);
              if (encEl) encEl.classList.add('show');
            }
            // Update button text and state if applicable
            const nextBtn = document.getElementById('next' + stepNum);
            if (nextBtn && savedResponses[key].length > 0) {
              updateButtonState(nextBtn, stepNum, true);
            }
          }
        });
      }
    } catch (e) {
      console.warn('Could not load from localStorage:', e);
    }
    
    showStep(0);
    
    // Setup textareas
    setTimeout(() => {
      setupTextarea('beliefFeelsOff', 'count1', 'enc1', '1');
      setupTextarea('beliefOrigins', 'count2', 'enc2', '2');
      setupTextarea('beliefProtects', 'count3', 'enc3', '3');
      setupTextarea('beliefDistorts', 'count4', 'enc4', '4');
      setupTextarea('trueBelief', 'count5', 'enc5', '5');
      setupTextarea('finalReflection', 'count6', 'enc6', '6');
    }, 100);
  }
  
  if (document.readyState === 'loading'){ 
    document.addEventListener('DOMContentLoaded', init); 
  } else { 
    init(); 
  }
</script>
</body>
</html>
