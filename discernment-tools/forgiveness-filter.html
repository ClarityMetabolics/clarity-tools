<!--
  ============================================================
  Clarity Metabolics - Forgiveness Filter: The Gentle Path to Spiritual Freedom
  Updated with More Impactful Content - ENHANCED VERSION
  ============================================================
  
  Version: 2.0.0 (Content Enhancement)
  Created: August 2025
  Author: Clarity Metabolics
  
  Key Features:
  - 8-step forgiveness journey with enhanced content
  - More impactful, emotionally resonant language
  - Accessible spiritual approach without heavy-handedness
  - Complete HTML structure for all steps
  - Professional CSS styling matching Echo Eraser success
  - Three-color system: #7A94A8, #E7EEF1, #4A5A6A
  - Responsive design with accessibility
  
  ============================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Forgiveness Filter — The Gentle Path to Spiritual Freedom</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --main-color:#7A94A8;      /* discernment blue-gray */
    --accent-color:#E7EEF1;    /* soft panels */
    --contrast-color:#4A5A6A;  /* deep accent text/borders */
    --text-color:#333;
    --bg-color:#fff;
    --border-color:#d9d6cf;
    --shadow:0 2px 12px rgba(0,0,0,.08);
    --success-color:#5a7c41;   /* progress dots done */
    --warning-color:#dc3545;   /* Start Over confirm */
    --green-panel:#E5EBDD;
    --yellow-panel:#FFF8CC;
    --red-panel:#F5E6E6;
  }
  [data-theme="dark"]{
    --text-color:#e6e6e6;
    --bg-color:#1c1c1c;
    --border-color:#3b3a36;
    --accent-color:#2a2825;
    --shadow:0 2px 14px rgba(0,0,0,.35);
    --green-panel:#2d352a;
    --yellow-panel:#3a3620;
    --red-panel:#3a2828;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Open Sans',sans-serif;
    color:var(--text-color);
    background:var(--bg-color);
    line-height:1.6;
  }
  .container{max-width:780px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

  /* Header */
  .header{
    color:#fff;
    background:linear-gradient(135deg,var(--main-color),var(--contrast-color));
    padding:22px 18px 18px;
    position:relative;
    transition: box-shadow .5s ease;
  }
  .header.completed{ box-shadow:0 0 18px rgba(122,148,168,.55); }
  .header h1{
    font-family:'Libre Baskerville',serif;
    font-size:2rem;
    text-align:center;
    margin-bottom:6px;
  }
  .subtitle{ text-align:center; font-style:italic; opacity:.95; }

  .header-controls{ position:absolute; top:10px; right:10px; display:flex; gap:8px }
  .header-btn{
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.3);
    color:#fff;
    padding:.35rem .6rem;border-radius:18px;cursor:pointer;
    font-size:.8rem;transition:all .2s ease;
  }
  .header-btn:hover{background:rgba(255,255,255,.25)}

  .progress-bar{height:4px;background:rgba(255,255,255,.28);border-radius:3px;margin-top:14px;overflow:hidden}
  .progress-fill{height:100%;background:#fff;width:0%;transition:width .6s ease}

  /* Content & steps */
  main.content{flex:1;padding:22px}
  .step{display:none;animation:fade .25s ease}
  .step.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .step-indicator{ text-align:center; margin:10px 0 18px }
  .step-counter{font-weight:700;color:#ffffff; background:var(--contrast-color); display:inline-block; padding:4px 10px; border-radius:12px }
  .dots{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--border-color)}
  .dot.active{background:var(--main-color)}
  .dot.done{background:var(--success-color)}

  h2{font-family:'Libre Baskerville',serif;color:var(--main-color);font-size:1.7rem;margin:14px 0 10px}
  h2 .subtitle{font-weight:400;font-style:italic;opacity:0.7;font-size:1.1rem}
  h3{color:var(--main-color);margin:20px 0 10px;font-size:1.2rem}
  p.lead{opacity:.95;margin-bottom:10px}

  .tip{
    background:linear-gradient(135deg, rgba(122,148,168,.12), rgba(74,90,106,.06));
    border-left:4px solid var(--main-color);
    padding:12px;border-radius:0 8px 8px 0;margin:14px 0;font-style:italic
  }

  .form-group{margin:16px 0}
  label{display:block;font-weight:700;color:var(--contrast-color);margin-bottom:6px}
  textarea, input[type="text"]{
    width:100%;min-height:110px;resize:vertical;border:2px solid var(--border-color);
    border-radius:10px;padding:12px;font:inherit;color:inherit;background:var(--bg-color);
    transition:all .2s ease;
  }
  input[type="text"]{ min-height:60px; }
  textarea:focus, input[type="text"]:focus{
    outline:none;border-color:var(--main-color);box-shadow:0 0 0 3px rgba(122,148,168,.18)
  }

  /* Enhanced Character Count */
  .char-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    font-size: 0.85rem;
  }
  
  .char-count {
    color: var(--text-color);
    opacity: 0.7;
  }
  
  .encouragement {
    color: var(--main-color);
    font-style: italic;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .encouragement.show {
    opacity: 1;
  }

  /* Buttons */
  .nav-row{display:flex;gap:12px;align-items:center;margin-top:22px;padding-top:18px;border-top:1px solid var(--border-color)}
  .nav-row .btn{flex:1}
  .btn{
    border:none;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;
    transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--main-color);color:#fff}
  .btn-primary:hover{background:var(--contrast-color);box-shadow:var(--shadow);transform:translateY(-1px)}
  .btn-secondary{background:var(--accent-color);color:var(--contrast-color);border:1px solid var(--border-color)}
  .btn-secondary:hover{background:var(--border-color)}
  .btn-warning{background:var(--warning-color);color:#fff}
  .btn-warning:hover{background:#c82333}
  .btn:disabled{background:var(--border-color);color:var(--text-color);opacity:0.6;cursor:not-allowed;transform:none}

  .micro{ text-align:center; margin-top:6px; font-style:italic; color:var(--contrast-color); opacity:.85 }

  /* Final actions */
  .final-actions{
    display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;
  }
  .final-actions .btn{ display:block; width:100%; max-width:280px; min-height:50px; text-align:center; }

  /* Content Styling */
  .content-section{
    background:var(--accent-color);
    padding:20px;
    border-radius:10px;
    margin:20px 0;
    border-left:4px solid var(--main-color);
  }
  .quote{
    font-style:italic;
    text-align:center;
    color:var(--contrast-color);
    line-height:1.7;
    font-size:1.05rem;
    margin:16px 0;
  }

  /* Journey Flow */
  .journey-flow{
    background:rgba(122,148,168,0.08);
    border-radius:10px;
    padding:16px;
    margin:16px 0;
    text-align:center;
  }
  .journey-step{
    display:inline-block;
    margin:4px 8px;
    font-weight:600;
    color:var(--contrast-color);
  }
  .journey-arrow{
    color:var(--main-color);
    margin:0 4px;
  }

  /* Forgiveness Concepts */
  .forgiveness-distinction{
    display:flex;gap:20px;margin:20px 0;align-items:stretch;
  }
  .distinction-box{
    flex:1;padding:16px;background:var(--accent-color);border-radius:8px;
  }
  .distinction-title{
    font-weight:700;color:var(--main-color);margin-bottom:8px;font-size:1.1rem;
  }
  .distinction-content{
    margin:0;font-size:0.9rem;line-height:1.5;
  }

  /* Grace Filter Visualization */
  .grace-filter{
    display:flex;justify-content:center;align-items:center;gap:20px;margin:20px 0;
    padding:16px;background:var(--accent-color);border-radius:10px;
  }
  .filter-stage{text-align:center;font-size:1.2rem}
  .filter-arrow{color:var(--main-color);font-size:1.2rem;font-weight:bold}

  /* Key Insights */
  .key-insight{
    text-align:center;font-weight:600;color:var(--main-color);margin:20px 0;
    font-size:1.1rem;padding:12px;background:rgba(122,148,168,0.08);border-radius:8px;
  }

  /* Modal Styles */
  .modal{
    position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000;
  }
  .modal-content{
    background:var(--bg-color);color:var(--text-color);max-width:600px;width:100%;max-height:90vh;
    border-radius:12px;box-shadow:var(--shadow);padding:24px;overflow-y:auto;
  }
  .modal h3{
    font-family:'Libre Baskerville',serif;color:var(--main-color);margin-bottom:16px;font-size:1.4rem;
  }
  .modal h4{
    color:var(--main-color);margin-bottom:8px;font-size:1.1rem;
  }

  /* Trinity Blessing Styles */
  .trinity-section{
    margin-bottom:20px;padding:16px;background:var(--accent-color);border-radius:8px;
  }
  .trinity-role{
    font-size:1.1rem;font-weight:700;color:var(--main-color);margin-bottom:8px;
  }
  .scripture{
    font-style:italic;background:var(--accent-color);padding:16px;border-left:4px solid var(--main-color);
    border-radius:8px;margin:16px 0;text-align:center;
  }

  /* Summary Box */
  .summary-box{
    background:var(--accent-color);padding:20px;border-radius:10px;margin:20px 0;
  }
  .summary-title{
    font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-bottom:15px;font-size:1.2rem;
  }
  .summary-item{
    margin-bottom:15px;
  }
  .summary-label{
    color:var(--main-color);font-weight:600;
  }
  .summary-content{
    margin:5px 0 0 15px;font-style:italic;
  }

  /* Tool Description Box */
  .tool-description{
    text-align:center;margin:20px 0;padding:16px;
    background:rgba(122,148,168,0.08);border-radius:8px;border:1px solid rgba(122,148,168,0.15);
  }
  .tool-description h3{
    color:var(--main-color);margin-bottom:8px;font-family:'Libre Baskerville',serif;
  }
  .tool-description p{
    margin:0;font-size:0.9rem;line-height:1.5;color:var(--text-color);opacity:0.9;
  }

  /* Branding */
  .branding{ 
    text-align:center; padding:18px; font-size:.85rem; color:var(--text-color); opacity:.75; 
    border-top:1px solid var(--border-color) 
  }
  .branding a{ color:var(--contrast-color); text-decoration:none }
  .branding a:hover{ text-decoration:underline }

  /* Expanded Branding */
  .expanded-branding{
    text-align:center;padding:18px;font-size:.85rem;color:var(--text-color);opacity:.75;
    border-top:1px solid var(--border-color);
  }
  .expanded-branding .brand-title{
    font-weight:bold;margin-bottom:4px;
  }
  .expanded-branding .brand-tagline{
    font-style:italic;margin-bottom:16px;
  }
  .expanded-branding .brand-box{
    margin:16px 0;padding:16px;background:rgba(122,148,168,0.08);
    border-radius:8px;border:1px solid rgba(122,148,168,0.15);
  }
  .expanded-branding .brand-box p{
    margin:0;font-size:0.9rem;line-height:1.5;color:var(--text-color);opacity:0.9;
  }
  .expanded-branding .brand-box a{
    color:var(--main-color);text-decoration:none;font-weight:600;
  }
  .expanded-branding .brand-box a:hover{
    text-decoration:underline;
  }
  .expanded-branding .brand-copyright{
    margin-top:8px;font-size:0.8rem;opacity:0.6;
  }

  @media (max-width:640px){
    .nav-row{flex-direction:column}
    .btn{width:100%}
    .header h1{font-size:1.7rem}
    .forgiveness-distinction{flex-direction:column;gap:15px}
    .grace-filter{flex-direction:column;gap:10px}
  }

  @media (prefers-reduced-motion: reduce) {
    .step { animation: none; }
    .progress-fill { transition: none; }
    .btn { transition: none; }
  }
</style>
</head>
<body>
<div id="pageTop" style="position:absolute;top:0"></div>
<div class="container">

  <header class="header" id="mainHeader">
    <div class="header-controls">
      <button class="header-btn" id="themeBtn" aria-label="Toggle light and dark theme" title="Toggle theme">🌙</button>
    </div>
    <h1>
  <img src="../assets/forgiveness-filter-chain.png"
       alt="Forgiveness Filter Chain"
       style="height:36px;vertical-align:middle;margin-right:8px;">
  Forgiveness Filter — The Gentle Path to Spiritual Freedom
</h1>
    <p class="subtitle">Forgiveness is freedom, not agreement</p>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </header>

  <main class="content">
    <!-- STEP 0: Introduction --><h1>
  <img src="assets/forgiveness-filter-chain.png"
       alt="Forgiveness Filter Chain"
       style="height:36px;vertical-align:middle;margin-right:8px;">
  Forgiveness Filter — The Gentle Path to Spiritual Freedom
</h1>

    <section class="step active" data-step="0">
      <div class="step-indicator">
        <div class="step-counter">Step 1 of 8</div>
        <div class="dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🕊️ The Heart's Journey to Freedom</h2>
      
      <p class="lead">You've been carrying something that was never yours to carry. Forgiveness isn't about letting someone off the hook—it's about getting yourself off the hook. It's not agreeing with what happened. It's refusing to let what happened own your future.</p>

      <!-- Section 1: Understanding Forgiveness -->
      <div style="margin:30px 0;padding:20px;background:rgba(122,148,168,0.05);border-radius:12px;border:1px solid rgba(122,148,168,0.1);">
        <h3 style="color:var(--main-color);margin:0 0 20px 0;text-align:center;font-size:1.2rem;">The Weight You're Carrying</h3>
        
        <div class="content-section">
          <p style="margin:0;text-align:center;font-size:1.05rem;line-height:1.7;">Think of unforgiveness like carrying a backpack full of rocks. You've gotten so used to the weight, you've forgotten what it feels like to walk without it. This tool helps you set down what was never meant to be yours to begin with.</p>
        </div>

        <div class="forgiveness-distinction">
          <div class="distinction-box">
            <div class="distinction-title"><span style="color:#00C851;font-size:1.5rem;margin-right:8px;font-weight:bold;">✓</span>What Forgiveness IS</div>
            <p class="distinction-content">Choosing your freedom over their debt. Deciding your peace matters more than their punishment.</p>
          </div>
          <div class="distinction-box">
            <div class="distinction-title"><span style="color:#dc3545;font-size:1.5rem;margin-right:8px;">❌</span>What Forgiveness IS NOT</div>
            <p class="distinction-content">Saying it was okay. Pretending it didn't matter. Becoming friends again.</p>
          </div>
        </div>
      </div>

      <!-- Section 2: Your Journey -->
      <div style="margin:30px 0;padding:20px;background:rgba(122,148,168,0.05);border-radius:12px;border:1px solid rgba(122,148,168,0.1);">
        <h3 style="color:var(--main-color);margin:0 0 15px 0;text-align:center;font-size:1.2rem;">Your Journey to Freedom</h3>
        
        <div style="margin:0 0 15px 0;padding:16px 20px;background:linear-gradient(135deg, var(--main-color), var(--contrast-color));color:white;border-radius:10px;text-align:center;font-size:1.15rem;font-weight:600;box-shadow:0 4px 12px rgba(122,148,168,0.3);border:2px solid rgba(255,255,255,0.1);">
          Key Truth: This hurt, AND you're not going to let it hurt you anymore.
        </div>

        <p style="margin:0;color:var(--text-color);line-height:1.7;text-align:center;">Together, we'll help you place this burden into hands that are big enough to hold it and wise enough to handle it. The weight you've been carrying doesn't have to be permanent.</p>
      </div>

      <!-- Section 3: Getting Started -->
      <div style="margin:30px 0;padding:20px;background:rgba(122,148,168,0.05);border-radius:12px;border:1px solid rgba(122,148,168,0.1);">
        <h3 style="color:var(--main-color);margin:0 0 15px 0;text-align:center;font-size:1.2rem;">Ready to Set It Down?</h3>
        
        <div class="tip" style="margin:0 0 20px 0;">
          <strong>How it works:</strong> We'll walk through this together — naming what's bound your heart, recognizing the weight you've been carrying, and learning to release it into capable hands.
        </div>
        
        <div style="text-align:center;">
          <button class="btn btn-primary" id="next0" disabled style="max-width:400px;width:100%;font-size:1.1rem;">Begin Your Journey to Freedom →</button>
          <p style="margin:15px 0 0 0;font-style:italic;color:var(--contrast-color);opacity:0.85;">Take a moment to breathe. You don't have to carry this alone.</p>
        </div>
      </div>
      
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 1: Name the Wound -->
    <section class="step" data-step="1">
      <div class="step-indicator">
        <div class="step-counter">Step 2 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>💔 Name the Wound <span class="subtitle">— Speaking truth about what happened</span></h2>
      
      <p class="lead">You can't release what you won't acknowledge. Something happened that left a mark, and that mark deserves to be seen clearly—not to hurt you again, but to finally let it go.</p>

      <p style="margin:16px 0;color:var(--text-color);opacity:0.9;">This isn't about reliving the pain. It's about naming it so you can stop carrying it.</p>

      <div class="form-group">
        <label for="woundName">Who or what hurt you? What offense still feels tethered to your spirit?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Be honest but gentle with yourself. Name it without having to relive it.</p>
        <textarea id="woundName" placeholder="The person or situation that hurt me was... / What happened was... / The wound I'm carrying is..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count1">0 characters</div>
          <div class="encouragement" id="enc1">Naming the wound is the first step toward freedom. You're brave for facing this.</div>
        </div>
      </div>

      <div class="tip"><strong>Remember:</strong> You don't have to carry what you can't fix. Naming it is the first step to setting it down.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next1" disabled>Acknowledge the weight →</button>
      </div>
      <div class="micro">Honesty is the beginning of healing.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 2: Expose the Weight -->
    <section class="step" data-step="2">
      <div class="step-indicator">
        <div class="step-counter">Step 3 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>⚖️ Expose the Weight <span class="subtitle">— Understanding what it's costing you</span></h2>
      
      <p class="lead">That hurt didn't just happen and disappear. It moved in. It's been taking up space in your mind, affecting how you trust, how you love, how you see yourself and others.</p>

      <p style="margin:16px 0;color:var(--text-color);opacity:0.9;">Let's look honestly at what this weight has cost you. Not to blame yourself, but to see why freedom is worth fighting for.</p>

      <div class="form-group">
        <label for="weightImpact">How has carrying this affected you — your peace, your relationships, your ability to trust?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Think about how this has impacted your daily life, your connections with others, your sense of safety.</p>
        <textarea id="weightImpact" placeholder="This burden has affected me by... / I notice I've become... / It's impacted my ability to..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count2">0 characters</div>
          <div class="encouragement" id="enc2">Recognizing the cost helps you see why freedom is worth pursuing.</div>
        </div>
      </div>

      <div class="journey-flow">
        <span class="journey-step">💔 Wound Named</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">⚖️ Weight Recognized</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">🕊️ Release Coming</span>
        <div style="margin-top:8px;font-size:0.9rem;color:var(--contrast-color);font-style:italic">
          Understanding the cost prepares your heart for the gift of release.
        </div>
      </div>

      <div class="tip"><strong>Truth Check:</strong> You weren't meant to carry this weight forever. What feels normal because you've carried it so long isn't the same as what's healthy.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next2" disabled>Reframe forgiveness →</button>
      </div>
      <div class="micro">Awareness creates the possibility for change.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 3: Reframe Forgiveness -->
    <section class="step" data-step="3">
      <div class="step-indicator">
        <div class="step-counter">Step 4 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🔓 Reframe Forgiveness <span class="subtitle">— Release ≠ agreement</span></h2>
      
      <p class="lead">Here's what forgiveness ISN'T: It's not saying it was okay. It's not pretending it didn't matter. It's not becoming friends again.</p>

      <p style="margin:16px 0;color:var(--text-color);opacity:0.9;font-weight:600;">Here's what forgiveness IS: It's deciding that your peace matters more than their punishment. It's choosing your freedom over their debt. It's saying "This hurt, AND I'm not going to let it hurt me anymore."</p>

      <div class="forgiveness-distinction">
        <div class="distinction-box">
          <div class="distinction-title">🔒 Staying Bound</div>
          <p class="distinction-content">"I must hold onto this hurt to prove it mattered. I'm responsible for ensuring justice happens."</p>
        </div>
        <div class="distinction-box">
          <div class="distinction-title">🔓 Choosing Freedom</div>
          <p class="distinction-content">"This hurt mattered deeply, AND I choose my freedom over their debt. I release what I cannot control."</p>
        </div>
      </div>

      <div class="form-group">
        <label for="reframeUnderstanding">What would it look like to choose your freedom over their debt?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Imagine releasing this burden while still honoring that it hurt and mattered.</p>
        <textarea id="reframeUnderstanding" placeholder="Choosing my freedom would look like... / I could release this by... / This would still matter, but I wouldn't have to..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count3">0 characters</div>
          <div class="encouragement" id="enc3">True forgiveness honors both the hurt and your need for freedom.</div>
        </div>
      </div>

      <div class="key-insight">
        Freedom Truth: You can validate the pain while releasing the burden.
      </div>

      <div class="tip"><strong>Remember:</strong> Forgiveness doesn't minimize what happened — it maximizes your freedom to heal and move forward.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next3" disabled>Make the release →</button>
      </div>
      <div class="micro">Release is an act of wisdom, not weakness.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 4: Filter Through Grace -->
    <section class="step" data-step="4">
      <div class="step-indicator">
        <div class="step-counter">Step 5 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>✨ Make the Release <span class="subtitle">— Setting down the weight</span></h2>
      
      <p class="lead">This is the moment of release. You're not minimizing what happened. You're maximizing your freedom to move forward.</p>

      <p style="margin:16px 0;color:var(--text-color);opacity:0.9;">Imagine placing this burden into hands that are big enough to hold it and wise enough to handle it. You don't have to carry what you can't fix.</p>

      <div class="grace-filter">
        <div class="filter-stage">
          <div style="font-size:2rem">⛓️</div>
          <div style="font-size:0.9rem;margin-top:4px;color:var(--contrast-color)">BOUND<br>(Carrying the burden)</div>
        </div>
        <div class="filter-arrow">→ RELEASE →</div>
        <div class="filter-stage">
          <div style="font-size:2rem">🕊️</div>
          <div style="font-size:0.9rem;margin-top:4px;color:var(--contrast-color)">FREE<br>(Weight is lifted)</div>
        </div>
      </div>

      <div class="form-group">
        <label for="graceRelease">Write your statement of release — placing this burden into capable hands</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Example: "I forgive [person] and release them. I give this burden to hands that can handle it better than mine."</p>
        <textarea id="graceRelease" placeholder="I forgive... and release them. I give this burden of... I choose to let go of my right to..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count4">0 characters</div>
          <div class="encouragement" id="enc4">This release opens the door to freedom. You're placing this burden in the right hands.</div>
        </div>
      </div>

      <div class="tip"><strong>This Moment:</strong> You're not just letting go — you're actively placing this burden into hands that are strong enough to carry it and wise enough to handle it perfectly.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next4" disabled>See the shift →</button>
      </div>
      <div class="micro">In this release, freedom begins.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 5: See the Shift -->
    <section class="step" data-step="5">
      <div class="step-indicator">
        <div class="step-counter">Step 6 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🌅 See the Shift <span class="subtitle">— Feeling the freedom</span></h2>
      
      <p class="lead">Feel that? Something just shifted. Where there was weight, there's now space. Where there was a closed fist, there's now an open hand.</p>

      <p style="margin:16px 0;color:var(--text-color);opacity:0.9;">What becomes possible when you're not spending energy carrying old pain? What could grow in the space that hurt used to occupy?</p>

      <div class="form-group">
        <label for="freedomVision">Without this weight, who would you be? What space opens in your spirit now?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Imagine your heart without this burden. What could grow in that space? How might you love and trust differently?</p>
        <textarea id="freedomVision" placeholder="Without this burden, I would be... / The space in my heart could be filled with... / I might be able to..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count5">0 characters</div>
          <div class="encouragement" id="enc5">The vision of freedom helps anchor the release you've made. This is who you were meant to be.</div>
        </div>
      </div>

      <div class="journey-flow">
        <span class="journey-step">⛓️ Burden Released</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">🌱 Space Created</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">✨ Purpose Restored</span>
        <div style="margin-top:8px;font-size:0.9rem;color:var(--contrast-color);font-style:italic">
          Freedom creates space for what you were truly meant to carry.
        </div>
      </div>

      <div class="key-insight">
        Freedom Reality: What you release makes room for what you were meant to receive.
      </div>

      <div class="tip"><strong>This Isn't Just About Letting Go:</strong> It's about making room for the joy, peace, and purpose that belong in your life. The space that pain occupied belongs to something better.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next5" disabled>Review your journey →</button>
      </div>
      <div class="micro">In the space where burden lived, blessing can now grow.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 6: Recap -->
    <section class="step" data-step="6">
      <div class="step-indicator">
        <div class="step-counter">Step 7 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div></div>
      </div>
      <h2>📋 Your Journey Summary <span class="subtitle">— Look at what you've accomplished</span></h2>
      
      <p class="lead">Look at the journey you just took. You faced what hurt you, acknowledged the weight it's been, understood the true nature of release, made the choice to let go, and glimpsed the freedom waiting for you.</p>

      <p style="margin:16px 0;color:var(--text-color);opacity:0.9;font-weight:600;">This isn't just emotional healing—this is taking your life back.</p>

      <div class="summary-box">
        <h3 class="summary-title">Your Forgiveness Journey</h3>
        
        <div class="summary-item">
          <strong class="summary-label">The Wound You Named:</strong>
          <p class="summary-content" id="sumWound">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">The Weight You Recognized:</strong>
          <p class="summary-content" id="sumWeight">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">Your Understanding of Release:</strong>
          <p class="summary-content" id="sumReframe">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">Your Statement of Release:</strong>
          <p class="summary-content" id="sumRelease">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">The Freedom You Envisioned:</strong>
          <p class="summary-content" id="sumFreedom">—</p>
        </div>
      </div>

      <div class="content-section">
        <h3 style="color:var(--main-color);margin-bottom:12px">A Word for Your Journey</h3>
        <p style="margin:0">"You don't have to carry what you cannot fix. Thank you for taking this step toward freedom. The weight you carried was never yours to bear forever."</p>
      </div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary">Final reflection →</button>
      </div>
      <div class="micro">Your courage to forgive honors both your pain and your right to be free.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 7: Final Reflection -->
    <section class="step" data-step="7">
      <div class="step-indicator">
        <div class="step-counter">Step 8 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div></div>
      </div>
      <h2>✨ Walking in Freedom</h2>
      <p class="lead">You've done something brave today. You've chosen freedom over bondage, release over resentment, your future over your past.</p>

      <div class="content-section">
        <h3 style="color:var(--main-color);margin-bottom:12px">The Heart of Freedom</h3>
        <p style="margin:0">The chains that held your heart have been broken. The space that pain occupied now belongs to something better. Walk in this freedom—it's yours to keep.</p>
      </div>

      <div class="key-insight">
        Freedom Declaration: You can't control what happened, but you can control what happens next.
      </div>

      <p style="margin:20px 0;color:var(--text-color);line-height:1.7;">Forgiveness doesn't erase what happened, but it erases the power it had over your future. You've made room in your heart for what you were truly meant to carry: peace, love, and purpose that can't be stolen by anyone's actions.</p>

      <div class="final-actions">
        <button class="btn btn-primary">📄 Download Your Journey</button>
        <button class="btn btn-secondary">✨ Trinity Speaks</button>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;">← Back</button>
        <button class="btn btn-secondary" id="startOverBtn" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;">🔄 Start Over</button>
      </div>

      <div class="tool-description">
        <h3>🕊️ Forgiveness Filter</h3>
        <p>Part of the comprehensive Five Anchors and Discernment Tools designed to help you find stability and clarity in overwhelming times through the gentle path to spiritual freedom.</p>
      </div>

      <div class="expanded-branding">
        <div class="brand-title">Created by Clarity Metabolics</div>
        <div class="brand-tagline">Finding balance in a chaotic world.</div>
        
        <div class="brand-box">
          <p>For the complete toolkit that addresses every aspect of human experience, visit <strong><a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></strong></p>
        </div>
        
        <div class="brand-copyright">© 2025 Clarity Metabolics | claritymetabolics.com</div>
      </div>
    </section>
  </main>
</div>

<!-- Trinity Speaks Modal -->
<div id="trinityModal" class="modal">
  <div class="modal-content">
    <h3>✨ Trinity Speaks</h3>
    
    <div class="trinity-section">
      <div class="trinity-role">FATHER</div>
      <p>"My child, you were never meant to carry what belongs to Me. In releasing this burden, you honor both the hurt and My ability to handle what you cannot fix."</p>
    </div>
    
    <div class="trinity-section">
      <div class="trinity-role">SON</div>
      <p>"I understand the cost of forgiveness—I chose it even while the wounds were fresh. You're following in My footsteps, choosing freedom over bondage."</p>
    </div>
    
    <div class="trinity-section">
      <div class="trinity-role">HOLY SPIRIT</div>
      <p>"I will help you walk in this freedom. When memories arise, I will remind you of the choice you made today. You are not walking this path alone."</p>
    </div>
    
    <div class="scripture">
      <p style="font-style:italic;font-weight:600;margin-bottom:8px">"It is for freedom that Christ has set us free."</p>
      <p style="font-size:0.9rem;opacity:0.8">- Galatians 5:1</p>
    </div>
    
    <p style="text-align:center;margin:15px 0;font-style:italic">The same power that breaks every chain is available to keep you walking in the freedom you've chosen today.</p>
    
    <div style="text-align:center">
      <button class="btn btn-primary">Amen</button>
    </div>
  </div>
</div>

<script>
// ===== FORGIVENESS FILTER CORE JAVASCRIPT =====
// State Management
let currentStep = 0;
const totalSteps = 8;
const responses = {
  woundName: '',
  weightImpact: '',
  reframeUnderstanding: '',
  graceRelease: '',
  freedomVision: ''
};

// ===== THEME TOGGLE =====
function initTheme() {
  const themeBtn = document.getElementById('themeBtn');
  if (!themeBtn) return;
  
  themeBtn.addEventListener('click', () => {
    const body = document.body;
    const btn = document.getElementById('themeBtn');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme');
      btn.textContent = '🌙';
    } else {
      body.setAttribute('data-theme', 'dark');
      btn.textContent = '☀️';
    }
  });
}

// ===== CHARACTER COUNT & ENCOURAGEMENT SYSTEM =====
function setupTextarea(textareaId, countId, encId, stepNum) {
  const textarea = document.getElementById(textareaId);
  const countEl = document.getElementById(countId);
  const encEl = document.getElementById(encId);
  const nextBtn = document.getElementById('next' + stepNum);
  
  if (!textarea || !countEl || !encEl) return;
  
  // Set initial button state
  if (nextBtn) updateButtonState(nextBtn, stepNum, false);
  
  textarea.addEventListener('input', () => {
    const count = textarea.value.length;
    countEl.textContent = `${count} characters`;
    
    // Show encouragement after 20 characters
    if (count > 20) {
      encEl.classList.add('show');
    } else {
      encEl.classList.remove('show');
    }
    
    // Update button state based on content
    if (nextBtn) {
      const hasContent = count > 0;
      updateButtonState(nextBtn, stepNum, hasContent);
    }
    
    // Auto-save
    saveCurrentResponse();
  });
}

// ===== BUTTON STATE MANAGEMENT =====
function updateButtonState(button, stepNum, hasContent) {
  const buttonStates = {
    '0': {
      disabled: 'Begin Your Journey to Freedom →',
      enabled: 'Name the Wound →'
    },
    '1': {
      disabled: 'Complete wound naming to Continue',
      enabled: 'Acknowledge the Weight →'
    },
    '2': {
      disabled: 'Complete weight recognition to Continue', 
      enabled: 'Reframe Forgiveness →'
    },
    '3': {
      disabled: 'Complete reframing to Continue',
      enabled: 'Make the Release →'
    },
    '4': {
      disabled: 'Complete release statement to Continue',
      enabled: 'See the Shift →'
    },
    '5': {
      disabled: 'Complete vision to Continue',
      enabled: 'Review Your Journey →'
    },
    '6': {
      disabled: 'Complete reflection to Continue',
      enabled: 'Final Reflection →'
    }
  };
  
  const state = buttonStates[stepNum];
  if (state) {
    if (hasContent || stepNum === '0') {
      button.disabled = false;
      button.textContent = state.enabled;
    } else {
      button.disabled = true;
      button.textContent = state.disabled;
    }
  }
}

// ===== STEP NAVIGATION =====
function showStep(i) {
  // Hide all steps
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  
  // Show target step
  const stepEl = document.querySelector(`.step[data-step="${i}"]`);
  if (stepEl) stepEl.classList.add('active');

  // Update progress bar
  document.getElementById('progressFill').style.width = ((i) / (totalSteps - 1)) * 100 + '%';
  
  // Update progress dots
  document.querySelectorAll('.step .dots').forEach(group => {
    [...group.children].forEach((d, idx) => {
      d.classList.remove('active', 'done');
      if (idx < i) d.classList.add('done');
      if (idx === i) d.classList.add('active');
    });
  });

  // Smooth scroll to top and focus
  requestAnimationFrame(() => {
    document.getElementById('pageTop').scrollIntoView({ behavior: 'smooth', block: 'start' });
    setTimeout(() => {
      if (i === 1) document.getElementById('woundName')?.focus();
      if (i === 2) document.getElementById('weightImpact')?.focus();
      if (i === 3) document.getElementById('reframeUnderstanding')?.focus();
      if (i === 4) document.getElementById('graceRelease')?.focus();
      if (i === 5) document.getElementById('freedomVision')?.focus();
    }, 100);
  });

  // Special handling for final step
  if (i === 7) {
    document.getElementById('mainHeader')?.classList.add('completed');
    updateSummary();
  }
}

function nextStep() {
  saveCurrentResponse();
  if (currentStep < totalSteps - 1) {
    currentStep++;
    showStep(currentStep);
  }
}

function prevStep() {
  if (currentStep > 0) {
    currentStep--;
    showStep(currentStep);
  }
}

// ===== NAVIGATION BUTTON SETUP =====
function setupNavigationButtons() {
  // Back buttons
  document.querySelectorAll('.btn-secondary').forEach(btn => {
    if (btn.textContent.includes('← Back')) {
      btn.addEventListener('click', prevStep);
    }
  });

  // Next buttons - specific handling for each step
  const nextButtons = [
    { id: 'next0', handler: nextStep },
    { id: 'next1', handler: nextStep },
    { id: 'next2', handler: nextStep },
    { id: 'next3', handler: nextStep },
    { id: 'next4', handler: nextStep },
    { id: 'next5', handler: nextStep }
  ];

  nextButtons.forEach(({ id, handler }) => {
    const btn = document.getElementById(id);
    if (btn) {
      btn.addEventListener('click', handler);
    }
  });

  // Special buttons that don't require validation
  document.querySelectorAll('.btn-primary').forEach(btn => {
    if (btn.textContent.includes('Final reflection →')) {
      btn.addEventListener('click', nextStep);
    }
  });
}

// ===== DATA PERSISTENCE =====
function saveCurrentResponse() {
  const fieldMap = {
    1: 'woundName',
    2: 'weightImpact',
    3: 'reframeUnderstanding',
    4: 'graceRelease',
    5: 'freedomVision'
  };
  
  const fieldId = fieldMap[currentStep];
  if (fieldId) {
    const field = document.getElementById(fieldId);
    if (field) {
      responses[fieldId] = field.value.trim();
    }
  }
  
  // Save to localStorage
  try {
    localStorage.setItem('forgivenessFilterResponses', JSON.stringify(responses));
  } catch (e) {
    // Silent fail - localStorage not available
  }
}

function loadSavedResponses() {
  try {
    const saved = localStorage.getItem('forgivenessFilterResponses');
    if (saved) {
      const savedResponses = JSON.parse(saved);
      Object.assign(responses, savedResponses);
      
      // Populate form fields
      Object.keys(savedResponses).forEach(key => {
        const el = document.getElementById(key);
        if (el && savedResponses[key]) {
          el.value = savedResponses[key];
          
          // Update character count
          const stepMapping = {
            'woundName': '1',
            'weightImpact': '2',
            'reframeUnderstanding': '3',
            'graceRelease': '4',
            'freedomVision': '5'
          };
          
          const stepNum = stepMapping[key];
          const countEl = document.getElementById('count' + stepNum);
          if (countEl) {
            countEl.textContent = `${savedResponses[key].length} characters`;
          }
          
          // Show encouragement if applicable
          if (savedResponses[key].length > 20) {
            const encEl = document.getElementById('enc' + stepNum);
            if (encEl) encEl.classList.add('show');
          }
          
          // Update button text and state if applicable
          const nextBtn = document.getElementById('next' + stepNum);
          if (nextBtn && savedResponses[key].length > 0) {
            updateButtonState(nextBtn, stepNum, true);
          }
        }
      });
    }
  } catch (e) {
    // Silent fail - localStorage not available
  }
}

// ===== SUMMARY UPDATE =====
function updateSummary() {
  const summaryFields = {
    'sumWound': responses.woundName,
    'sumWeight': responses.weightImpact,
    'sumReframe': responses.reframeUnderstanding,
    'sumRelease': responses.graceRelease,
    'sumFreedom': responses.freedomVision
  };

  Object.keys(summaryFields).forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = summaryFields[id] || '—';
    }
  });
}

// ===== START OVER FUNCTIONALITY =====
let startOverArmed = false;

function setupStartOver() {
  const startOverBtn = document.getElementById('startOverBtn');
  if (!startOverBtn) return;
  
  startOverBtn.addEventListener('click', confirmStartOver);
}

function confirmStartOver() {
  const btn = document.getElementById('startOverBtn');
  if (!startOverArmed) {
    startOverArmed = true;
    btn.classList.remove('btn-secondary');
    btn.classList.add('btn-warning');
    btn.textContent = 'Confirm Start Over';
    setTimeout(() => {
      if (startOverArmed) {
        startOverArmed = false;
        btn.classList.remove('btn-warning');
        btn.classList.add('btn-secondary');
        btn.textContent = '🔄 Start Over';
      }
    }, 3000);
  } else {
    restartTool();
  }
}

function restartTool() {
  // Clear responses
  Object.keys(responses).forEach(k => responses[k] = '');
  
  // Clear form fields
  document.querySelectorAll('textarea, input[type="text"]').forEach(t => t.value = '');
  
  // Reset character counts and encouragements
  document.querySelectorAll('.char-count').forEach(el => el.textContent = '0 characters');
  document.querySelectorAll('.encouragement').forEach(el => el.classList.remove('show'));
  
  // Reset buttons
  document.querySelectorAll('[id^="next"]').forEach(btn => btn.disabled = true);
  
  // Reset start over button
  const btn = document.getElementById('startOverBtn');
  if (btn) {
    startOverArmed = false;
    btn.className = 'btn btn-secondary';
    btn.textContent = '🔄 Start Over';
  }
  
  // Clear localStorage
  try {
    localStorage.removeItem('forgivenessFilterResponses');
  } catch (e) {
    // Silent fail - localStorage not available
  }
  
  // Reset to first step
  currentStep = 0;
  showStep(currentStep);
  
  // Remove completed header styling
  document.getElementById('mainHeader')?.classList.remove('completed');
}

// ===== TRINITY SPEAKS MODAL SYSTEM =====
function openTrinityModal() {
  const modal = document.getElementById('trinityModal');
  if (modal) {
    window.scrollTo({ top: 0, behavior: 'smooth' });
    modal.style.display = 'flex';
    setTimeout(() => {
      const firstButton = modal.querySelector('.btn');
      if (firstButton) {
        firstButton.focus();
      }
    }, 200);
  }
}

function closeTrinityModal() {
  const modal = document.getElementById('trinityModal');
  if (modal) {
    modal.style.display = 'none';
  }
}

// ===== MODAL EVENT HANDLERS =====
function setupModalEventHandlers() {
  const trinityModal = document.getElementById('trinityModal');
  if (trinityModal) {
    trinityModal.addEventListener('click', (e) => {
      if (e.target === trinityModal) {
        closeTrinityModal();
      }
    });
    
    const trinityCloseBtn = trinityModal.querySelector('.btn-primary');
    if (trinityCloseBtn && trinityCloseBtn.textContent.includes('Amen')) {
      trinityCloseBtn.addEventListener('click', closeTrinityModal);
    }
  }
  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeTrinityModal();
    }
  });
}

// ===== TRINITY SPEAKS BUTTON SETUP =====
function setupTrinityButton() {
  const finalActionBtns = document.querySelectorAll('.final-actions .btn-secondary');
  finalActionBtns.forEach(btn => {
    if (btn.textContent.includes('✨ Trinity Speaks')) {
      btn.addEventListener('click', openTrinityModal);
    }
  });
}

// ===== DOWNLOAD SUMMARY FUNCTIONALITY =====
function downloadSummary() {
  const timestamp = new Date().toLocaleDateString();
  let content = `Forgiveness Journey - ${timestamp}\n`;
  content += `Generated by Clarity Metabolics Discernment Toolkit\n\n`;
  content += `========================================\n\n`;
  
  if (responses.woundName) {
    content += `THE WOUND I NAMED:\n${responses.woundName}\n\n`;
  }
  
  if (responses.weightImpact) {
    content += `THE WEIGHT I RECOGNIZED:\n${responses.weightImpact}\n\n`;
  }
  
  if (responses.reframeUnderstanding) {
    content += `MY UNDERSTANDING OF RELEASE:\n${responses.reframeUnderstanding}\n\n`;
  }
  
  if (responses.graceRelease) {
    content += `MY STATEMENT OF RELEASE:\n${responses.graceRelease}\n\n`;
  }
  
  if (responses.freedomVision) {
    content += `THE FREEDOM I ENVISIONED:\n${responses.freedomVision}\n\n`;
  }
  
  content += `========================================\n\n`;
  content += `TRINITY SPEAKS INTO YOUR FREEDOM:\n\n`;
  content += `Father: "My child, you were never meant to carry what belongs to Me. In releasing this burden, you honor both the hurt and My ability to handle what you cannot fix."\n\n`;
  content += `Son: "I understand the cost of forgiveness—I chose it even while the wounds were fresh. You're following in My footsteps, choosing freedom over bondage."\n\n`;
  content += `Holy Spirit: "I will help you walk in this freedom. When memories arise, I will remind you of the choice you made today. You are not walking this path alone."\n\n`;
  content += `"It is for freedom that Christ has set us free." - Galatians 5:1\n\n`;
  content += `The same power that breaks every chain is available to keep you walking in the freedom you've chosen today.\n\n`;
  content += `For more tools and support: claritymetabolics.github.io/clarity-tools`;
  
  // Create and trigger download
  try {
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `forgiveness-journey-${timestamp.replace(/\//g, '-')}.txt`;
    
    document.body.appendChild(a);
    a.click();
    
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
  } catch (error) {
    const newWindow = window.open('', '_blank');
    if (newWindow) {
      newWindow.document.write(`<pre>${content}</pre>`);
      newWindow.document.title = 'Forgiveness Journey';
    } else {
      alert('Download failed. Please ensure pop-ups are allowed and try again.');
    }
  }
}

// ===== DOWNLOAD BUTTON SETUP =====
function setupDownloadButton() {
  const downloadBtns = document.querySelectorAll('.final-actions .btn-primary');
  downloadBtns.forEach(btn => {
    if (btn.textContent.includes('📄 Download Your Journey')) {
      btn.addEventListener('click', downloadSummary);
    }
  });
}

// ===== INITIALIZATION =====
function init() {
  // Load saved data
  loadSavedResponses();
  
  // Initialize theme
  initTheme();
  
  // Show first step
  showStep(0);
  
  // Setup navigation buttons
  setupNavigationButtons();
  
  // Setup start over functionality
  setupStartOver();
  
  // Setup modals
  setupModalEventHandlers();
  setupTrinityButton();
  setupDownloadButton();
  
  // Setup textareas with delay to ensure DOM is ready
  setTimeout(() => {
    setupTextarea('woundName', 'count1', 'enc1', '1');
    setupTextarea('weightImpact', 'count2', 'enc2', '2');
    setupTextarea('reframeUnderstanding', 'count3', 'enc3', '3');
    setupTextarea('graceRelease', 'count4', 'enc4', '4');
    setupTextarea('freedomVision', 'count5', 'enc5', '5');
  }, 100);

  // Enable the first button since it doesn't require input
  const firstBtn = document.getElementById('next0');
  if (firstBtn) {
    firstBtn.disabled = false;
  }
}

// ===== AUTO-INITIALIZATION =====
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>

</body>
</html>
