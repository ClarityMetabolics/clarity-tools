
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Calibrator — Finding Your Relational Balance</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-color: #7A94A8;      /* discernment blue-gray */
            --accent-color: #E7EEF1;    /* soft panels */
            --contrast-color: #4A5A6A;  /* deep accent text/borders */
            --text-color: #333;
            --bg-color: #fff;
            --border-color: #d9d6cf;
            --shadow: 0 2px 12px rgba(0,0,0,.08);
            --success-color: #5a7c41;   /* progress dots done */
            --warning-color: #dc3545;   /* Start Over confirm */
        }

        [data-theme="dark"] {
            --text-color: #e6e6e6;
            --bg-color: #1c1c1c;
            --border-color: #3b3a36;
            --accent-color: #2a2825;
            --shadow: 0 2px 14px rgba(0,0,0,.35);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Open Sans', sans-serif;
            color: var(--text-color);
            background: var(--bg-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 780px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            color: #fff;
            background: linear-gradient(135deg, var(--main-color), var(--contrast-color));
            padding: 22px 18px 18px;
            position: relative;
            transition: box-shadow .5s ease;
        }
        
        .header.completed { 
            box-shadow: 0 0 18px rgba(122,148,168,.55); 
        }
        
        .header h1 {
            font-family: 'Libre Baskerville', serif;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 6px;
        }
        
        .subtitle { 
            text-align: center; 
            font-style: italic; 
            opacity: .95; 
        }

        .header-controls { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            display: flex; 
            gap: 8px;
        }
        
        .header-btn {
            background: rgba(255,255,255,.15);
            border: 1px solid rgba(255,255,255,.3);
            color: #fff;
            padding: .35rem .6rem;
            border-radius: 18px;
            cursor: pointer;
            font-size: .8rem;
            transition: all .2s ease;
        }
        
        .header-btn:hover { 
            background: rgba(255,255,255,.25); 
        }

        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,.28);
            border-radius: 3px;
            margin-top: 14px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #fff;
            width: 0%;
            transition: width .6s ease;
        }

        /* Content & steps */
        main.content {
            flex: 1;
            padding: 22px;
        }
        
        .step {
            display: none;
            animation: fade .25s ease;
        }
        
        .step.active { 
            display: block; 
        }
        
        @keyframes fade {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: none; }
        }

        .step-indicator { 
            text-align: center; 
            margin: 10px 0 18px; 
        }
        
        .step-counter {
            font-weight: 700;
            color: #ffffff; 
            background: var(--contrast-color); 
            display: inline-block; 
            padding: 4px 10px; 
            border-radius: 12px;
        }
        
        .dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
        }
        
        .dot.active { 
            background: var(--main-color); 
        }
        
        .dot.done { 
            background: var(--success-color); 
        }

        h2 {
            font-family: 'Libre Baskerville', serif;
            color: var(--main-color);
            font-size: 1.7rem;
            margin: 14px 0 10px;
        }
        
        h2 .subtitle {
            font-weight: 400;
            font-style: italic;
            opacity: 0.7;
            font-size: 1.1rem;
        }
        
        h3 {
            color: var(--main-color);
            margin: 20px 0 10px;
            font-size: 1.2rem;
        }
        
        p.lead {
            opacity: .95;
            margin-bottom: 10px;
        }

        .tip {
            background: linear-gradient(135deg, rgba(122,148,168,.12), rgba(74,90,106,.06));
            border-left: 4px solid var(--main-color);
            padding: 12px;
            border-radius: 0 8px 8px 0;
            margin: 14px 0;
            font-style: italic;
        }
        
        .tip strong {
            font-style: normal;
        }

        .form-group {
            margin: 16px 0;
        }
        
        label {
            display: block;
            font-weight: 700;
            color: var(--contrast-color);
            margin-bottom: 6px;
        }
        
        textarea, input[type="text"] {
            width: 100%;
            min-height: 110px;
            resize: vertical;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            font: inherit;
            color: inherit;
            background: var(--bg-color);
            transition: all .2s ease;
        }
        
        input[type="text"] { 
            min-height: 60px; 
        }
        
        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--main-color);
            box-shadow: 0 0 0 3px rgba(122,148,168,.18);
        }

        /* Character Count */
        .char-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 0.85rem;
        }
        
        .char-count {
            color: var(--text-color);
            opacity: 0.7;
        }
        
        .encouragement {
            color: var(--main-color);
            font-style: italic;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .encouragement.show {
            opacity: 1;
        }

        /* Buttons */
        .nav-row {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-top: 22px;
            padding-top: 18px;
            border-top: 1px solid var(--border-color);
        }
        
        .nav-row .btn { 
            flex: 1; 
        }
        
        .btn {
            border: none;
            border-radius: 10px;
            padding: 14px 18px;
            font-weight: 700;
            cursor: pointer;
            transition: transform .1s ease, background .2s ease, box-shadow .2s ease;
        }
        
        .btn-primary {
            background: var(--main-color);
            color: #fff;
        }
        
        .btn-primary:hover {
            background: var(--contrast-color);
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--accent-color);
            color: var(--contrast-color);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
        }
        
        .btn:disabled {
            background: var(--border-color);
            color: var(--text-color);
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .micro { 
            text-align: center; 
            margin-top: 6px; 
            font-style: italic; 
            color: var(--contrast-color); 
            opacity: .85; 
        }

        /* Key Insights - Enhanced with Blue Glow Treatment */
        .key-insight {
            text-align: center;
            font-weight: 700;
            color: var(--contrast-color);
            margin: 24px 0;
            font-size: 1.2rem;
            padding: 18px 20px;
            background: linear-gradient(135deg, rgba(122,148,168,0.12), rgba(122,148,168,0.08));
            border-radius: 10px;
            border: 2px solid rgba(122,148,168,0.25);
            box-shadow: 0 0 12px rgba(122,148,168,0.3), 0 4px 15px rgba(122,148,168,0.15);
            position: relative;
            line-height: 1.4;
        }
        
        .key-insight::before {
            content: "🔑 ";
            font-size: 1.5rem;
            margin-right: 8px;
        }
        
        .key-insight:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 16px rgba(122,148,168,0.4), 0 6px 20px rgba(122,148,168,0.2);
            border-color: rgba(122,148,168,0.35);
        }

        /* Spectrum Slider */
        .spectrum-container {
            background: var(--accent-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid rgba(122,148,168,0.15);
            box-shadow: 0 0 8px rgba(122,148,168,0.2);
        }
        
        .spectrum-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .spectrum-label {
            text-align: center;
            color: var(--contrast-color);
            flex: 1;
        }
        
        .spectrum-slider-container {
            position: relative;
            margin: 20px 0;
        }
        
        .spectrum-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #e74c3c 0%, #27ae60 50%, #f1c40f 100%);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        
        .spectrum-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--contrast-color);
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .spectrum-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--contrast-color);
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .spectrum-result {
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--contrast-color);
        }
        
        .spectrum-result.dependence {
            background: rgba(231, 76, 60, 0.15);
            color: #c0392b;
        }
        
        .spectrum-result.independence {
            background: rgba(241, 196, 15, 0.15);
            color: #b7950b;
        }
        
        .spectrum-result.interdependence {
            background: rgba(39, 174, 96, 0.15);
            color: #1e8449;
        }

        /* Relationship Types Grid */
        .relationship-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        
        .relationship-type-card {
            background: var(--accent-color);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid rgba(122,148,168,0.15);
            box-shadow: 0 0 6px rgba(122,148,168,0.2);
            transition: all 0.2s ease;
        }
        
        .relationship-type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(122,148,168,0.3);
        }
        
        .relationship-type-title {
            font-weight: 700;
            color: var(--main-color);
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Emoji circles for each relationship type */
        .relationship-type-card:nth-child(1) .relationship-type-title::before {
            content: '🔴'; /* Red emoji circle for Dependence */
        }
        
        .relationship-type-card:nth-child(2) .relationship-type-title::before {
            content: '🟢'; /* Green emoji circle for Interdependence */
        }
        
        .relationship-type-card:nth-child(3) .relationship-type-title::before {
            content: '🟡'; /* Yellow emoji circle for Independence */
        }
        
        .relationship-type-signs {
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .relationship-type-signs div {
            margin: 4px 0;
        }

        /* Gravity Visual - Vertical Layout */
        .gravity-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 16px;
            background: var(--accent-color);
            border-radius: 10px;
            border: 2px solid rgba(122,148,168,0.15);
            box-shadow: 0 0 8px rgba(122,148,168,0.2);
        }
        
        .gravity-element {
            text-align: center;
            padding: 16px;
            border: 2px solid var(--main-color);
            border-radius: 10px;
            background: #fafafa;
            min-width: 200px;
            box-shadow: 0 0 8px rgba(122,148,168,0.3);
        }
        
        .gravity-element-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .gravity-element-title {
            font-weight: 600;
            color: var(--contrast-color);
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .gravity-element-subtitle {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.7;
        }
        
        .gravity-connector {
            text-align: center;
            font-weight: 600;
            color: var(--main-color);
            font-size: 0.9rem;
            line-height: 1.2;
        }

        /* Examples Grid */
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        
        .example-box {
            background: var(--accent-color);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
            border: 2px solid rgba(122,148,168,0.15);
            box-shadow: 0 0 6px rgba(122,148,168,0.2);
            transition: all 0.2s ease;
        }
        
        .example-box:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 10px rgba(122,148,168,0.3);
        }
        
        .example-title {
            font-weight: 600;
            color: var(--main-color);
            margin-bottom: 6px;
        }

        /* Branding */
        .branding { 
            text-align: center; 
            padding: 18px; 
            font-size: .85rem; 
            color: var(--text-color); 
            opacity: .75; 
            border-top: 1px solid var(--border-color);
        }
        
        .branding a { 
            color: var(--contrast-color); 
            text-decoration: none;
        }
        
        .branding a:hover { 
            text-decoration: underline;
        }

        @media (max-width: 640px) {
            .nav-row { flex-direction: column; }
            .btn { width: 100%; }
            .header h1 { font-size: 1.7rem; }
            .gravity-visual { flex-direction: column; gap: 10px; }
            .spectrum-labels { font-size: 0.8rem; }
        }

        @media (prefers-reduced-motion: reduce) {
            .step { animation: none; }
            .progress-fill { transition: none; }
            .btn { transition: none; }
        }
    </style>
</head>
<body>
    <div id="pageTop" style="position:absolute;top:0"></div>
    <div class="container">

        <header class="header" id="mainHeader">
            <div class="header-controls">
                <button class="header-btn" id="themeBtn" aria-label="Toggle light and dark theme" title="Toggle theme">🌙</button>
            </div>
            <h1>🌍 Connection Calibrator — Finding Your Relational Balance</h1>
            <p class="subtitle">The art of moving with others without losing yourself</p>
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </header>

        <main class="content">
            <!-- STEP 3: Map the Spectrum -->
            <section class="step active" data-step="3">
                <div class="step-indicator">
                    <div class="step-counter">Step 4 of 8</div>
                    <div class="dots">
                        <div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div>
                        <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    </div>
                </div>
                <h2>📊 Map the Spectrum <span class="subtitle">Where does this relationship sit?</span></h2>
                
                <p class="lead">Every relationship exists somewhere on a spectrum from dependence (losing yourself) to independence (isolated) to interdependence (the sweet spot of connected but centered).</p>

                <div class="spectrum-container">
                    <div class="spectrum-labels">
                        <div class="spectrum-label">Dependence<br><small>Enmeshed, losing yourself</small></div>
                        <div class="spectrum-label">Interdependence<br><small>Connected but centered</small></div>
                        <div class="spectrum-label">Independence<br><small>Isolated, detached</small></div>
                    </div>
                    
                    <div class="spectrum-slider-container">
                        <input type="range" id="spectrumSlider" class="spectrum-slider" min="0" max="100" value="50">
                    </div>
                    
                    <div class="spectrum-result" id="spectrumResult">
                        Move the slider to map where this relationship sits
                    </div>
                </div>

                <div class="relationship-types-grid">
                    <div class="relationship-type-card">
                        <div class="relationship-type-title">Signs of Dependence</div>
                        <div class="relationship-type-signs">
                            <div>• Feel responsible for others' emotions</div>
                            <div>• Lose yourself in others' needs</div>
                            <div>• Can't say no without guilt</div>
                        </div>
                    </div>
                    
                    <div class="relationship-type-card">
                        <div class="relationship-type-title">Signs of Interdependence</div>
                        <div class="relationship-type-signs">
                            <div>• Give and receive support</div>
                            <div>• Maintain your identity</div>
                            <div>• Clear, loving boundaries</div>
                        </div>
                    </div>
                    
                    <div class="relationship-type-card">
                        <div class="relationship-type-title">Signs of Independence</div>
                        <div class="relationship-type-signs">
                            <div>• Avoid emotional intimacy</div>
                            <div>• Keep people at arm's length</div>
                            <div>• Prefer to handle everything alone</div>
                        </div>
                    </div>
                </div>

                <div class="tip">
                    <strong>Remember:</strong> Most relationships fluctuate on this spectrum. You're mapping where it sits most of the time.
                </div>

                <div class="nav-row">
                    <button class="btn btn-secondary" onclick="goToPart1()">← Back</button>
                    <button class="btn btn-primary" onclick="nextStep()">Explore Adjustment →</button>
                </div>
                <div class="micro">Awareness of where you are is the first step to where you want to be.</div>
                <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
            </section>

            <!-- STEP 4: Explore Adjustment -->
            <section class="step" data-step="4">
                <div class="step-indicator">
                    <div class="step-counter">Step 5 of 8</div>
                    <div class="dots">
                        <div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div>
                        <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    </div>
                </div>
                <h2>🎛️ Explore Adjustment <span class="subtitle">What would healthy look like?</span></h2>
                
                <p class="lead">Now that you've identified where this relationship sits on the spectrum, what would it look like to move it toward healthy interdependence? This isn't about fixing the other person—it's about adjusting your part of the dance.</p>

                <div class="gravity-visual">
                    <div class="gravity-element">
                        <div class="gravity-element-icon">⚖️</div>
                        <div class="gravity-element-title">CURRENT DYNAMIC</div>
                        <div class="gravity-element-subtitle">(Current state)</div>
                    </div>
                    <div class="gravity-connector">
                        ↑<br>ADJUST<br>↓
                    </div>
                    <div class="gravity-element">
                        <div class="gravity-element-icon">🎯</div>
                        <div class="gravity-element-title">HEALTHIER BALANCE</div>
                        <div class="gravity-element-subtitle">(Target state)</div>
                    </div>
                </div>

                <p>Think small adjustments, not dramatic changes. What tiny shift in how you show up could create more balance?</p>

                <div class="form-group">
                    <label for="adjustmentVision">What small shift would bring this relationship closer to healthy interdependence?</label>
                    <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Consider changes in boundaries, communication, expectations, or how you respond.</p>
                    <textarea id="adjustmentVision" placeholder="A healthier version would look like... / I could adjust by... / Instead of [current pattern], I could..."></textarea>
                    <div class="char-info">
                        <div class="char-count" id="count4">0 characters</div>
                        <div class="encouragement" id="enc4">Small adjustments in how you show up can transform entire relationship dynamics.</div>
                    </div>
                </div>

                <div class="key-insight">
                    Balance Truth: You can only change your part of the dance, but that's often enough to change the whole rhythm.
                </div>

                <div class="tip">
                    <strong>Remember:</strong> You're not trying to change them or fix the relationship. You're adjusting how you show up to create better balance for yourself.
                </div>

                <div class="nav-row">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" id="next4" disabled onclick="nextStep()">Complete adjustment vision to Continue</button>
                </div>
                <div class="micro">Your part of the dance is the only part you can truly change.</div>
                <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
            </section>

            <!-- STEP 5: Choose Calibration Step -->
            <section class="step" data-step="5">
                <div class="step-indicator">
                    <div class="step-counter">Step 6 of 8</div>
                    <div class="dots">
                        <div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div>
                        <div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div>
                    </div>
                </div>
                <h2>🔧 Choose Your Calibration Step <span class="subtitle">One specific action</span></h2>
                
                <p class="lead">Vision is powerful, but <strong>action creates change</strong>. What's one specific boundary, conversation, or choice you can make that will help rebalance this connection?</p>

                <p>The Connection Calibrator works hand-in-hand with your Five Anchors - <em>when you're grounded across all dimensions of your life, your relational adjustments come from wisdom rather than reaction.</em></p>

                <p>Think concrete and doable. What's one thing you could do differently the next time you interact with this person or encounter this situation?</p>

                <div class="form-group">
                    <label for="calibrationStep">Name one boundary, action, or choice that will help rebalance this connection.</label>
                    <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Be specific about what you'll do, say, or change in your approach.</p>
                    <textarea id="calibrationStep" placeholder="I will... / Next time I'll... / My boundary will be... / I'll stop..."></textarea>
                    <div class="char-info">
                        <div class="char-count" id="count5">0 characters</div>
                        <div class="encouragement" id="enc5">One clear action is worth a thousand good intentions. You're taking charge of your relational health.</div>
                    </div>
                </div>

                <div class="tip">
                    <strong>⚓ When You Encounter This Situation - Check Your Five Anchors:</strong><br><br>
                    → <strong>🧭 Physical Anchor</strong> - <em>The Grounding Compass:</em> Is my breathing steady?<br><br>
                    → <strong>🧠 Mental Anchor</strong> - <em>The Clarity Lens:</em> Are my thoughts clear or spinning?<br><br>
                    → <strong>🪣 Emotional Anchor</strong> - <em>The Stability Well:</em> What emotions am I feeling right now?<br><br>
                    → <strong>✨ Spiritual Anchor</strong> - <em>The Communion Bridge:</em> Am I connected to what's true?<br><br>
                    → <strong>🌐 Relational Anchor</strong> - <em>The Connection Thread:</em> How do I want to show up here?<br><br>
                    <em>Grounded calibration creates lasting change.</em>
                </div>

                <div class="examples-grid">
                    <div class="example-box">
                        <div class="example-title">Boundary Examples</div>
                        <div>• "I need to stop for now"</div>
                        <div>• Limiting conversation topics</div>
                        <div>• Setting time limits on calls</div>
                        <div>• Not responding immediately</div>
                    </div>
                    
                    <div class="example-box">
                        <div class="example-title">Action Examples</div>
                        <div>• Having an honest conversation</div>
                        <div>• Asking for what you need</div>
                        <div>• Changing how you respond</div>
                        <div>• Creating space when needed</div>
                    </div>
                </div>

                <div class="key-insight">
                    Calibration Reality: Small, consistent adjustments create lasting change better than dramatic gestures.
                </div>

                <div class="tip">
                    <strong>Choose something you can actually follow through on.</strong> Success builds momentum for bigger changes.
                </div>

                <div class="nav-row">
                    <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn btn-primary" id="next5" disabled onclick="goToPart3()">Complete calibration step to Continue</button>
                </div>
                <div class="micro">Action transforms awareness into change.</div>
                <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
            </section>

        </main>
    </div>

    <script>
        // ===== CONNECTION CALIBRATOR PART 2 JAVASCRIPT =====
        
        // State Management
        let currentStep = 3; // Start at global step 3 (Step 4 of 8)
        const totalSteps = 8;
        const responses = {
            connectionIdentified: '',
            forceNoticed: '',
            spectrumPosition: 50,
            adjustmentVision: '',
            calibrationStep: '',
            summaryReflection: ''
        };

        // ===== INITIALIZATION =====
        function init() {
            loadSavedData();
            loadTheme();
            loadCurrentStep();
            setupTextareas();
            setupSpectrumSlider();
            showStep(currentStep);
        }

        // ===== THEME TOGGLE =====
        function initTheme() {
            const themeBtn = document.getElementById('themeBtn');
            if (!themeBtn) return;
            
            themeBtn.addEventListener('click', () => {
                const body = document.body;
                const btn = document.getElementById('themeBtn');
                if (body.getAttribute('data-theme') === 'dark') {
                    body.removeAttribute('data-theme');
                    btn.textContent = '🌙';
                    localStorage.setItem('connectionCalibratorTheme', 'light');
                } else {
                    body.setAttribute('data-theme', 'dark');
                    btn.textContent = '☀️';
                    localStorage.setItem('connectionCalibratorTheme', 'dark');
                }
            });
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('connectionCalibratorTheme');
            const themeBtn = document.getElementById('themeBtn');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeBtn.textContent = '☀️';
            } else {
                themeBtn.textContent = '🌙';
            }
        }

        // ===== STEP NAVIGATION =====
        function showStep(stepIndex) {
            // Hide all steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // Show target step
            const stepEl = document.querySelector(`.step[data-step="${stepIndex}"]`);
            if (stepEl) stepEl.classList.add('active');

            // Update progress bar - global position out of 8 total steps
            const globalProgress = (stepIndex / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = globalProgress + '%';
            
            // Update progress dots - show global position
            document.querySelectorAll('.step .dots').forEach(dotsContainer => {
                const dots = [...dotsContainer.children];
                dots.forEach((dot, idx) => {
                    dot.classList.remove('active', 'done');
                    if (idx < stepIndex) {
                        dot.classList.add('done');
                    } else if (idx === stepIndex) {
                        dot.classList.add('active');
                    }
                });
            });

            // Smooth scroll to top and focus
            requestAnimationFrame(() => {
                document.getElementById('pageTop').scrollIntoView({ behavior: 'smooth', block: 'start' });
                setTimeout(() => {
                    if (stepIndex === 4) document.getElementById('adjustmentVision')?.focus();
                    if (stepIndex === 5) document.getElementById('calibrationStep')?.focus();
                }, 100);
            });

            // Save current step globally
            saveCurrentStep();
        }

        function nextStep() {
            saveCurrentResponse();
            if (currentStep < 5) { // Only steps 3-5 in Part 2
                currentStep++;
                showStep(currentStep);
            }
        }

        function prevStep() {
            if (currentStep > 3) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function goToPart1() {
            currentStep = 2; // Go back to global step 2 (Step 3 of 8)
            saveCurrentStep();
            saveAllData();
            window.location.href = 'connection-calibrator-part1.html';
        }

        function goToPart3() {
            saveCurrentResponse();
            currentStep = 6; // Global step 6 is first step of Part 3
            saveCurrentStep();
            saveAllData();
            window.location.href = 'connection-calibrator-part3.html';
        }

        // ===== SPECTRUM SLIDER =====
        function setupSpectrumSlider() {
            const slider = document.getElementById('spectrumSlider');
            const result = document.getElementById('spectrumResult');
            
            if (!slider || !result) return;
            
            // Load saved position
            if (responses.spectrumPosition) {
                slider.value = responses.spectrumPosition;
            }
            
            function updateSpectrumResult(value) {
                value = parseInt(value);
                responses.spectrumPosition = value;
                
                let zone = '';
                let description = '';
                let className = '';
                
                if (value <= 35) {
                    zone = 'DEPENDENCE ZONE';
                    description = 'Losing yourself in this relationship';
                    className = 'dependence';
                } else if (value >= 65) {
                    zone = 'INDEPENDENCE ZONE';
                    description = 'Isolated and disconnected';
                    className = 'independence';
                } else {
                    zone = 'INTERDEPENDENCE ZONE';
                    description = 'Healthy connection with boundaries';
                    className = 'interdependence';
                }
                
                result.className = `spectrum-result ${className}`;
                result.innerHTML = `<strong>${zone}</strong><br>${description}`;
                
                saveAllData();
            }
            
            // Initial update
            updateSpectrumResult(slider.value);
            
            // Listen for changes
            slider.addEventListener('input', (e) => {
                updateSpectrumResult(e.target.value);
            });
        }

        // ===== DATA PERSISTENCE =====
        function saveCurrentResponse() {
            const fieldMap = {
                3: 'spectrumPosition',
                4: 'adjustmentVision',
                5: 'calibrationStep'
            };
            
            // Always save spectrum position
            const slider = document.getElementById('spectrumSlider');
            if (slider) {
                responses.spectrumPosition = parseInt(slider.value);
            }
            
            // Save text field for current step
            const fieldId = fieldMap[currentStep];
            if (fieldId && fieldId !== 'spectrumPosition') {
                const field = document.getElementById(fieldId);
                if (field) {
                    responses[fieldId] = field.value.trim();
                }
            }
            
            saveAllData();
        }

        function saveAllData() {
            try {
                localStorage.setItem('connectionCalibratorData', JSON.stringify(responses));
            } catch (e) {
                console.warn('Could not save to localStorage');
            }
        }

        function saveCurrentStep() {
            try {
                localStorage.setItem('connectionCalibratorCurrentStep', currentStep.toString());
            } catch (e) {
                console.warn('Could not save current step');
            }
        }

        function loadCurrentStep() {
            try {
                const saved = localStorage.getItem('connectionCalibratorCurrentStep');
                if (saved) {
                    const step = parseInt(saved);
                    if (step >= 3 && step <= 5) { // Only steps 3-5 available in Part 2
                        currentStep = step;
                    }
                }
            } catch (e) {
                console.warn('Could not load current step');
            }
        }

        function loadSavedData() {
            try {
                const saved = localStorage.getItem('connectionCalibratorData');
                if (saved) {
                    const savedData = JSON.parse(saved);
                    Object.assign(responses, savedData);
                    
                    // Populate form fields
                    Object.keys(savedData).forEach(key => {
                        const el = document.getElementById(key);
                        if (el && savedData[key]) {
                            if (key === 'spectrumPosition') {
                                el.value = savedData[key];
                            } else {
                                el.value = savedData[key];
                                
                                // Update character count
                                const stepMapping = {
                                    'adjustmentVision': '4',
                                    'calibrationStep': '5'
                                };
                                
                                const stepNum = stepMapping[key];
                                if (stepNum) {
                                    updateCharacterCount(key, stepNum);
                                    
                                    // Update button if has content
                                    const nextBtn = document.getElementById('next' + stepNum);
                                    if (nextBtn && savedData[key].length > 0) {
                                        updateButtonState(nextBtn, stepNum, true);
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (e) {
                console.warn('Could not load saved data');
            }
        }

        // ===== CHARACTER COUNT & BUTTON MANAGEMENT =====
        function setupTextareas() {
            setupTextarea('adjustmentVision', '4');
            setupTextarea('calibrationStep', '5');
            initTheme();
        }

        function setupTextarea(textareaId, stepNum) {
            const textarea = document.getElementById(textareaId);
            const nextBtn = document.getElementById('next' + stepNum);
            
            if (!textarea) return;
            
            // Set initial button state
            if (nextBtn) updateButtonState(nextBtn, stepNum, false);
            
            textarea.addEventListener('input', () => {
                updateCharacterCount(textareaId, stepNum);
                
                // Update button state
                if (nextBtn) {
                    const hasContent = textarea.value.trim().length > 0;
                    updateButtonState(nextBtn, stepNum, hasContent);
                }
                
                // Auto-save
                saveCurrentResponse();
            });
        }

        function updateCharacterCount(textareaId, stepNum) {
            const textarea = document.getElementById(textareaId);
            const countEl = document.getElementById('count' + stepNum);
            const encEl = document.getElementById('enc' + stepNum);
            
            if (!textarea || !countEl || !encEl) return;
            
            const count = textarea.value.length;
            countEl.textContent = `${count} characters`;
            
            // Show encouragement after 20 characters
            if (count > 20) {
                encEl.classList.add('show');
            } else {
                encEl.classList.remove('show');
            }
        }

        function updateButtonState(button, stepNum, hasContent) {
            const buttonStates = {
                '4': {
                    disabled: 'Complete adjustment vision to Continue',
                    enabled: 'Choose Calibration Step →'
                },
                '5': {
                    disabled: 'Complete calibration step to Continue',
                    enabled: 'View Summary →'
                }
            };
            
            const state = buttonStates[stepNum];
            if (state) {
                if (hasContent) {
                    button.disabled = false;
                    button.textContent = state.enabled;
                } else {
                    button.disabled = true;
                    button.textContent = state.disabled;
                }
            }
        }

        // ===== AUTO-INITIALIZATION =====
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
