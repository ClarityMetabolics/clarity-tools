<!--
  ============================================================
  Clarity Metabolics - Echo Eraser: Advanced Integration
  Module 1: HTML Structure & CSS (No JavaScript)
  ============================================================
  
  Version: 1.0.0 (Professional Enhancement)
  Created: August 2025
  Author: Clarity Metabolics
  
  Key Features:
  - 8-step echo processing journey
  - Complete HTML structure for all steps
  - Professional CSS styling matching Thought Refiner
  - Three-color system: #7A94A8, #E7EEF1, #4A5A6A
  - Responsive design with accessibility
  - Branding: Simple on steps 0-6, expanded on step 7
  
  ============================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Echo Eraser — Advanced Integration</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --main-color:#7A94A8;      /* discernment blue-gray */
    --accent-color:#E7EEF1;    /* soft panels */
    --contrast-color:#4A5A6A;  /* deep accent text/borders */
    --text-color:#333;
    --bg-color:#fff;
    --border-color:#d9d6cf;
    --shadow:0 2px 12px rgba(0,0,0,.08);
    --success-color:#5a7c41;   /* progress dots done */
    --warning-color:#dc3545;   /* Start Over confirm */
    --green-panel:#E5EBDD;
    --yellow-panel:#FFF8CC;
    --red-panel:#F5E6E6;
  }
  [data-theme="dark"]{
    --text-color:#e6e6e6;
    --bg-color:#1c1c1c;
    --border-color:#3b3a36;
    --accent-color:#2a2825;
    --shadow:0 2px 14px rgba(0,0,0,.35);
    --green-panel:#2d352a;
    --yellow-panel:#3a3620;
    --red-panel:#3a2828;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Open Sans',sans-serif;
    color:var(--text-color);
    background:var(--bg-color);
    line-height:1.6;
  }
  .container{max-width:780px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

  /* Header */
  .header{
    color:#fff;
    background:linear-gradient(135deg,var(--main-color),var(--contrast-color));
    padding:22px 18px 18px;
    position:relative;
    transition: box-shadow .5s ease;
  }
  .header.completed{ box-shadow:0 0 18px rgba(122,148,168,.55); }
  .header h1{
    font-family:'Libre Baskerville',serif;
    font-size:2rem;
    text-align:center;
    margin-bottom:6px;
  }
  .subtitle{ text-align:center; font-style:italic; opacity:.95; }

  .header-controls{ position:absolute; top:10px; right:10px; display:flex; gap:8px }
  .header-btn{
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.3);
    color:#fff;
    padding:.35rem .6rem;border-radius:18px;cursor:pointer;
    font-size:.8rem;transition:all .2s ease;
  }
  .header-btn:hover{background:rgba(255,255,255,.25)}

  .progress-bar{height:4px;background:rgba(255,255,255,.28);border-radius:3px;margin-top:14px;overflow:hidden}
  .progress-fill{height:100%;background:#fff;width:0%;transition:width .6s ease}

  /* Content & steps */
  main.content{flex:1;padding:22px}
  .step{display:none;animation:fade .25s ease}
  .step.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .step-indicator{ text-align:center; margin:10px 0 18px }
  .step-counter{font-weight:700;color:#ffffff; background:var(--contrast-color); display:inline-block; padding:4px 10px; border-radius:12px }
  .dots{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--border-color)}
  .dot.active{background:var(--main-color)}
  .dot.done{background:var(--success-color)}

  h2{font-family:'Libre Baskerville',serif;color:var(--main-color);font-size:1.7rem;margin:14px 0 10px}
  h2 .subtitle{font-weight:400;font-style:italic;opacity:0.7;font-size:1.1rem}
  h3{color:var(--main-color);margin:20px 0 10px;font-size:1.2rem}
  p.lead{opacity:.95;margin-bottom:10px}

  .tip{
    background:linear-gradient(135deg, rgba(122,148,168,.12), rgba(74,90,106,.06));
    border-left:4px solid var(--main-color);
    padding:12px;border-radius:0 8px 8px 0;margin:14px 0;font-style:italic
  }

  .form-group{margin:16px 0}
  label{display:block;font-weight:700;color:var(--contrast-color);margin-bottom:6px}
  textarea, input[type="text"]{
    width:100%;min-height:110px;resize:vertical;border:2px solid var(--border-color);
    border-radius:10px;padding:12px;font:inherit;color:inherit;background:var(--bg-color);
    transition:all .2s ease;
  }
  input[type="text"]{ min-height:60px; }
  textarea:focus, input[type="text"]:focus{
    outline:none;border-color:var(--main-color);box-shadow:0 0 0 3px rgba(122,148,168,.18)
  }

  /* Enhanced Character Count */
  .char-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    font-size: 0.85rem;
  }
  
  .char-count {
    color: var(--text-color);
    opacity: 0.7;
  }
  
  .encouragement {
    color: var(--main-color);
    font-style: italic;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .encouragement.show {
    opacity: 1;
  }

  /* Buttons */
  .nav-row{display:flex;gap:12px;align-items:center;margin-top:22px;padding-top:18px;border-top:1px solid var(--border-color)}
  .nav-row .btn{flex:1}
  .btn{
    border:none;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;
    transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--main-color);color:#fff}
  .btn-primary:hover{background:var(--contrast-color);box-shadow:var(--shadow);transform:translateY(-1px)}
  .btn-secondary{background:var(--accent-color);color:var(--contrast-color);border:1px solid var(--border-color)}
  .btn-secondary:hover{background:var(--border-color)}
  .btn-warning{background:var(--warning-color);color:#fff}
  .btn-warning:hover{background:#c82333}
  .btn:disabled{background:var(--border-color);color:var(--text-color);opacity:0.6;cursor:not-allowed;transform:none}

  .micro{ text-align:center; margin-top:6px; font-style:italic; color:var(--contrast-color); opacity:.85 }

  /* Final actions */
  .final-actions{
    display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;
  }
  .final-actions .btn{ display:block; width:100%; max-width:280px; min-height:50px; text-align:center; }

  /* Growth Visualization */
  .growth-viz{
    display:flex;justify-content:center;align-items:center;gap:20px;margin:20px 0;
    padding:16px;background:var(--accent-color);border-radius:10px;
  }
  .growth-stage{text-align:center;font-size:1.5rem}
  .growth-arrow{color:var(--main-color);font-size:1.2rem;font-weight:bold}

  /* Tool Links */
  .tool-link-btn{
    flex:1;min-width:200px;text-decoration:none;display:flex;align-items:center;gap:8px;justify-content:center;
    padding:12px 16px;border-radius:8px;background:var(--contrast-color);color:#fff;font-weight:600;
    transition:all .2s ease;
  }
  .tool-link-btn:hover{
    background:var(--main-color);transform:translateY(-1px);box-shadow:var(--shadow);
  }

  /* Sacred Content Styling */
  .sacred-content{
    background:var(--accent-color);
    padding:20px;
    border-radius:10px;
    margin:20px 0;
    border-left:4px solid var(--main-color);
  }
  .sacred-quote{
    font-style:italic;
    text-align:center;
    color:var(--contrast-color);
    line-height:1.7;
    font-size:1.05rem;
    margin:16px 0;
  }

  /* Journey Flow */
  .journey-flow{
    background:rgba(122,148,168,0.08);
    border-radius:10px;
    padding:16px;
    margin:16px 0;
    text-align:center;
  }
  .journey-step{
    display:inline-block;
    margin:4px 8px;
    font-weight:600;
    color:var(--contrast-color);
  }
  .journey-arrow{
    color:var(--main-color);
    margin:0 4px;
  }

  /* Comparison Boxes */
  .comparison-container{
    display:flex;gap:20px;margin:20px 0;align-items:stretch;
  }
  .comparison-box{
    flex:1;padding:16px;background:var(--accent-color);border-radius:8px;
  }
  .comparison-title{
    font-weight:700;color:var(--main-color);margin-bottom:8px;font-size:1.1rem;
  }
  .comparison-content{
    margin:0;font-size:0.9rem;line-height:1.5;
  }

  /* Key Insights */
  .key-insight{
    text-align:center;font-weight:600;color:var(--main-color);margin:20px 0;
    font-size:1.1rem;padding:12px;background:rgba(122,148,168,0.08);border-radius:8px;
  }

  /* Sitting Practice Button */
  .sitting-btn{
    box-shadow: 0 0 20px rgba(122,148,168,0.5), 0 4px 15px rgba(122,148,168,0.3);
    font-size:1.1rem;
  }

  /* Warning Box */
  .warning-box{
    background:#fff3cd;border:1px solid #ffeaa7;padding:16px;border-radius:8px;margin:20px 0;
  }
  .warning-title{
    color:#856404;margin-bottom:8px;font-weight:600;
  }
  .warning-content{
    margin:0;color:#856404;line-height:1.5;
  }
  .warning-note{
    margin:8px 0 0;font-style:italic;color:#856404;font-weight:600;
  }

  /* Modal Styles */
  .modal{
    position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000;
  }
  .modal-content{
    background:var(--bg-color);color:var(--text-color);max-width:600px;width:100%;max-height:90vh;
    border-radius:12px;box-shadow:var(--shadow);padding:24px;overflow-y:auto;
  }
  .modal h3{
    font-family:'Libre Baskerville',serif;color:var(--main-color);margin-bottom:16px;font-size:1.4rem;
  }
  .modal h4{
    color:var(--main-color);margin-bottom:8px;font-size:1.1rem;
  }

  /* Sitting Practice Steps */
  .sitting-step{
    margin-bottom:20px;
    padding:16px;
    background:var(--accent-color);
    border-radius:8px;
  }
  .sitting-step-title{
    font-size:1.1rem;
    font-weight:700;
    color:var(--main-color);
    margin-bottom:8px;
  }
  .sitting-step p{
    font-style:italic;
    line-height:1.6;
    margin:8px 0;
  }

  /* Trinity Blessing Styles */
  .trinity-section{
    margin-bottom:20px;padding:16px;background:var(--accent-color);border-radius:8px;
  }
  .trinity-role{
    font-size:1.1rem;font-weight:700;color:var(--main-color);margin-bottom:8px;
  }
  .scripture{
    font-style:italic;background:var(--accent-color);padding:16px;border-left:4px solid var(--main-color);
    border-radius:8px;margin:16px 0;text-align:center;
  }

  /* Summary Box */
  .summary-box{
    background:var(--accent-color);padding:20px;border-radius:10px;margin:20px 0;
  }
  .summary-title{
    font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-bottom:15px;font-size:1.2rem;
  }
  .summary-item{
    margin-bottom:15px;
  }
  .summary-label{
    color:var(--main-color);font-weight:600;
  }
  .summary-content{
    margin:5px 0 0 15px;font-style:italic;
  }

  /* Tool Description Box */
  .tool-description{
    text-align:center;margin:20px 0;padding:16px;
    background:rgba(122,148,168,0.08);border-radius:8px;border:1px solid rgba(122,148,168,0.15);
  }
  .tool-description h3{
    color:var(--main-color);margin-bottom:8px;font-family:'Libre Baskerville',serif;
  }
  .tool-description p{
    margin:0;font-size:0.9rem;line-height:1.5;color:var(--text-color);opacity:0.9;
  }

  /* Branding */
  .branding{ 
    text-align:center; padding:18px; font-size:.85rem; color:var(--text-color); opacity:.75; 
    border-top:1px solid var(--border-color) 
  }
  .branding a{ color:var(--contrast-color); text-decoration:none }
  .branding a:hover{ text-decoration:underline }

  /* Expanded Branding */
  .expanded-branding{
    text-align:center;padding:18px;font-size:.85rem;color:var(--text-color);opacity:.75;
    border-top:1px solid var(--border-color);
  }
  .expanded-branding .brand-title{
    font-weight:bold;margin-bottom:4px;
  }
  .expanded-branding .brand-tagline{
    font-style:italic;margin-bottom:16px;
  }
  .expanded-branding .brand-box{
    margin:16px 0;padding:16px;background:rgba(122,148,168,0.08);
    border-radius:8px;border:1px solid rgba(122,148,168,0.15);
  }
  .expanded-branding .brand-box p{
    margin:0;font-size:0.9rem;line-height:1.5;color:var(--text-color);opacity:0.9;
  }
  .expanded-branding .brand-box a{
    color:var(--main-color);text-decoration:none;font-weight:600;
  }
  .expanded-branding .brand-box a:hover{
    text-decoration:underline;
  }
  .expanded-branding .brand-copyright{
    margin-top:8px;font-size:0.8rem;opacity:0.6;
  }

  @media (max-width:640px){
    .nav-row{flex-direction:column}
    .btn{width:100%}
    .header h1{font-size:1.7rem}
    .growth-viz{flex-direction:column;gap:10px}
    .comparison-container{flex-direction:column;gap:15px}
  }

  @media (prefers-reduced-motion: reduce) {
    .step { animation: none; }
    .progress-fill { transition: none; }
    .btn { transition: none; }
  }
</style>
</head>
<body>
<div id="pageTop" style="position:absolute;top:0"></div>
<div class="container">

  <header class="header" id="mainHeader">
    <div class="header-controls">
      <button class="header-btn" id="themeBtn" aria-label="Toggle light and dark theme" title="Toggle theme">🌙</button>
    </div>
    <h1>🌊 Echo Eraser — Advanced Integration</h1>
    <p class="subtitle">For when belief work leaves an echo</p>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </header>

  <main class="content">
    <!-- STEP 0: The Journey So Far -->
    <section class="step active" data-step="0">
      <div class="step-indicator">
        <div class="step-counter">Step 1 of 8</div>
        <div class="dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🌊 The Journey So Far</h2>
      
      <div class="tip">
        <strong>New to this work?</strong> This tool is designed for after you've examined and shifted an original thought or belief. If you haven't done that deeper work yet, start here:
        <div style="display:flex;gap:12px;margin:12px 0;flex-wrap:wrap">
          <a href="../discernment-tools/thought-refiner.html" target="_blank" class="tool-link-btn">
            🔍 Thought Refiner
          </a>
          <a href="../discernment-tools/belief-threader.html" target="_blank" class="tool-link-btn">
            🧵 Belief Threader
          </a>
        </div>
      </div>

      <p class="lead">Before we begin, bring to mind one specific thought or belief you've already transformed using these tools. Having a clear focus will make your echo integration much more effective.</p>

      <div class="form-group">
        <label for="focusBelief">Which thought or belief are you working with today?</label>
        <input type="text" id="focusBelief" placeholder="I used to believe... / The thought I transformed was..."/>
        <div class="char-info">
          <div class="char-count" id="count0">0 characters</div>
          <div class="encouragement" id="enc0">Having a clear focus creates a foundation for meaningful integration.</div>
        </div>
      </div>

      <h3>Understanding Residue vs. Echo</h3>
      <p>You've done the hard work of letting go of old thoughts and beliefs. You've chosen better ones. So why doesn't it feel completely settled yet?</p>

      <div class="comparison-container">
        <div class="comparison-box">
          <div class="comparison-title">🔗 Residue</div>
          <p class="comparison-content">What you lived inside when the old belief was active - the sticky interference that clouded your perception.</p>
        </div>
        <div class="comparison-box">
          <div class="comparison-title">🌊 Echo</div>
          <p class="comparison-content">What remains after residue is cleared - a reverberation that's painful but almost in a good way, carrying both ache and growth.</p>
        </div>
      </div>

      <div class="key-insight">
        Key Insight: Residue binds. Echo reminds.
      </div>

      <div class="tip">
        💭 <strong>Think of it like this:</strong> Remember a time you had to work really hard to get out of a difficult situation. At the time it felt awful, but when you look back now, you might see how it was actually a rite of passage. You might even remember moments around that time that were really great - like meeting a friend who helped you through it.<br><br>

        The echo is that bittersweet feeling when you remember - it still reverberates, but it's no longer the same thing as the original pain.
      </div>

      <p class="sacred-quote">We do this work to walk closer to what is real and True.</p>

      <div class="tip"><strong>Integration Insight:</strong> The echo is not your enemy - it's a doorway to deeper freedom.</div>
      
      <div class="nav-row"><button class="btn btn-primary" id="next0" disabled>Complete focus to Continue</button></div>
      <div class="micro">Take your time. There's no rush here.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 1: Name Your Echo -->
    <section class="step" data-step="1">
      <div class="step-indicator">
        <div class="step-counter">Step 2 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🌊 Name Your Echo</h2>
      <p class="lead">You've cleared the residue, but something still hums in the background. This echo has a different quality - it's not the sticky interference anymore, but the memory of what was carried and what was released.</p>

      <h3>Echo Qualities</h3>
      <p>This echo often carries <strong>meaning alongside the ache</strong>. It reminds you of what was lost, but also of <strong>what was gained</strong>. Unlike residue, it doesn't block your clarity - but it can still stir emotions and sensations.</p>
      
      <p style="margin:16px 0;color:var(--contrast-color);font-style:italic">The echo is both a gentle ache and a doorway to understanding how far you've come.</p>

      <div class="form-group">
        <label for="echoFeeling">What does this echo feel like when it shows up?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Describe the quality of this reverberation - is it bittersweet? Nostalgic? A gentle ache? What does it remind you of?</p>
        <textarea id="echoFeeling" placeholder="This echo feels like... / It reminds me of... / There's this bittersweet sense that..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count1">0 characters</div>
          <div class="encouragement" id="enc1">You're not the echo - you're the one wise enough to notice its message.</div>
        </div>
      </div>

      <div class="tip"><strong>Integration Insight:</strong> Remember: Echoes often have a haunting but meaningful quality. They're not trying to trap you - they're completing something that needed to be acknowledged.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next1" disabled>Complete echo naming to Continue</button>
      </div>
      <div class="micro">Recognition is the first step toward integration.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 2: Where It Came From -->
    <section class="step" data-step="2">
      <div class="step-indicator">
        <div class="step-counter">Step 3 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>📍 Where It Came From</h2>
      <p class="lead">This echo didn't appear from nowhere. It's the reverberation of a belief you once carried - something that shaped how you saw yourself or the world.</p>

      <div class="journey-flow">
        <span class="journey-step">📍 Echo Origin</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">🔍 Understanding</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">💡 Insight</span>
        <div style="margin-top:8px;font-size:0.9rem;color:var(--contrast-color);font-style:italic">
          Understanding its origins helps you see why it still resonates.
        </div>
      </div>

      <div class="form-group">
        <label for="echoOrigin">What belief or experience left this echo behind?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">What was the original story or belief that you've since released? What did you once think was true that you no longer believe?</p>
        <textarea id="echoOrigin" placeholder="The belief that left this echo was... / I used to think... / The original story was..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count2">0 characters</div>
          <div class="encouragement" id="enc2">Understanding the source helps you see the echo clearly.</div>
        </div>
      </div>

      <div class="tip"><strong>Integration Insight:</strong> Often the beliefs that leave the strongest echoes are ones that once protected us or helped us make sense of difficult experiences. There's usually wisdom in why they existed.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next2" disabled>Complete origin exploration to Continue</button>
      </div>
      <div class="micro">Every echo has a story worth understanding.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 3: Contrast with New Truth -->
    <section class="step" data-step="3">
      <div class="step-indicator">
        <div class="step-counter">Step 4 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>☀️ Contrast with New Truth</h2>
      <p class="lead">You've traced the echo back to its source. Now let's honor the distance you've traveled. What truth do you carry now that you didn't have before?</p>

      <div class="growth-viz">
        <div class="growth-stage">
          <div style="font-size:2rem">⛅</div>
          <div style="font-size:0.9rem;margin-top:4px;color:var(--contrast-color)">THEN<br>(What was carried)</div>
        </div>
        <div class="growth-arrow">→ GROWTH →</div>
        <div class="growth-stage">
          <div style="font-size:2rem">☀️</div>
          <div style="font-size:0.9rem;margin-top:4px;color:var(--contrast-color)">NOW<br>(What truth you carry)</div>
        </div>
      </div>

      <p style="margin:16px 0;color:var(--text-color)">This contrast helps you see both why the echo persists and why it no longer defines you.</p>
      
      <p style="margin:16px 0;color:var(--contrast-color);font-style:italic">Sometimes we're so focused on what's still reverberating that we forget to appreciate how far we've come. The echo exists in contrast to your new truth - and that contrast is actually a testament to your growth.</p>

      <div class="form-group">
        <label for="newTruth">What truth do you carry now that you didn't have before?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">How do you see yourself, God, or the world differently now? What understanding has replaced the old belief?</p>
        <textarea id="newTruth" placeholder="Now I know that... / I've learned... / The truth I carry is..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count3">0 characters</div>
          <div class="encouragement" id="enc3">Recognizing your growth illuminates how far truth has brought you.</div>
        </div>
      </div>

      <div class="tip"><strong>Integration Insight:</strong> Growth often feels bittersweet because it requires letting go of what was once, but that no longer supports you.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next3" disabled>Complete contrast analysis to Continue</button>
      </div>
      <div class="micro">Growth often feels bittersweet because it requires letting go of what no longer supports you.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 4: Prepare for Sitting -->
    <section class="step" data-step="4">
      <div class="step-indicator">
        <div class="step-counter">Step 5 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🫖 Prepare for Sitting</h2>
      <p class="lead">You've named the echo, understood its origins, and seen the contrast with your new truth.</p>

      <div class="journey-flow">
        <span class="journey-step">🧠 UNDERSTANDING</span>
        <span class="journey-arrow">→</span>
        <span class="journey-step">🫖 BEING</span>
        <div style="margin-top:8px;font-size:0.9rem;color:var(--contrast-color);font-style:italic">
          Now we shift from understanding to simply being - sitting with the echo without trying to fix, analyze, or push it away.
        </div>
      </div>

      <h3>Why Sitting Works</h3>
      <p>Most people try to escape discomfort the moment they feel it. But echoes aren't emergencies - they're invitations to complete something that healing started. When you sit with an echo calmly, you teach your whole being that this feeling won't undo you.</p>

      <h3>What You'll Experience</h3>
      <div style="background:var(--accent-color);padding:16px;border-radius:8px;margin:16px 0">
        <div style="font-weight:600;color:var(--contrast-color);margin-bottom:8px">In the guided practice:</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px">
          <div>✓ Settle into quiet presence</div>
          <div>✓ Invite the echo gently</div>
          <div>✓ Sit without changing it</div>
          <div>✓ Let Truth speak into the space</div>
          <div>✓ Notice what emerges</div>
        </div>
      </div>

      <div class="tip"><strong>Remember:</strong> This isn't about making the echo disappear. It's about meeting it with the truth you now carry. Some echoes fade, some shift quality, some simply need acknowledgment. Any response is valid - trust what emerges.</div>

      <div style="text-align:center;margin:20px 0;">
        <button class="btn btn-primary sitting-btn">🫖 Begin Sitting Practice</button>
      </div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary">Integration →</button>
      </div>
      <div class="micro">Transformation often happens in the spaces between effort and surrender.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 5: Integration -->
    <section class="step" data-step="5">
      <div class="step-indicator">
        <div class="step-counter">Step 6 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>🕊️ Integration</h2>
      <p class="lead">You've just moved through the sitting practice - noticing the echo, creating space to settle together, bringing in your new understanding, and asking what Truth reveals. Whatever happened was exactly what needed to happen.</p>

      <div class="sacred-content">
        <h3 style="color:var(--main-color);margin-bottom:12px">Integration Truth</h3>
        <p style="margin:0">This isn't about getting it right - it's about creating space for what wants to emerge. Integration isn't always dramatic. Sometimes it's as simple as the echo feeling less important, or you feeling more spacious around it. Small shifts are still real transformation.</p>
      </div>

      <div class="form-group">
        <label for="sittingExperience">What did you notice as you moved through the sitting practice?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">How did the echo feel? What happened when you brought in your new understanding? Did Truth reveal anything to you in that space?</p>
        <textarea id="sittingExperience" placeholder="During the sitting, I noticed... / The echo felt... / When I brought in my new understanding... / Truth revealed..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count5">0 characters</div>
          <div class="encouragement" id="enc5">Each sitting practice teaches you something about how transformation works.</div>
        </div>
      </div>

      <div class="tip"><strong>Integration Insight:</strong> Remember: Integration isn't always dramatic. Sometimes it's as simple as the echo feeling less important, or you feeling more spacious around it. Small shifts are still real transformation.</div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next5" disabled>Complete integration to Continue</button>
      </div>
      <div class="micro">What we meet with patience often reveals its gift.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 6: Truth Speaking -->
    <section class="step" data-step="6">
      <div class="step-indicator">
        <div class="step-counter">Step 7 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div></div>
      </div>
      <h2>🌱 Truth Speaking</h2>
      <p class="lead">We're nearing the Truth and crux of this work, but let's reflect on the meaningful work you've done across multiple tools:</p>

      <div class="journey-flow">
        <div style="margin-bottom:12px">
          <span class="journey-step">🧠 Thought Refiner</span>
          <span style="font-size:0.9rem;color:var(--contrast-color)">(Distorted patterns → clarified)</span>
        </div>
        <div style="text-align:center;color:var(--main-color);margin:8px 0">↓</div>
        <div style="margin-bottom:12px">
          <span class="journey-step">🧵 Belief Threader</span>
          <span style="font-size:0.9rem;color:var(--contrast-color)">(Falsehoods → dissolved)</span>
        </div>
        <div style="text-align:center;color:var(--main-color);margin:8px 0">↓</div>
        <div style="margin-bottom:8px">
          <span class="journey-step">🫖 Sitting Practice</span>
          <span style="font-size:0.9rem;color:var(--contrast-color)">(Echo → beginning to fade)</span>
        </div>
        <div style="margin-top:12px;font-size:0.9rem;color:var(--contrast-color);font-style:italic">
          This work has created space for something beautiful to take root.
        </div>
      </div>

      <div class="warning-box">
        <h3 class="warning-title">⚠️ The Vacuum Principle</h3>
        <p class="warning-content">As the echo dissolves or fades, a space is left behind. That space will not remain empty. For true healing, it must be filled with Truth. If it isn't, it will be taken up by something else—usually whatever is loudest, easiest, or most familiar.</p>
        <p class="warning-note">This is not just psychological wisdom. It is a safeguard for the soul.</p>
      </div>

      <h3>🌱 What Truth Wants to Take Root</h3>
      <p>This is your opportunity to plant Truth where the old pattern once lived. What do you sense God wants to take root and grow in this newly cleared ground? What does He want you to know, carry, and walk in as you move forward?</p>

      <h3>🛡️ Spiritual Protection</h3>
      <p>When we intentionally fill cleared spaces with God's Truth, we prevent old patterns from returning and protect against spiritual re-occupation of the old thoughts and beliefs that don't belong to us anymore. This is the only Truth and returning to it time and again, with each thought and belief, builds your spiritual foundation.</p>

      <div class="form-group">
        <label for="truthPlanted">What Truth wants to fill this sacred space?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Speak the Truth that God wants to take root where the old pattern lived. What does He want you to know, carry, and walk in as you move forward?</p>
        <textarea id="truthPlanted" placeholder="In this space, God wants me to know... / The Truth taking root is... / He is planting this reality..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count6">0 characters</div>
          <div class="encouragement" id="enc6">Truth planted in sacred space becomes unshakeable foundation.</div>
        </div>
      </div>

      <div class="nav-row">
        <button class="btn btn-secondary">← Back</button>
        <button class="btn btn-primary" id="next6" disabled>Complete truth planting to Continue</button>
      </div>
      <div class="micro">Truth planted in sacred space becomes unshakeable foundation.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 7: Living with New Freedom -->
    <section class="step" data-step="7">
      <div class="step-indicator">
        <div class="step-counter">Step 8 of 8</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div></div>
      </div>
      <h2>✨ Living with New Freedom</h2>
      <p class="lead">You've completed profound work. You've named the echo, understood its origins, contrasted it with truth, sat with it patiently, and filled the sacred space with God's Truth. The echo may not be completely gone - and that's perfectly normal.</p>

      <div class="summary-box">
        <h3 class="summary-title">Your Integration Journey</h3>
        
        <div class="summary-item">
          <strong class="summary-label">Focus Belief:</strong>
          <p class="summary-content" id="sumFocus">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">Echo Noticed:</strong>
          <p class="summary-content" id="sumEcho">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">Origins Understood:</strong>
          <p class="summary-content" id="sumOrigins">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">New Truth Embraced:</strong>
          <p class="summary-content" id="sumNewTruth">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">Sitting Revealed:</strong>
          <p class="summary-content" id="sumSitting">—</p>
        </div>
        
        <div class="summary-item">
          <strong class="summary-label">Truth Planted:</strong>
          <p class="summary-content" id="sumTruthPlanted">—</p>
        </div>
      </div>

      <div class="form-group">
        <label for="freedomUnderstanding">What do you understand now about echoes and freedom?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">What has this process taught you about transformation, truth, and walking in freedom?</p>
        <textarea id="freedomUnderstanding" placeholder="I understand now that... / This process has shown me... / About freedom, I've learned..."></textarea>
        <div class="char-info">
          <div class="char-count" id="count7">0 characters</div>
          <div class="encouragement" id="enc7">Wisdom emerges when we reflect on the journey we've taken.</div>
        </div>
      </div>

      <h3>When Echoes Return</h3>
      <p>The echo may visit again - that's part of how deep change integrates. When it does, you can return to sitting, speaking truth, or simply acknowledging it with the understanding you now have. Each time, it has less power and you have more freedom.</p>

      <div class="final-actions">
        <button class="btn btn-primary">📄 Download Your Journey</button>
        <button class="btn btn-secondary">✨ Trinity Speaks</button>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;">← Back</button>
        <button class="btn btn-secondary" id="startOverBtn" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;">🔄 Start Over</button>
      </div>

      <div class="tool-description">
        <h3>🌊 Echo Eraser</h3>
        <p>Part of the comprehensive Five Anchors and Discernment Tools designed to help you find stability and clarity in overwhelming times.</p>
      </div>

      <div class="expanded-branding">
        <div class="brand-title">Created by Clarity Metabolics</div>
        <div class="brand-tagline">Finding balance in a chaotic world.</div>
        
        <div class="brand-box">
          <p>For the complete toolkit that addresses every aspect of human experience, visit <strong><a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></strong></p>
        </div>
        
        <div class="brand-copyright">© 2025 Clarity Metabolics | claritymetabolics.com</div>
      </div>
    </section>
  </main>
</div>

<!-- Sitting Practice Modal -->
<div id="sittingModal" class="modal">
  <div class="modal-content">
    <h3>🫖 Sitting Practice</h3>
    
    <div class="sitting-step">
      <div class="sitting-step-title">Step 1: Settle Into Stillness</div>
      <p>Find a comfortable position where you can sit quietly for the next few minutes. Close your eyes if that feels right, or soften your gaze downward.</p>
      <p>Take three slow, deep breaths. Let yourself settle more and more with each exhale.</p>
      <p style="font-style:italic;color:var(--contrast-color)">When you feel ready, let your breathing return to its natural rhythm. There's no hurry here.</p>
    </div>
    
    <div class="sitting-step">
      <div class="sitting-step-title">Step 2: Become Aware of the Echo</div>
      <p>Begin noticing the echo - the sensation of what once was. Don't chase it or manufacture it - simply make space for whatever shows up.</p>
      <p>Notice where you feel it. Is it in your chest? Your throat? Your stomach? Just observe without trying to change anything.</p>
      <p style="font-style:italic;color:var(--contrast-color)">You're not trying to solve or fix anything. You're simply being present with whatever it is you're sensing.</p>
    </div>
    
    <div class="sitting-step">
      <div class="sitting-step-title">Step 3: Rest in Its Presence</div>
      <p>Continue sitting with whatever you're experiencing. If the echo feels intense, breathe gently. If it feels distant, that's fine too.</p>
      <p>Remember: you are not the echo. You are simply creating a bit of room around it, for both you and the echo to just settle.</p>
      <p style="font-style:italic;color:var(--contrast-color)">Keep your breath smooth and stay here as long as feels right. There's no rushing this process.</p>
    </div>
    
    <div class="sitting-step">
      <div class="sitting-step-title">Step 4: Let Truth Enter</div>
      <p>Now, bring to mind the new thought or belief you formed. Not as a weapon against the echo, but as a light that can shine alongside it.</p>
      <p>Hold both - the echo of what was, and the understanding of what now is. Notice what happens when they meet in your awareness.</p>
      <p style="font-style:italic;color:var(--contrast-color)">In this space with the echo and your new understanding, what does Truth reveal? What do you notice that's simply True?</p>
    </div>
    
    <div class="sitting-step">
      <div class="sitting-step-title">Step 5: Gentle Completion</div>
      <p>Take a moment to appreciate what you've just done. You've sat with discomfort without trying to escape it. You've invited truth into a tender space.</p>
      <p>When you're ready, take a few deeper breaths and gently return your attention to the room around you.</p>
      <p style="font-style:italic;color:var(--contrast-color);font-weight:600">Whatever happened - or didn't happen - was exactly right. Trust the process of your own unfolding.</p>
    </div>
    
    <div style="text-align:center;margin-top:20px">
      <button class="btn btn-primary">Complete Practice</button>
    </div>
  </div>
</div>

<!-- Trinity Speaks Modal -->
<div id="trinityModal" class="modal">
  <div class="modal-content">
    <h3>✨ Trinity Speaks</h3>
    
    <div class="trinity-section">
      <div class="trinity-role">FATHER</div>
      <p>"Lord, help me release what no longer serves Your truth in my life."</p>
    </div>
    
    <div class="trinity-section">
      <div class="trinity-role">SON</div>
      <p>"Jesus, teach me to embrace the scars of growth as reminders of Your transforming power."</p>
    </div>
    
    <div class="trinity-section">
      <div class="trinity-role">HOLY SPIRIT</div>
      <p>"Spirit, guide me to recognize Your voice above the echoes of old patterns."</p>
    </div>
    
    <div class="scripture">
      <p style="font-style:italic;font-weight:600;margin-bottom:8px">"He heals the brokenhearted and binds up their wounds."</p>
      <p style="font-size:0.9rem;opacity:0.8">- Psalm 147:3</p>
    </div>
    
    <div style="text-align:center">
      <button class="btn btn-primary">Amen</button>
    </div>
  </div>
</div>


<script>
// ===== ECHO ERASER CORE JAVASCRIPT (MODULE 2) =====
// State Management
let currentStep = 0;
const totalSteps = 8;
const responses = {
  focusBelief: '',
  echoFeeling: '',
  echoOrigin: '',
  newTruth: '',
  sittingExperience: '',
  truthPlanted: '',
  freedomUnderstanding: ''
};

// ===== THEME TOGGLE =====
function initTheme() {
  const themeBtn = document.getElementById('themeBtn');
  if (!themeBtn) return;
  
  themeBtn.addEventListener('click', () => {
    const body = document.body;
    const btn = document.getElementById('themeBtn');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme');
      btn.textContent = '🌙';
    } else {
      body.setAttribute('data-theme', 'dark');
      btn.textContent = '☀️';
    }
  });
}

// ===== CHARACTER COUNT & ENCOURAGEMENT SYSTEM =====
function setupTextarea(textareaId, countId, encId, stepNum) {
  const textarea = document.getElementById(textareaId);
  const countEl = document.getElementById(countId);
  const encEl = document.getElementById(encId);
  const nextBtn = document.getElementById('next' + stepNum);
  
  if (!textarea || !countEl || !encEl) return;
  
  // Set initial button state
  if (nextBtn) updateButtonState(nextBtn, stepNum, false);
  
  textarea.addEventListener('input', () => {
    const count = textarea.value.length;
    countEl.textContent = `${count} characters`;
    
    // Show encouragement after 20 characters
    if (count > 20) {
      encEl.classList.add('show');
    } else {
      encEl.classList.remove('show');
    }
    
    // Update button state based on content
    if (nextBtn) {
      const hasContent = count > 0;
      updateButtonState(nextBtn, stepNum, hasContent);
    }
    
    // Auto-save
    saveCurrentResponse();
  });
}

// ===== BUTTON STATE MANAGEMENT =====
function updateButtonState(button, stepNum, hasContent) {
  const buttonStates = {
    '0': {
      disabled: 'Complete focus to Continue',
      enabled: 'Name Your Echo →'
    },
    '1': {
      disabled: 'Complete echo naming to Continue',
      enabled: 'Where It Came From →'
    },
    '2': {
      disabled: 'Complete origin exploration to Continue', 
      enabled: 'Contrast with Truth →'
    },
    '3': {
      disabled: 'Complete contrast analysis to Continue',
      enabled: 'Prepare for Sitting →'
    },
    '5': {
      disabled: 'Complete integration to Continue',
      enabled: 'Truth Speaking →'
    },
    '6': {
      disabled: 'Complete truth planting to Continue',
      enabled: 'Living with Freedom →'
    },
    '7': {
      disabled: 'Complete reflection to finish',
      enabled: 'Journey Complete ✨'
    }
  };
  
  const state = buttonStates[stepNum];
  if (state) {
    if (hasContent) {
      button.disabled = false;
      button.textContent = state.enabled;
    } else {
      button.disabled = true;
      button.textContent = state.disabled;
    }
  }
}

// ===== STEP NAVIGATION =====
function showStep(i) {
  // Hide all steps
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  
  // Show target step
  const stepEl = document.querySelector(`.step[data-step="${i}"]`);
  if (stepEl) stepEl.classList.add('active');

  // Update progress bar
  document.getElementById('progressFill').style.width = ((i) / (totalSteps - 1)) * 100 + '%';
  
  // Update progress dots
  document.querySelectorAll('.step .dots').forEach(group => {
    [...group.children].forEach((d, idx) => {
      d.classList.remove('active', 'done');
      if (idx < i) d.classList.add('done');
      if (idx === i) d.classList.add('active');
    });
  });

  // Smooth scroll to top and focus
  requestAnimationFrame(() => {
    document.getElementById('pageTop').scrollIntoView({ behavior: 'smooth', block: 'start' });
    setTimeout(() => {
      if (i === 0) document.getElementById('focusBelief')?.focus();
      if (i === 1) document.getElementById('echoFeeling')?.focus();
      if (i === 2) document.getElementById('echoOrigin')?.focus();
      if (i === 3) document.getElementById('newTruth')?.focus();
      if (i === 5) document.getElementById('sittingExperience')?.focus();
      if (i === 6) document.getElementById('truthPlanted')?.focus();
      if (i === 7) document.getElementById('freedomUnderstanding')?.focus();
    }, 100);
  });

  // Special handling for final step
  if (i === 7) {
    document.getElementById('mainHeader')?.classList.add('completed');
    updateSummary();
  }
}

function nextStep() {
  saveCurrentResponse();
  if (currentStep < totalSteps - 1) {
    currentStep++;
    showStep(currentStep);
  }
}

function prevStep() {
  if (currentStep > 0) {
    currentStep--;
    showStep(currentStep);
  }
}

// ===== NAVIGATION BUTTON SETUP =====
function setupNavigationButtons() {
  // Back buttons
  document.querySelectorAll('.btn-secondary').forEach(btn => {
    if (btn.textContent.includes('← Back')) {
      btn.addEventListener('click', prevStep);
    }
  });

  // Next buttons - specific handling for each step
  const nextButtons = [
    { id: 'next0', handler: nextStep },
    { id: 'next1', handler: nextStep },
    { id: 'next2', handler: nextStep },
    { id: 'next3', handler: nextStep },
    { id: 'next5', handler: nextStep },
    { id: 'next6', handler: nextStep }
  ];

  nextButtons.forEach(({ id, handler }) => {
    const btn = document.getElementById(id);
    if (btn) {
      btn.addEventListener('click', handler);
    }
  });

  // Special buttons that don't require validation
  document.querySelectorAll('.btn-primary').forEach(btn => {
    if (btn.textContent.includes('Integration →')) {
      btn.addEventListener('click', nextStep);
    }
  });
}

// ===== DATA PERSISTENCE =====
function saveCurrentResponse() {
  const fieldMap = {
    0: 'focusBelief',
    1: 'echoFeeling',
    2: 'echoOrigin',
    3: 'newTruth',
    5: 'sittingExperience',
    6: 'truthPlanted',
    7: 'freedomUnderstanding'
  };
  
  const fieldId = fieldMap[currentStep];
  if (fieldId) {
    const field = document.getElementById(fieldId);
    if (field) {
      responses[fieldId] = field.value.trim();
    }
  }
  
  // Save to localStorage
  try {
    localStorage.setItem('echoEraserResponses', JSON.stringify(responses));
  } catch (e) {
    // Silent fail - localStorage not available
  }
}

function loadSavedResponses() {
  try {
    const saved = localStorage.getItem('echoEraserResponses');
    if (saved) {
      const savedResponses = JSON.parse(saved);
      Object.assign(responses, savedResponses);
      
      // Populate form fields
      Object.keys(savedResponses).forEach(key => {
        const el = document.getElementById(key);
        if (el && savedResponses[key]) {
          el.value = savedResponses[key];
          
          // Update character count
          const stepMapping = {
            'focusBelief': '0',
            'echoFeeling': '1',
            'echoOrigin': '2',
            'newTruth': '3',
            'sittingExperience': '5',
            'truthPlanted': '6',
            'freedomUnderstanding': '7'
          };
          
          const stepNum = stepMapping[key];
          const countEl = document.getElementById('count' + stepNum);
          if (countEl) {
            countEl.textContent = `${savedResponses[key].length} characters`;
          }
          
          // Show encouragement if applicable
          if (savedResponses[key].length > 20) {
            const encEl = document.getElementById('enc' + stepNum);
            if (encEl) encEl.classList.add('show');
          }
          
          // Update button text and state if applicable
          const nextBtn = document.getElementById('next' + stepNum);
          if (nextBtn && savedResponses[key].length > 0) {
            updateButtonState(nextBtn, stepNum, true);
          }
        }
      });
    }
  } catch (e) {
    // Silent fail - localStorage not available
  }
}

// ===== SUMMARY UPDATE =====
function updateSummary() {
  const summaryFields = {
    'sumFocus': responses.focusBelief,
    'sumEcho': responses.echoFeeling,
    'sumOrigins': responses.echoOrigin,
    'sumNewTruth': responses.newTruth,
    'sumSitting': responses.sittingExperience,
    'sumTruthPlanted': responses.truthPlanted
  };

  Object.keys(summaryFields).forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = summaryFields[id] || '—';
    }
  });
}

// ===== START OVER FUNCTIONALITY =====
let startOverArmed = false;

function setupStartOver() {
  const startOverBtn = document.getElementById('startOverBtn');
  if (!startOverBtn) return;
  
  startOverBtn.addEventListener('click', confirmStartOver);
}

function confirmStartOver() {
  const btn = document.getElementById('startOverBtn');
  if (!startOverArmed) {
    startOverArmed = true;
    btn.classList.remove('btn-secondary');
    btn.classList.add('btn-warning');
    btn.textContent = 'Confirm Start Over';
    setTimeout(() => {
      if (startOverArmed) {
        startOverArmed = false;
        btn.classList.remove('btn-warning');
        btn.classList.add('btn-secondary');
        btn.textContent = '🔄 Start Over';
      }
    }, 3000);
  } else {
    restartTool();
  }
}

function restartTool() {
  // Clear responses
  Object.keys(responses).forEach(k => responses[k] = '');
  
  // Clear form fields
  document.querySelectorAll('textarea, input[type="text"]').forEach(t => t.value = '');
  
  // Reset character counts and encouragements
  document.querySelectorAll('.char-count').forEach(el => el.textContent = '0 characters');
  document.querySelectorAll('.encouragement').forEach(el => el.classList.remove('show'));
  
  // Reset buttons
  document.querySelectorAll('[id^="next"]').forEach(btn => btn.disabled = true);
  
  // Reset start over button
  const btn = document.getElementById('startOverBtn');
  if (btn) {
    startOverArmed = false;
    btn.className = 'btn btn-secondary';
    btn.textContent = '🔄 Start Over';
  }
  
  // Clear localStorage
  try {
    localStorage.removeItem('echoEraserResponses');
  } catch (e) {
    // Silent fail - localStorage not available
  }
  
  // Reset to first step
  currentStep = 0;
  showStep(currentStep);
  
  // Remove completed header styling
  document.getElementById('mainHeader')?.classList.remove('completed');
}
</script>

<script>
// ===== ECHO ERASER MODAL SYSTEMS (MODULE 3) =====

// ===== SITTING PRACTICE MODAL =====
function openSittingModal() {
  // Scroll to top first
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  const modal = document.getElementById('sittingModal');
  if (modal) {
    modal.style.display = 'flex';
    // Focus management for accessibility
    setTimeout(() => {
      const firstButton = modal.querySelector('.btn');
      if (firstButton) firstButton.focus();
    }, 100);
  }
}

function closeSittingModal() {
  const modal = document.getElementById('sittingModal');
  if (modal) {
    modal.style.display = 'none';
  }
}

// ===== TRINITY BLESSING MODAL =====
function openTrinityModal() {
  console.log('Opening Trinity Blessing Modal...');
  const modal = document.getElementById('trinityModal');
  if (modal) {
    // Scroll to top of page first
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    modal.style.display = 'flex';
    
    // Focus management for accessibility and user experience
    setTimeout(() => {
      const firstButton = modal.querySelector('.btn');
      if (firstButton) {
        firstButton.focus();
        // Ensure modal is at top of viewport
        modal.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 200);
  }
}

function closeTrinityModal() {
  console.log('Closing Trinity Blessing Modal...');
  const modal = document.getElementById('trinityModal');
  if (modal) {
    modal.style.display = 'none';
  }
}

// ===== MODAL EVENT HANDLERS =====
function setupModalEventHandlers() {
  // Sitting Practice Modal Events
  const sittingModal = document.getElementById('sittingModal');
  if (sittingModal) {
    // Click outside to close
    sittingModal.addEventListener('click', (e) => {
      if (e.target === sittingModal) {
        closeSittingModal();
      }
    });
    
    // Close button
    const sittingCloseBtn = sittingModal.querySelector('.btn-primary');
    if (sittingCloseBtn && sittingCloseBtn.textContent.includes('Complete Practice')) {
      sittingCloseBtn.addEventListener('click', closeSittingModal);
    }
  }
  
  // Trinity Blessing Modal Events
  const trinityModal = document.getElementById('trinityModal');
  if (trinityModal) {
    // Click outside to close
    trinityModal.addEventListener('click', (e) => {
      if (e.target === trinityModal) {
        closeTrinityModal();
      }
    });
    
    // Close button
    const trinityCloseBtn = trinityModal.querySelector('.btn-primary');
    if (trinityCloseBtn && trinityCloseBtn.textContent.includes('Amen')) {
      trinityCloseBtn.addEventListener('click', closeTrinityModal);
    }
  }
  
  // Escape key to close any open modal
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeSittingModal();
      closeTrinityModal();
    }
  });
}

// ===== SITTING PRACTICE BUTTON SETUP =====
function setupSittingPracticeButton() {
  // Find the sitting practice button
  const sittingBtns = document.querySelectorAll('.btn-primary');
  sittingBtns.forEach(btn => {
    if (btn.textContent.includes('🫖 Begin Sitting Practice')) {
      btn.addEventListener('click', openSittingModal);
    }
  });
  
  // Alternative selector if the above doesn't work
  const sittingBtn = document.querySelector('.sitting-btn');
  if (sittingBtn) {
    sittingBtn.addEventListener('click', openSittingModal);
  }
}

// ===== TRINITY BLESSING BUTTON SETUP =====
function setupTrinityBlessingButton() {
  // Find the trinity speaks button in final actions
  const finalActionBtns = document.querySelectorAll('.final-actions .btn-secondary');
  finalActionBtns.forEach(btn => {
    if (btn.textContent.includes('✨ Trinity Speaks')) {
      btn.addEventListener('click', openTrinityModal);
    }
  });
  
  // Alternative search in all buttons
  const allBtns = document.querySelectorAll('.btn-secondary');
  allBtns.forEach(btn => {
    if (btn.textContent.includes('✨ Trinity Speaks')) {
      btn.addEventListener('click', openTrinityModal);
    }
  });
}

// ===== MODAL ACCESSIBILITY ENHANCEMENTS =====
function enhanceModalAccessibility() {
  // Add ARIA attributes to modals
  const sittingModal = document.getElementById('sittingModal');
  if (sittingModal) {
    sittingModal.setAttribute('role', 'dialog');
    sittingModal.setAttribute('aria-modal', 'true');
    sittingModal.setAttribute('aria-labelledby', 'sitting-modal-title');
    
    // Add ID to title for aria-labelledby
    const sittingTitle = sittingModal.querySelector('h3');
    if (sittingTitle) {
      sittingTitle.id = 'sitting-modal-title';
    }
  }
  
  const trinityModal = document.getElementById('trinityModal');
  if (trinityModal) {
    trinityModal.setAttribute('role', 'dialog');
    trinityModal.setAttribute('aria-modal', 'true');
    trinityModal.setAttribute('aria-labelledby', 'trinity-modal-title');
    
    // Add ID to title for aria-labelledby
    const trinityTitle = trinityModal.querySelector('h3');
    if (trinityTitle) {
      trinityTitle.id = 'trinity-modal-title';
    }
  }
}

// ===== FOCUS TRAP FOR MODALS =====
function createFocusTrap(modal) {
  const focusableElements = modal.querySelectorAll(
    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
  );
  
  const firstElement = focusableElements[0];
  const lastElement = focusableElements[focusableElements.length - 1];
  
  modal.addEventListener('keydown', (e) => {
    if (e.key === 'Tab') {
      if (e.shiftKey) {
        // Shift + Tab
        if (document.activeElement === firstElement) {
          e.preventDefault();
          lastElement.focus();
        }
      } else {
        // Tab
        if (document.activeElement === lastElement) {
          e.preventDefault();
          firstElement.focus();
        }
      }
    }
  });
}

// ===== MODAL INITIALIZATION =====
function initModals() {
  // Setup event handlers
  setupModalEventHandlers();
  
  // Connect buttons to modals
  setupSittingPracticeButton();
  setupTrinityBlessingButton();
  
  // Enhance accessibility
  enhanceModalAccessibility();
  
  // Add focus traps
  const sittingModal = document.getElementById('sittingModal');
  const trinityModal = document.getElementById('trinityModal');
  
  if (sittingModal) createFocusTrap(sittingModal);
  if (trinityModal) createFocusTrap(trinityModal);
}
</script>

<script>
// ===== ECHO ERASER ADVANCED FEATURES (MODULE 4) =====

// ===== DOWNLOAD SUMMARY FUNCTIONALITY =====
function downloadSummary() {
  const timestamp = new Date().toLocaleDateString();
  let content = `Echo Integration Journey - ${timestamp}\n`;
  content += `Generated by Clarity Metabolics Discernment Toolkit\n\n`;
  content += `========================================\n\n`;
  
  // Add user responses with proper formatting
  if (responses.focusBelief) {
    content += `FOCUS BELIEF:\n${responses.focusBelief}\n\n`;
  }
  
  if (responses.echoFeeling) {
    content += `ECHO NOTICED:\n${responses.echoFeeling}\n\n`;
  }
  
  if (responses.echoOrigin) {
    content += `ORIGINS UNDERSTOOD:\n${responses.echoOrigin}\n\n`;
  }
  
  if (responses.newTruth) {
    content += `NEW TRUTH EMBRACED:\n${responses.newTruth}\n\n`;
  }
  
  if (responses.sittingExperience) {
    content += `SITTING REVEALED:\n${responses.sittingExperience}\n\n`;
  }
  
  if (responses.truthPlanted) {
    content += `TRUTH PLANTED:\n${responses.truthPlanted}\n\n`;
  }
  
  if (responses.freedomUnderstanding) {
    content += `FREEDOM UNDERSTANDING:\n${responses.freedomUnderstanding}\n\n`;
  }
  
  // Add Trinity Blessing content
  content += `========================================\n\n`;
  content += `TRINITY BLESSING:\n\n`;
  content += `Father: "You are deeply loved, even in the echoes. What you've experienced today is part of a larger healing I'm working in you. Trust the process, trust the timing, and know that every step toward truth is a step toward Me."\n\n`;
  content += `Son: "I understand echoes - even after My resurrection, the scars remained. But they became reminders of transformation, not shame. Let your echoes become testimonies of how far truth has brought you."\n\n`;
  content += `Holy Spirit: "I am the One who helps truth settle into every part of you - mind, body, and spirit. When echoes arise, I can help you respond with wisdom rather than react with fear. The work continues, and I am with you in it."\n\n`;
  content += `"He heals the brokenhearted and binds up their wounds." - Psalm 147:3\n\n`;
  content += `For more tools and support: claritymetabolics.github.io/clarity-tools`;
  
  // Create and trigger download
  try {
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `echo-integration-journey-${timestamp.replace(/\//g, '-')}.txt`;
    
    // Ensure the link is added to the document for Firefox compatibility
    document.body.appendChild(a);
    a.click();
    
    // Clean up
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
  } catch (error) {
    // Fallback: show content in a new window
    const newWindow = window.open('', '_blank');
    if (newWindow) {
      newWindow.document.write(`<pre>${content}</pre>`);
      newWindow.document.title = 'Echo Integration Journey';
    } else {
      alert('Download failed. Please ensure pop-ups are allowed and try again.');
    }
  }
}

// ===== DOWNLOAD BUTTON SETUP =====
function setupDownloadButton() {
  // Find download button in final actions
  const downloadBtns = document.querySelectorAll('.final-actions .btn-primary');
  downloadBtns.forEach(btn => {
    if (btn.textContent.includes('📄 Download Your Journey')) {
      btn.addEventListener('click', downloadSummary);
    }
  });
}

// ===== INITIALIZATION =====
function init() {
  // Load saved data
  loadSavedResponses();
  
  // Initialize theme
  initTheme();
  
  // Show first step
  showStep(0);
  
  // Setup navigation buttons
  setupNavigationButtons();
  
  // Setup start over functionality
  setupStartOver();
  
  // Initialize modals
  initModals();
  
  // Setup download functionality
  setupDownloadButton();
  
  // Setup textareas with delay to ensure DOM is ready
  setTimeout(() => {
    setupTextarea('focusBelief', 'count0', 'enc0', '0');
    setupTextarea('echoFeeling', 'count1', 'enc1', '1');
    setupTextarea('echoOrigin', 'count2', 'enc2', '2');
    setupTextarea('newTruth', 'count3', 'enc3', '3');
    setupTextarea('sittingExperience', 'count5', 'enc5', '5');
    setupTextarea('truthPlanted', 'count6', 'enc6', '6');
    setupTextarea('freedomUnderstanding', 'count7', 'enc7', '7');
  }, 100);
}

// ===== AUTO-INITIALIZATION =====
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>

</body>
</html>
