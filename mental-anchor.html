<!--
  ============================================================
  Clarity Metabolics - Mental Anchor: The Clarity Lens
  Interactive Web Tool for Post-Awakening Mental Clarity
  ============================================================
  
  Version: 3.0.0 (Final)
  Created: August 2025
  Author: Clarity Metabolics
  
  Description:
  7-step interactive tool to help users filter mental noise,
  distinguish truth from fear, and find grounded next steps.
  Part of the Five Anchors framework for post-awakening support.
  
  Features:
  - Progressive 7-step flow
  - Light/dark theme toggle
  - Download summary functionality
  - Meaningful reflection modal
  - Mobile responsive design
  - Progress tracking
  
  Usage:
  Standalone HTML file - no dependencies required
  Open in any modern web browser
  
  License: © 2025 Clarity Metabolics
  Website: https://claritymetabolics.com
  ============================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mental Anchor — The Clarity Lens</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --main-color:#B7AFA3;      /* primary (bar/buttons) */
    --accent-color:#EFEDE7;    /* soft panels */
    --contrast-color:#6A655B;  /* deep accent text/borders */
    --text-color:#333;
    --bg-color:#fff;
    --border-color:#d9d6cf;
    --shadow:0 2px 12px rgba(0,0,0,.08);
    --success-color:#5a7c41;   /* progress dots done */
    --warning-color:#dc3545;   /* Start Over confirm */
    --green-panel:#E5EBDD;
    --yellow-panel:#FFF8CC;
    --red-panel:#F5E6E6;
  }
  [data-theme="dark"]{
    --text-color:#e6e6e6;
    --bg-color:#1c1c1c;
    --border-color:#3b3a36;
    --accent-color:#2a2825;
    --shadow:0 2px 14px rgba(0,0,0,.35);
    --green-panel:#2d352a;
    --yellow-panel:#3a3620;
    --red-panel:#3a2828;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Open Sans',sans-serif;
    color:var(--text-color);
    background:var(--bg-color);
    line-height:1.6;
  }
  .container{max-width:780px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

  /* Header */
  .header{
    color:#fff;
    background:linear-gradient(135deg,var(--main-color),var(--contrast-color));
    padding:22px 18px 18px;
    position:relative;
    transition: box-shadow .5s ease;
  }
  .header.completed{ box-shadow:0 0 18px rgba(183,175,163,.55); }
  .header h1{
    font-family:'Libre Baskerville',serif;
    font-size:2rem;
    text-align:center;
    margin-bottom:6px;
  }
  .subtitle{ text-align:center; font-style:italic; opacity:.95; }

  .header-controls{ position:absolute; top:10px; right:10px; display:flex; gap:8px }
  .header-btn{
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.3);
    color:#fff;
    padding:.35rem .6rem;border-radius:18px;cursor:pointer;
    font-size:.8rem;transition:all .2s ease;
  }
  .header-btn:hover{background:rgba(255,255,255,.25)}

  .progress-bar{height:4px;background:rgba(255,255,255,.28);border-radius:3px;margin-top:14px;overflow:hidden}
  .progress-fill{height:100%;background:#fff;width:0%;transition:width .6s ease}

  /* Content & steps */
  main.content{flex:1;padding:22px}
  .step{display:none;animation:fade .25s ease}
  .step.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .step-indicator{ text-align:center; margin:10px 0 18px }
  .step-counter{font-weight:700;color:#ffffff; background:var(--contrast-color); display:inline-block; padding:4px 10px; border-radius:12px }
  .dots{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--border-color)}
  .dot.active{background:var(--main-color)}
  .dot.done{background:var(--success-color)}

  h2{font-family:'Libre Baskerville',serif;color:var(--main-color);font-size:1.7rem;margin:14px 0 10px}
  p.lead{opacity:.95;margin-bottom:10px}

  .tip{
    background:linear-gradient(135deg, rgba(183,175,163,.12), rgba(106,101,91,.06));
    border-left:4px solid var(--main-color);
    padding:12px;border-radius:0 8px 8px 0;margin:14px 0;font-style:italic
  }

  .form-group{margin:16px 0}
  label{display:block;font-weight:700;color:var(--contrast-color);margin-bottom:6px}
  textarea, input[type="text"]{
    width:100%;min-height:110px;resize:vertical;border:2px solid var(--border-color);
    border-radius:10px;padding:12px;font:inherit;color:inherit;background:var(--bg-color);
    transition:all .2s ease;
  }
  input[type="text"]{ min-height:auto; }
  textarea:focus, input[type="text"]:focus{
    outline:none;border-color:var(--main-color);box-shadow:0 0 0 3px rgba(183,175,163,.18)
  }

  /* Panels for G/Y/R */
  .panel{
    border:2px solid var(--border-color);
    border-radius:10px;
    padding:12px;
  }
  .panel h3{
    font-family:'Libre Baskerville',serif;
    font-size:1.1rem;
    margin-bottom:8px;
    color:var(--contrast-color);
  }

  /* Buttons */
  .nav-row{display:flex;gap:12px;align-items:center;margin-top:22px;padding-top:18px;border-top:1px solid var(--border-color)}
  .nav-row .btn{flex:1}
  .btn{
    border:none;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;
    transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--main-color);color:#fff}
  .btn-primary:hover{background:var(--contrast-color);box-shadow:var(--shadow);transform:translateY(-1px)}
  .btn-secondary{background:var(--accent-color);color:var(--contrast-color);border:1px solid var(--border-color)}
  .btn-secondary:hover{background:var(--border-color)}
  .btn-warning{background:var(--warning-color);color:#fff}
  .btn-warning:hover{background:#c82333}

  .micro{ text-align:center; margin-top:6px; font-style:italic; color:var(--contrast-color); opacity:.85 }

  /* Final actions + Next Phase CTA */
  .final-actions{
    display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;
  }
  .final-actions .btn{ display:block; width:100%; max-width:280px; min-height:50px; text-align:center; }

  .next-phase {
    margin-top: 22px;
    padding: 16px;
    background: var(--accent-color);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    text-align: center;
    box-shadow: var(--shadow);
  }
  .next-phase .lead {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.05rem;
    color: var(--contrast-color);
    margin-bottom: 10px;
  }
  .next-phase .sub {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 6px;
  }
  .next-phase .btn-next {
    margin-top: 10px;
    display: inline-block;
    padding: 12px 18px;
    border-radius: 10px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    background: var(--main-color);
    color: #fff;
    transition: transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .next-phase .btn-next:hover {
    background: var(--contrast-color);
    box-shadow: var(--shadow);
    transform: translateY(-1px);
  }

  /* Branding */
  .branding{ text-align:center; padding:18px; font-size:.85rem; color:var(--text-color); opacity:.75; border-top:1px solid var(--border-color) }
  .branding a{ color:var(--contrast-color); text-decoration:none }
  .branding a:hover{ text-decoration:underline }

  .scripture{font-style:italic;background:var(--accent-color);padding:16px;border-left:4px solid var(--main-color);border-radius:8px;margin:16px 0}

  @media (max-width:640px){
    .nav-row{flex-direction:column}
    .btn{width:100%}
  }

  @media (prefers-reduced-motion: reduce) {
    .step { animation: none; }
    .progress-fill { transition: none; }
    .btn { transition: none; }
  }
</style>
</head>
<body>
<div id="pageTop" style="position:absolute;top:0"></div>
<div class="container">

  <header class="header" id="mainHeader">
    <div class="header-controls">
      <button class="header-btn" id="themeBtn" aria-label="Toggle light and dark theme" title="Toggle theme">🌙</button>
    </div>
    <h1>Mental Anchor — The Clarity Lens</h1>
    <p class="subtitle">Sharpen your mental focus and see truth clearly.</p>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </header>

  <main class="content">
    <!-- STEP 0: Welcome -->
    <section class="step active" data-step="0">
      <div class="step-indicator">
        <div class="step-counter">Step 1 of 7</div>
        <div class="dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>The Clarity Lens</h2>
      <p class="lead">This is your space to clear mental fog, untangle chaotic thoughts, and choose a better next step. Take a couple of full, deep breaths and when you're settled in, let's begin.</p>
      <div class="nav-row"><button class="btn btn-primary" onclick="nextStep()">Begin →</button></div>
      <div class="micro">Take your time. There's no rush here.</div>
      <div class="branding">© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 1: Filter Out the Noise (stacked G/Y/R) -->
    <section class="step" data-step="1">
      <div class="step-indicator">
        <div class="step-counter">Step 2 of 7 — Filter Out the Noise</div>
        <div class="dots"><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Filter Out the Noise</h2>
      <p class="lead">Like static on a radio, mental noise makes it hard to hear the clear signal underneath. Distinguishing what's true from what's frenzied or fear-driven helps you respond rather than react.</p>

      <div class="form-group">
        <label for="thoughtInput"><strong>What's one thought that's really been on your mind?</strong></label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">This could be a worry, decision, situation, or anything that keeps coming up</p>
        <textarea id="thoughtInput" placeholder="Example: I'm (worried, concerned, overwhelmed, uncertain) about..." rows="3"></textarea>
      </div>

      <div class="form-group panel" style="background:var(--green-panel)">
        <h3>True &amp; Grounded — What's the clearest thought you see right now?</h3>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Write it exactly as it appears in your mind</p>
        <textarea id="trueGrounded" placeholder="What is factual, steady, or grounded about this thought?" rows="4"></textarea>
      </div>

      <div class="form-group panel" style="background:var(--yellow-panel)">
        <h3>Unknowns / Not Yet Clear — What's the thought?</h3>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Write it exactly as it appears in your mind</p>
        <textarea id="unknowns" placeholder="What facts are missing or not yet known? What remains to be seen?" rows="4"></textarea>
      </div>

      <div class="form-group panel" style="background:var(--red-panel)">
        <h3>Fear-Driven — What fear might be fueling it?</h3>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Identify the fear, story, or assumption that could be coloring how you see this.</p>
        <textarea id="fearDriven" placeholder="What sounds like panic, assumption, or distortion?" rows="4"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Consider deleting the words that sound like pressure or panic. Keep what's still true, solid, and clear.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" id="saveNoiseStep" onclick="nextStep()" disabled>Complete Filter Out the Noise textboxes to Continue</button>
      </div>
      <div class="micro">Clarity often starts by removing what doesn't belong.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 2: Zoom Out (Situational → Time Horizon) -->
    <section class="step" data-step="2">
      <div class="step-indicator">
        <div class="step-counter">Step 3 of 7 — Zoom Out</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Zoom Out</h2>
      <p class="lead">It's hard to see the forest when you're staring at one tree. Distance reveals patterns and possibilities that are invisible up close. Widen perspective to lower urgency and see options.</p>

      <div class="form-group">
        <label for="situationalReframe">Situational Reframe — How might this look from a bird's eye perspective?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Step back and imagine you're advising a friend going through this exact situation</p>
        <textarea id="situationalReframe" placeholder="What would you tell your friend? What do you see that they might be missing?"></textarea>
      </div>

      <div class="form-group">
        <label for="timeHorizon">Time Horizon — What matters across different time spans?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Urgency often fades with time, but importance reveals itself in the moment. Consider what feels urgent now vs. what will matter in 3 weeks, 3 months, 3 years</p>
        <textarea id="timeHorizon" placeholder="What matters most across these horizons? What fades with time?"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Take 3 slow breaths. Imagine you're viewing your situation on a map from above.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()">What's in Your Control →</button>
      </div>
      <div class="micro">Context calms urgency.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 3: What's in Your Control -->
    <section class="step" data-step="3">
      <div class="step-indicator">
        <div class="step-counter">Step 4 of 7 — What's in Your Control</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>What's in Your Control</h2>
      <p class="lead">Clarity comes when you stop wrestling with what isn't yours to solve. Separate what's yours to act on from what's yours to release, and find peace in your actual sphere of influence.</p>

      <div class="form-group">
        <label for="controlMine">Mine to Act On — What can you actually do right now?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Focus on small, concrete actions that are truly within your power</p>
        <textarea id="controlMine" placeholder="One or two tiny actions that are truly yours. Keep it doable."></textarea>
      </div>

      <div class="form-group">
        <label for="controlRelease">To Release — What isn't yours to carry?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Name what belongs to others, time, or circumstances beyond your control</p>
        <textarea id="controlRelease" placeholder="What isn't yours to carry or solve right now?"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Say out loud: "I'll do my part, and release what isn't mine."</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Spot the Pattern →</button>
      </div>
      <div class="micro">Discernment reduces overwhelm.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 4: Spot the Pattern (enriched) -->
    <section class="step" data-step="4">
      <div class="step-indicator">
        <div class="step-counter">Step 5 of 7 — Spot the Pattern</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Spot the Pattern</h2>
      <p class="lead">You can't change what you can't see, but once you spot the pattern, you have options and can change your results for the better. Recognize recurring narratives or stories you tell yourself about situations, so you can respond differently.</p>

      <div class="form-group">
        <label for="patternSeen">Pattern Recognition — Where have you seen this before?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Notice if this thought feels familiar from other situations or times in your life</p>
        <textarea id="patternSeen" placeholder="A personal loop, a family script, or a social storyline…"></textarea>
      </div>

      <div class="form-group">
        <label for="patternFollows">Pattern Impact — What happens when you follow this pattern?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">Name the usual outcome, and what changes when you interrupt it</p>
        <textarea id="patternFollows" placeholder="Name the usual outcome—and the alternative you want."></textarea>
      </div>

      <div class="form-group">
        <label for="mentalAnchorStatement">Your Mental Anchor Statement — What clarity will you hold onto?</label>
        <p style="font-size:0.9rem;font-style:italic;color:var(--contrast-color);opacity:0.8;margin:0 0 12px 0">A simple truth about your thinking that you can return to when mental fog returns</p>
        <textarea id="mentalAnchorStatement" placeholder="Even when everything feels uncertain, I know that..."></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Read your mental anchor statement once aloud, slowly. Let this clarity settle into your mind.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Your Clarity Lens →</button>
      </div>
      <div class="micro">Awareness opens new options.</div>
      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 5: Recap + Sacred Reflection -->
    <section class="step" data-step="5">
      <div class="step-indicator">
        <div class="step-counter">Step 6 of 7 — Summary</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div></div>
      </div>
      <h2>Your Clarity Lens Summary</h2>
      <p>You filtered for truth, widened your view, chose what's yours, and named the pattern. You've transformed chaotic thoughts into clear, actionable insight.</p>

      <div style="background:var(--accent-color);padding:16px;border-radius:10px;margin:12px 0">
        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color)">Filter the Noise</h3>
        <p id="sumNoise">—</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">Zoom Out</h3>
        <p id="sumZoom">—</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">What's in Your Control</h3>
        <p id="sumControl">—</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">Spot the Pattern</h3>
        <p id="sumPattern">—</p>
      </div>

      <!-- Mental Anchor Statement Highlight -->
      <div style="background:linear-gradient(135deg,var(--main-color),var(--contrast-color));color:#fff;padding:20px;border-radius:12px;margin:20px 0;text-align:center;box-shadow:var(--shadow)">
        <h3 style="font-family:'Libre Baskerville',serif;font-size:1.2rem;margin-bottom:12px;opacity:0.9">Your Mental Anchor Statement</h3>
        <p id="mentalAnchorHighlight" style="font-family:'Libre Baskerville',serif;font-size:1.1rem;font-style:italic;line-height:1.6">—</p>
        <p style="font-size:0.85rem;margin-top:10px;opacity:0.8">Your clarity to return to when mental fog returns</p>
      </div>

      <div class="final-actions">
        <button class="btn btn-primary" onclick="downloadSummary()">📄 Download Summary</button>
        <button class="btn btn-secondary" onclick="openMeaningful()">✨ Meaningful Reflection</button>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="prevStep()">← Back</button>
        <button class="btn btn-primary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="nextStep()">Next Steps →</button>
      </div>

      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 6: Emotional Anchor lead-in -->
    <section class="step" data-step="6">
      <div class="step-indicator">
        <div class="step-counter">Step 7 of 7 — Next Step</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div></div>
      </div>
      <h2>Your Next Anchor: Emotional</h2>
      <p class="lead">Now that your mind is clearer and less reactive, let's steady your emotional footing so your feelings support rather than overwhelm you.</p>

      <div class="next-phase" aria-label="Move to Emotional Anchor">
        <div class="lead"><strong>Carry your clarity into how you feel.</strong></div>
        <button class="btn-next" onclick="goToEmotionalAnchor()">→ Begin the Emotional Anchor</button>
        <div class="sub">Learn to respond from a grounded heart, not just a clear head.</div>
      </div>

      <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin:22px 0; width:100%;">
        <button class="btn btn-secondary" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="prevStep()">← Back</button>
        <button class="btn btn-secondary" id="startOverBtn" style="display:block; width:100%; max-width:280px; min-height:50px; text-align:center;" onclick="confirmStartOver()">🔄 Start Over</button>
      </div>

      <div class="branding">
        <div><strong>Created by Clarity Metabolics</strong></div>
        <div style="font-style:italic;margin-top:4px">Quiet the world. Reconnect with what's real.</div>
        <div><a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
      </div>

      <div class="branding">© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>
  </main>
</div>

<!-- Meaningful Reflection Modal -->
<div id="meaningfulModal" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000">
  <div style="background:var(--bg-color);color:var(--text-color);max-width:560px;width:100%;max-height:90vh;border-radius:12px;box-shadow:var(--shadow);padding:22px;overflow-y:auto">
    <h3 style="font-family:'Libre Baskerville',serif;color:var(--main-color);margin-bottom:8px">Meaningful Reflection</h3>
    <div class="scripture" style="margin:10px 0 16px 0">
      <div style="margin-bottom:24px">
        <p style="font-size:1.1rem;font-weight:700;color:var(--main-color);margin-bottom:8px">FATHER</p>
        <p style="margin-left:16px;line-height:1.7">Guide me toward Your truth and away from confusion. Help me see clearly and think with Your wisdom.</p>
      </div>
      
      <div style="margin-bottom:24px">
        <p style="font-size:1.1rem;font-weight:700;color:var(--main-color);margin-bottom:8px">SON</p>
        <p style="margin-left:16px;line-height:1.7">Thank You for showing me how to walk in clarity and grace. Transform my thoughts to align with Your truth.</p>
      </div>
      
      <div style="margin-bottom:24px">
        <p style="font-size:1.1rem;font-weight:700;color:var(--main-color);margin-bottom:8px">HOLY SPIRIT</p>
        <p style="margin-left:16px;line-height:1.7">Reveal what I could not see on my own. Illuminate my mind and help me discern Your voice above the noise.</p>
      </div>
      
      <p style="margin-top:28px;font-style:italic;text-align:center;opacity:0.9">✨ <strong>"Trust in the Lord with all your heart and lean not on your own understanding." — Proverbs 3:5</strong></p>
    </div>
    <div style="text-align:center">
      <button class="btn btn-primary" onclick="closeMeaningful()">Amen</button>
    </div>
  </div>
</div>

<script>
  // --- State
  let currentStep = 0;
  const totalSteps = 7;
  const responses = {
    thoughtInput:'', trueGrounded:'', unknowns:'', fearDriven:'',
    situationalReframe:'', timeHorizon:'',
    controlMine:'', controlRelease:'',
    patternSeen:'', patternFollows:'', mentalAnchorStatement:''
  };

  // Light / Dark toggle
  document.getElementById('themeBtn').addEventListener('click', () => {
    const body = document.body;
    const btn = document.getElementById('themeBtn');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme'); btn.textContent = '🌙';
    } else {
      body.setAttribute('data-theme','dark'); btn.textContent = '☀️';
    }
  });

  // Step navigation helpers
  function showStep(i){
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    const stepEl = document.querySelector(`.step[data-step="${i}"]`);
    if (stepEl) stepEl.classList.add('active');

    document.getElementById('progressFill').style.width = ((i)/ (totalSteps-1)) * 100 + '%';
    document.querySelectorAll('.step .dots').forEach(group => {
      [...group.children].forEach((d, idx) => {
        d.classList.remove('active','done');
        if (idx < i) d.classList.add('done');
        if (idx === i) d.classList.add('active');
      });
    });

    requestAnimationFrame(()=>{
      document.getElementById('pageTop').scrollIntoView({behavior:'auto',block:'start'});
      setTimeout(()=>{
        if (i===1) document.getElementById('thoughtInput')?.focus();
        if (i===2) document.getElementById('situationalReframe')?.focus();
        if (i===3) document.getElementById('controlMine')?.focus();
        if (i===4) document.getElementById('patternSeen')?.focus();
      },100);
    });

    if (i===5){ document.getElementById('mainHeader')?.classList.add('completed'); updateSummary(); }
  }

  function nextStep(){ saveCurrent(); if (currentStep < totalSteps-1){ currentStep++; showStep(currentStep); } }
  function prevStep(){ if (currentStep>0){ currentStep--; showStep(currentStep);} }

  // Save per-step
  function saveCurrent(){
    switch(currentStep){
      case 1:
        responses.thoughtInput = document.getElementById('thoughtInput').value.trim();
        responses.trueGrounded = document.getElementById('trueGrounded').value.trim();
        responses.unknowns = document.getElementById('unknowns').value.trim();
        responses.fearDriven = document.getElementById('fearDriven').value.trim();
        break;
      case 2:
        responses.situationalReframe = document.getElementById('situationalReframe').value.trim();
        responses.timeHorizon = document.getElementById('timeHorizon').value.trim();
        break;
      case 3:
        responses.controlMine = document.getElementById('controlMine').value.trim();
        responses.controlRelease = document.getElementById('controlRelease').value.trim();
        break;
      case 4:
        responses.patternSeen = document.getElementById('patternSeen').value.trim();
        responses.patternFollows = document.getElementById('patternFollows').value.trim();
        responses.mentalAnchorStatement = document.getElementById('mentalAnchorStatement').value.trim();
        break;
    }
    // Save to localStorage
    try {
      localStorage.setItem('mentalAnchorResponses', JSON.stringify(responses));
    } catch (e) {
      console.warn('Could not save to localStorage:', e);
    }
  }

  // Summary
  function updateSummary(){
    const noiseHTML = [
      '<strong>Original Thought:</strong> ' + (responses.thoughtInput || '—'),
      '<strong>True & Grounded:</strong> ' + (responses.trueGrounded || '—'),
      '<strong>Unknowns:</strong> ' + (responses.unknowns || '—'),
      '<strong>Fear-Driven:</strong> ' + (responses.fearDriven || '—')
    ].join('<br>');

    document.getElementById('sumNoise').innerHTML = noiseHTML;
    document.getElementById('sumZoom').innerHTML = [
      '<strong>Situational Reframe:</strong> ' + (responses.situationalReframe || '—'),
      '<strong>Time Horizon (3w/3m/3y):</strong> ' + (responses.timeHorizon || '—')
    ].join('<br>');

    document.getElementById('sumControl').innerHTML = [
      '<strong>Mine to Act On:</strong> ' + (responses.controlMine || '—'),
      '<strong>To Release:</strong> ' + (responses.controlRelease || '—')
    ].join('<br>');

    document.getElementById('sumPattern').innerHTML = [
      '<strong>Seen Before:</strong> ' + (responses.patternSeen || '—'),
      '<strong>What Follows / Alternative:</strong> ' + (responses.patternFollows || '—'),
      '<strong>Mental Anchor Statement:</strong> ' + (responses.mentalAnchorStatement || '—')
    ].join('<br>');
    
    // Update highlighted mental anchor statement
    document.getElementById('mentalAnchorHighlight').textContent = responses.mentalAnchorStatement || 'Your mental anchor statement will appear here';
  }

  // Start Over confirm
  let startOverArmed = false;
  function confirmStartOver(){
    const btn = document.getElementById('startOverBtn');
    if (!startOverArmed){
      startOverArmed = true;
      btn.classList.remove('btn-secondary'); btn.classList.add('btn-warning');
      btn.textContent = 'Confirm Start Over';
      setTimeout(()=>{ if(startOverArmed){
        startOverArmed=false; btn.classList.remove('btn-warning'); btn.classList.add('btn-secondary'); btn.textContent='🔄 Start Over';
      }},3000);
    } else { restartTool(); }
  }

  function restartTool(){
    Object.keys(responses).forEach(k => responses[k] = '');
    document.querySelectorAll('textarea, input[type="text"]').forEach(t => t.value='');
    const btn = document.getElementById('startOverBtn');
    if (btn){ startOverArmed=false; btn.className='btn btn-secondary'; btn.textContent='🔄 Start Over'; }
    const saveBtn = document.getElementById('saveNoiseStep'); if (saveBtn) saveBtn.disabled = true;
    try {
      localStorage.removeItem('mentalAnchorResponses');
    } catch (e) {
      console.warn('Could not clear localStorage:', e);
    }
    currentStep = 0; showStep(currentStep);
  }

  // Download summary
  function downloadSummary(){
    const lines = [
      'Mental Anchor — The Clarity Lens (Session Summary)',
      'Generated: ' + new Date().toLocaleString(),
      '',
      'FILTER OUT THE NOISE:',
      'Original Thought: ' + (responses.thoughtInput || '—'),
      'True & Grounded: ' + (responses.trueGrounded || '—'),
      'Unknowns: ' + (responses.unknowns || '—'),
      'Fear-Driven: ' + (responses.fearDriven || '—'),
      '',
      'ZOOM OUT:',
      'Situational Reframe: ' + (responses.situationalReframe || '—'),
      'Time Horizon (3w/3m/3y): ' + (responses.timeHorizon || '—'),
      '',
      'WHAT\'S IN YOUR CONTROL:',
      'Mine to Act On: ' + (responses.controlMine || '—'),
      'To Release: ' + (responses.controlRelease || '—'),
      '',
      'SPOT THE PATTERN:',
      'Seen Before: ' + (responses.patternSeen || '—'),
      'What Follows / Alternative: ' + (responses.patternFollows || '—'),
      'Mental Anchor Statement: ' + (responses.mentalAnchorStatement || '—'),
      '',
      '— © 2025 Clarity Metabolics | claritymetabolics.com'
    ].join('\n');

    const blob = new Blob([lines],{type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href=url; a.download='mental-anchor-clarity-lens-summary.txt';
    document.body.appendChild(a); a.click();
    document.body.removeChild(a); URL.revokeObjectURL(url);
  }

  // Meaningful Reflection modal
  function openMeaningful(){ document.getElementById('meaningfulModal').style.display='flex'; }
  function closeMeaningful(){ document.getElementById('meaningfulModal').style.display='none'; }

  // Emotional Anchor link (update route when ready)
  function goToEmotionalAnchor(){
    window.location.href = 'https://claritymetabolics.github.io/clarity-tools/emotional-anchor.html';);
  }

  // Enable/disable Save on STEP 1
  function checkFilterInputs() {
    const g = document.getElementById('trueGrounded')?.value.trim() || '';
    const y = document.getElementById('unknowns')?.value.trim() || '';
    const r = document.getElementById('fearDriven')?.value.trim() || '';
    const saveBtn = document.getElementById('saveNoiseStep');
    if (saveBtn) {
      const hasContent = !!(g || y || r);
      saveBtn.disabled = !hasContent;
      saveBtn.textContent = hasContent ? 'Zoom Out →' : 'Complete Filter Out the Noise textboxes to Continue';
    }
  }

  // Init
  function init(){ 
    // Load saved responses
    try {
      const saved = localStorage.getItem('mentalAnchorResponses');
      if (saved) {
        const savedResponses = JSON.parse(saved);
        Object.assign(responses, savedResponses);
        // Populate form fields
        Object.keys(savedResponses).forEach(key => {
          const el = document.getElementById(key);
          if (el && savedResponses[key]) el.value = savedResponses[key];
        });
      }
    } catch (e) {
      console.warn('Could not load from localStorage:', e);
    }
    
    showStep(0);
    setTimeout(() => {
      ['trueGrounded','unknowns','fearDriven'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', checkFilterInputs);
      });
      // Check button state on load
      checkFilterInputs();
    }, 100);
  }
  if (document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
</script>
</body>
</html>
