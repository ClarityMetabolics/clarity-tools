<!--
  ============================================================
  Project: Clarity Metabolics â€” 5 Anchors
  Module: Mental Anchor â€” The Clarity Lens
  File: mental-anchor-v1.2.html
  Version: 1.2.0
  Build Date: 2025-08-08
  Author: ChatGPT (prep for Claude)
  ------------------------------------------------------------
  Changelog
  - v1.2.0: Step 1 adds third column (ðŸŸ¡ Not Mine / Unsure) alongside
            ðŸŸ¢ Clarity & My Part and ðŸ”´ Fear-Driven. Button enable logic
            updated; summary includes all three; mobile stacking tuned.
  - v1.1.0: 3-step flow (Filter / Zoom Out / Pattern) with micro-practices,
            progress bar, light/dark toggle, Sacred Reflection modal,
            stacked final actions, Emotional Anchor handoff, download summary.
  - v1.0.0: Minimal 3-panel base with toggles and structural anchors.
  ------------------------------------------------------------
  Editing Notes
  - Keep this as MASTER. For changes, save as mental-anchor-v1.2.X.html
    and update Version + Changelog.
  - Section anchors like <!-- STEP 1: Filter the Noise --> help target edits safely.
  ============================================================
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mental Anchor â€” The Clarity Lens</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    /* Mental Anchor palette */
    --main-color:#B7AFA3;      /* primary (bar/buttons) */
    --accent-color:#EFEDE7;    /* soft panels */
    --contrast-color:#6A655B;  /* deep accent text/borders */
    --text-color:#333;
    --bg-color:#fff;
    --border-color:#d9d6cf;
    --shadow:0 2px 12px rgba(0,0,0,.08);
    --success-color:#5a7c41;   /* progress dots done */
    --warning-color:#dc3545;   /* Start Over confirm */

    /* Traffic-light fills */
    --green-fill:#E7F3E7;
    --yellow-fill:#FFF7DD;
    --red-fill:#FBE9E9;
  }
  [data-theme="dark"]{
    --text-color:#e6e6e6;
    --bg-color:#1c1c1c;
    --border-color:#3b3a36;
    --accent-color:#2a2825;
    --shadow:0 2px 14px rgba(0,0,0,.35);

    --green-fill:#1f2a1f;
    --yellow-fill:#3a3218;
    --red-fill:#3a1f1f;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:'Open Sans',sans-serif;
    color:var(--text-color);
    background:var(--bg-color);
    line-height:1.6;
  }
  .container{max-width:780px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

  /* Header */
  .header{
    color:#fff;
    background:linear-gradient(135deg,var(--main-color),var(--contrast-color));
    padding:22px 18px 18px;
    position:relative;
    transition: box-shadow .5s ease;
  }
  .header.completed{ box-shadow:0 0 18px rgba(183,175,163,.55); }
  .header h1{
    font-family:'Libre Baskerville',serif;
    font-size:2rem;
    text-align:center;
    margin-bottom:6px;
  }
  .subtitle{ text-align:center; font-style:italic; opacity:.95; }
  .header-controls{ position:absolute; top:10px; right:10px; display:flex; gap:8px }
  .header-btn{
    background:rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.3);
    color:#fff;
    padding:.35rem .6rem;border-radius:18px;cursor:pointer;
    font-size:.8rem;transition:all .2s ease;
  }
  .header-btn:hover{background:rgba(255,255,255,.25)}
  .progress-bar{height:4px;background:rgba(255,255,255,.28);border-radius:3px;margin-top:14px;overflow:hidden}
  .progress-fill{height:100%;background:#fff;width:0%;transition:width .6s ease}

  /* Content & steps */
  main.content{flex:1;padding:22px}
  .step{display:none;animation:fade .25s ease}
  .step.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .step-indicator{ text-align:center; margin:10px 0 18px }
  .step-counter{font-weight:700;color:#ffffff; background:var(--contrast-color); display:inline-block; padding:4px 10px; border-radius:12px }
  .dots{display:flex;justify-content:center;gap:8px;margin-top:10px}
  .dot{width:12px;height:12px;border-radius:50%;background:var(--border-color)}
  .dot.active{background:var(--main-color)}
  .dot.done{background:var(--success-color)}

  h2{font-family:'Libre Baskerville',serif;color:var(--main-color);font-size:1.7rem;margin:14px 0 10px}
  p.lead{opacity:.95;margin-bottom:10px}

  .tip{
    background:linear-gradient(135deg, rgba(183,175,163,.12), rgba(106,101,91,.06));
    border-left:4px solid var(--main-color);
    padding:12px;border-radius:0 8px 8px 0;margin:14px 0;font-style:italic
  }

  .form-group{margin:16px 0}
  label{display:block;font-weight:700;color:var(--contrast-color);margin-bottom:6px}
  textarea, input[type="text"]{
    width:100%;min-height:110px;resize:vertical;border:2px solid var(--border-color);
    border-radius:10px;padding:12px;font:inherit;color:inherit;background:var(--bg-color);
    transition:all .2s ease;
  }
  input[type="text"]{ min-height:auto; }
  textarea:focus, input[type="text"]:focus{
    outline:none;border-color:var(--main-color);box-shadow:0 0 0 3px rgba(183,175,163,.18)
  }

  /* Navigation buttons */
  .nav-row{display:flex;gap:12px;align-items:center;margin-top:22px;padding-top:18px;border-top:1px solid var(--border-color)}
  .nav-row .btn{flex:1}
  .btn{
    border:none;border-radius:10px;padding:14px 18px;font-weight:700;cursor:pointer;
    transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .btn-primary{background:var(--main-color);color:#fff}
  .btn-primary:hover{background:var(--contrast-color);box-shadow:var(--shadow);transform:translateY(-1px)}
  .btn-secondary{background:var(--accent-color);color:var(--contrast-color);border:1px solid var(--border-color)}
  .btn-secondary:hover{background:var(--border-color)}
  .btn-warning{background:var(--warning-color);color:#fff}
  .btn-warning:hover{background:#c82333}

  .micro{ text-align:center; margin-top:6px; font-style:italic; color:var(--contrast-color); opacity:.85 }

  /* Final-screen: stacked action buttons */
  .final-actions{
    display:flex; flex-direction:column; align-items:center; gap:12px; margin:18px 0; width:100%;
  }
  .final-actions .btn{ display:block; width:100%; max-width:280px; min-height:50px; text-align:center; }

  /* Next-phase CTA on final screen */
  .next-phase {
    margin-top: 22px;
    padding: 16px;
    background: var(--accent-color);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    text-align: center;
    box-shadow: var(--shadow);
  }
  .next-phase .lead {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.05rem;
    color: var(--contrast-color);
    margin-bottom: 10px;
  }
  .next-phase .sub {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-top: 6px;
  }
  .next-phase .btn-next {
    margin-top: 10px;
    display: inline-block;
    padding: 12px 18px;
    border-radius: 10px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    background: var(--main-color);
    color: #fff;
    transition: transform .1s ease, background .2s ease, box-shadow .2s ease;
  }
  .next-phase .btn-next:hover {
    background: var(--contrast-color);
    box-shadow: var(--shadow);
    transform: translateY(-1px);
  }

  /* Traffic-light grid (Step 1) */
  .traffic-grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:12px;
    margin: 14px 0;
  }
  .bucket{
    border:2px solid var(--border-color);
    border-radius:10px;
    padding:10px;
    background:var(--accent-color);
  }
  .bucket.green textarea{ background:var(--green-fill); }
  .bucket.yellow textarea{ background:var(--yellow-fill); }
  .bucket.red textarea{ background:var(--red-fill); }
  .bucket h3{
    margin:0 0 8px 0;
    font-family:'Libre Baskerville',serif;
    color:var(--contrast-color);
    font-size:1.05rem;
  }
  .bucket small{ display:block; opacity:.85; margin:-6px 0 8px 0; color:var(--contrast-color) }

  @media (max-width:860px){
    .traffic-grid{ grid-template-columns: 1fr; }
  }

  /* Branding */
  .branding{ text-align:center; padding:18px; font-size:.85rem; color:var(--text-color); opacity:.75; border-top:1px solid var(--border-color) }
  .branding a{ color:var(--contrast-color); text-decoration:none }
  .branding a:hover{ text-decoration:underline }

  .scripture{font-style:italic;background:var(--accent-color);padding:16px;border-left:4px solid var(--main-color);border-radius:8px;margin:16px 0}
  .cross-link{ background:linear-gradient(135deg,var(--main-color),var(--contrast-color)); color:#fff; padding:14px; text-align:center; border-radius:10px; margin-top:18px }
</style>
</head>

<body>
<div id="pageTop" style="position:absolute;top:0"></div>
<div class="container">

  <header class="header" id="mainHeader">
    <div class="header-controls">
      <button class="header-btn" id="themeBtn" title="Toggle theme">ðŸŒ™</button>
    </div>
    <h1>Mental Anchor â€” The Clarity Lens</h1>
    <p class="subtitle">Sharpen your mental focus and see truth clearly.</p>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  </header>

  <main class="content">
    <!-- STEP 0: Intro -->
    <section class="step active" data-step="0">
      <div class="step-indicator">
        <div class="step-counter">Step 1 of 5</div>
        <div class="dots">
          <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
      </div>
      <h2>Welcome</h2>
      <p class="lead">When the mind feels noisy, your clarity lens can focus and refine what's real. This tool walks you through three simple steps you can recall anytime.</p>
      <div class="nav-row"><button class="btn btn-primary" onclick="nextStep()">Begin</button></div>
      <div class="micro">Take your time. There's no rush here.</div>
      <div class="branding">Â© 2025 Clarity Metabolics | <a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
    </section>

    <!-- STEP 1: Filter Out the Noise -->
    <section class="step" data-step="1">
      <div class="step-indicator">
        <div class="step-counter">Step 2 of 5 â€” Filter Out the Noise</div>
        <div class="dots"><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Filter Out the Noise</h2>
      <p class="lead">Distinguishing what's true from what's fear-driven helps you choose your response instead of reacting on autopilot.</p>

      <div class="form-group">
        <label for="thoughtInput"><strong>What's one thought that's really been on your mind lately?</strong></label>
        <textarea id="thoughtInput" placeholder="Type your thought here..." rows="3"></textarea>
      </div>

      <p>Now sort what belongs where. Any column can stay blank â€” use what helps.</p>

      <div class="traffic-grid">
        <div class="bucket green">
          <h3>ðŸŸ¢ Clarity &amp; My Part</h3>
          <small>What's factual and within my responsibility?</small>
          <textarea id="trueGrounded" placeholder="What is true? What's mine to do?" rows="5"></textarea>
        </div>
        <div class="bucket yellow">
          <h3>ðŸŸ¡ Not Mine / Unsure</h3>
          <small>What isn't mine to carry, or I'm unsure about?</small>
          <textarea id="notMine" placeholder="Release or park these for later." rows="5"></textarea>
        </div>
        <div class="bucket red">
          <h3>ðŸ”´ Fear-Driven</h3>
          <small>Assumptions, worst-case stories, distortions.</small>
          <textarea id="fearDriven" placeholder="What's fueled by fear or pressure?" rows="5"></textarea>
        </div>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Cross out any words that feel like panic or manipulation. Keep what remains true and yours.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" id="saveNoiseStep" onclick="nextStep()" disabled>Save & Continue</button>
      </div>
      <div class="micro">Clarity often starts by removing what doesn't belong.</div>
      <div class="branding">Â© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 2: Zoom Out -->
    <section class="step" data-step="2">
      <div class="step-indicator">
        <div class="step-counter">Step 3 of 5 â€” Zoom Out</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <h2>Zoom Out</h2>
      <p class="lead">Widen your perspective to reduce tunnel vision and pressure.</p>

      <div class="form-group">
        <label for="zoomReframe">How does this look from higher up â€” 3 weeks, 3 months, 3 years from now?</label>
        <textarea id="zoomReframe" placeholder="From a wider view, what matters most? What fades?"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Take 3 slow breaths. Imagine looking at this situation from above, like you're viewing a map.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Spot the Pattern</button>
      </div>
      <div class="micro">Context calms urgency.</div>
      <div class="branding">Â© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 3: Spot the Pattern -->
    <section class="step" data-step="3">
      <div class="step-indicator">
        <div class="step-counter">Step 4 of 5 â€” Spot the Pattern</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div><div class="dot"></div></div>
      </div>
      <h2>Spot the Pattern</h2>
      <p class="lead">Recognize recurring narratives so you can respond differently.</p>

      <div class="form-group">
        <label for="patternSeen">Where have you seen this loop before? What usually follows?</label>
        <textarea id="patternSeen" placeholder="A personal pattern, a media story, a family scriptâ€¦"></textarea>
      </div>

      <div class="form-group">
        <label for="patternResponse">What response would break the pattern this time?</label>
        <textarea id="patternResponse" placeholder="One tiny step or choice that changes the usual outcomeâ€¦"></textarea>
      </div>

      <div class="tip"><strong>Micro-practice:</strong> Name the pattern out loud (e.g., "catastrophizing," "people-pleasing"). Naming it reduces its grip.</div>

      <div class="nav-row">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Complete</button>
      </div>
      <div class="micro">Awareness opens new options.</div>
      <div class="branding">Â© 2025 Clarity Metabolics | claritymetabolics.com</div>
    </section>

    <!-- STEP 4: Summary -->
    <section class="step" data-step="4">
      <div class="step-indicator">
        <div class="step-counter">Step 5 of 5 â€” Summary</div>
        <div class="dots"><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot done"></div><div class="dot active"></div></div>
      </div>
      <h2>Your Clarity Lens Summary</h2>
      <p>You practiced filtering for truth, widening perspective, and naming patterns.</p>

      <div style="background:var(--accent-color);padding:16px;border-radius:10px;margin:12px 0">
        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color)">Filter the Noise</h3>
        <p id="sumNoise">â€”</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">Zoom Out</h3>
        <p id="sumZoom">â€”</p>

        <h3 style="font-family:'Libre Baskerville',serif;color:var(--contrast-color);margin-top:10px">Spot the Pattern</h3>
        <p id="sumPattern">â€”</p>
      </div>

      <!-- FINAL ACTIONS (stacked) -->
      <div class="final-actions" id="finalActions">
        <button class="btn btn-primary" onclick="downloadSummary()">ðŸ“„ Download Summary</button>
        <button class="btn btn-secondary" onclick="openSacred()">âœ¨ Sacred Reflection</button>
        <button class="btn btn-secondary" id="startOverBtn" onclick="confirmStartOver()">ðŸ”„ Start Over</button>
      </div>

      <!-- NEXT PHASE: Emotional Anchor lead-in -->
      <div class="next-phase" aria-label="Move to Emotional Anchor">
        <div class="lead"><strong>Your clarity is stronger now. Let's carry it into the way you feel.</strong></div>
        <button class="btn-next" onclick="goToEmotionalAnchor()">â†’ Begin the Emotional Anchor</button>
        <div class="sub">Discover how to steady your emotions when truth feels heavy.</div>
      </div>

      <div class="branding">
        <div><strong>Created by Clarity Metabolics</strong></div>
        <div style="font-style:italic;margin-top:4px">Quiet the world. Reconnect with what's real.</div>
        <div><a href="https://claritymetabolics.com" target="_blank">claritymetabolics.com</a></div>
      </div>

      <div class="nav-row" style="justify-content:center">
        <button class="btn btn-secondary" style="max-width:280px" onclick="prevStep()">Back</button>
      </div>
    </section>
  </main>
</div>

<!-- Sacred Reflection Modal -->
<div id="sacredModal" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000">
  <div style="background:var(--bg-color);color:var(--text-color);max-width:560px;width:100%;border-radius:12px;box-shadow:var(--shadow);padding:22px">
    <h3 style="font-family:'Libre Baskerville',serif;color:var(--main-color);margin-bottom:8px">Sacred Reflection</h3>
    <div class="scripture" style="margin:10px 0 16px 0">
      <p><strong>Father:</strong> Guide me toward Your truth and away from confusion.</p>
      <p><strong>Son:</strong> Thank You for showing me how to walk in clarity and grace.</p>
      <p><strong>Holy Spirit:</strong> Reveal what I could not see on my own.</p>
    </div>
    <div style="text-align:center">
      <button class="btn btn-primary" onclick="closeSacred()">Amen</button>
    </div>
  </div>
</div>

<script>
  // --- State
  let currentStep = 0;
  const totalSteps = 5;
  const responses = {
    thoughtInput:'',
    trueGrounded:'',  // green
    notMine:'',       // yellow
    fearDriven:'',    // red
    zoomReframe:'',
    patternSeen:'', patternResponse:''
  };

  // Dark / Light toggle (moon â†” sun)
  document.getElementById('themeBtn').addEventListener('click', () => {
    const body = document.body;
    const btn = document.getElementById('themeBtn');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme'); btn.textContent = 'ðŸŒ™';
    } else {
      body.setAttribute('data-theme','dark'); btn.textContent = 'â˜€ï¸';
    }
  });

  // Step navigation
  function showStep(i){
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    const stepEl = document.querySelector(`.step[data-step="${i}"]`);
    if (stepEl) stepEl.classList.add('active');

    // progress
    document.getElementById('progressFill').style.width = ((i)/ (totalSteps-1)) * 100 + '%';
    document.querySelectorAll('.step .dots').forEach(group => {
      [...group.children].forEach((d, idx) => {
        d.classList.remove('active','done');
        if (idx < i) d.classList.add('done');
        if (idx === i) d.classList.add('active');
      });
    });

    // scroll + focus
    requestAnimationFrame(()=>{
      document.getElementById('pageTop').scrollIntoView({behavior:'auto',block:'start'});
      setTimeout(()=>{
        if (i===1) document.getElementById('thoughtInput')?.focus();
        if (i===2) document.getElementById('zoomReframe')?.focus();
        if (i===3) document.getElementById('patternSeen')?.focus();
      },100);
    });

    if (i===4){ document.getElementById('mainHeader')?.classList.add('completed'); updateSummary(); }
  }

  function nextStep(){ saveCurrent(); if (currentStep < totalSteps-1){ currentStep++; showStep(currentStep); } }
  function prevStep(){ if (currentStep>0){ currentStep--; showStep(currentStep);} }

  // Save per-step
  function saveCurrent(){
    switch(currentStep){
      case 1:
        responses.thoughtInput = document.getElementById('thoughtInput').value.trim();
        responses.trueGrounded = document.getElementById('trueGrounded').value.trim();
        responses.notMine = document.getElementById('notMine').value.trim();
        responses.fearDriven = document.getElementById('fearDriven').value.trim();
        break;
      case 2:
        responses.zoomReframe = document.getElementById('zoomReframe').value.trim();
        break;
      case 3:
        responses.patternSeen = document.getElementById('patternSeen').value.trim();
        responses.patternResponse = document.getElementById('patternResponse').value.trim();
        break;
    }
  }

  // Summary
  function updateSummary(){
    const originalThought = responses.thoughtInput || 'â€”';
    const green = responses.trueGrounded || 'â€”';
    const yellow = responses.notMine || 'â€”';
    const red = responses.fearDriven || 'â€”';
    const zoom = responses.zoomReframe || 'â€”';
    const pattern = (responses.patternSeen || 'â€”') + (responses.patternResponse ? `  |  Response: ${responses.patternResponse}` : '');

    document.getElementById('sumNoise').innerHTML = `
      <strong>Original Thought:</strong> ${originalThought}<br>
      <strong>Clarity &amp; My Part (ðŸŸ¢):</strong> ${green}<br>
      <strong>Not Mine / Unsure (ðŸŸ¡):</strong> ${yellow}<br>
      <strong>Fear-Driven (ðŸ”´):</strong> ${red}
    `;
    document.getElementById('sumZoom').textContent = zoom;
    document.getElementById('sumPattern').textContent = pattern;
  }

  // Start Over confirm
  let startOverArmed = false;
  function confirmStartOver(){
    const btn = document.getElementById('startOverBtn');
    if (!startOverArmed){
      startOverArmed = true;
      btn.classList.remove('btn-secondary'); btn.classList.add('btn-warning');
      btn.textContent = 'Confirm Start Over';
      setTimeout(()=>{ if(startOverArmed){
        startOverArmed=false; btn.classList.remove('btn-warning'); btn.classList.add('btn-secondary'); btn.textContent='ðŸ”„ Start Over';
      }},3000);
    } else { restartTool(); }
  }

  function restartTool(){
    Object.keys(responses).forEach(k => responses[k] = '');
    document.querySelectorAll('textarea, input[type="text"]').forEach(t => t.value='');
    const btn = document.getElementById('startOverBtn');
    if (btn){ startOverArmed=false; btn.className='btn btn-secondary'; btn.textContent='ðŸ”„ Start Over'; }
    const saveBtn = document.getElementById('saveNoiseStep');
    if (saveBtn) saveBtn.disabled = true;
    currentStep = 0; showStep(currentStep);
  }

  // Download summary
  function downloadSummary(){
    const lines = [
      'Mental Anchor â€” The Clarity Lens (Session Summary)',
      'Generated: ' + new Date().toLocaleString(),
      '',
      'FILTER OUT THE NOISE:',
      'Original Thought: ' + (responses.thoughtInput || 'â€”'),
      'Clarity & My Part (ðŸŸ¢): ' + (responses.trueGrounded || 'â€”'),
      'Not Mine / Unsure (ðŸŸ¡): ' + (responses.notMine || 'â€”'),
      'Fear-Driven (ðŸ”´): ' + (responses.fearDriven || 'â€”'),
      '',
      'ZOOM OUT:',
      responses.zoomReframe || 'â€”',
      '',
      'SPOT THE PATTERN:',
      responses.patternSeen || 'â€”',
      responses.patternResponse ? ('Response: ' + responses.patternResponse) : '',
      '',
      'â€” Â© 2025 Clarity Metabolics | claritymetabolics.com'
    ].join('\n');

    const blob = new Blob([lines],{type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href=url; a.download='mental-anchor-clarity-lens-summary.txt';
    document.body.appendChild(a); a.click();
    document.body.removeChild(a); URL.revokeObjectURL(url);
  }

  // Sacred Reflection modal
  function openSacred(){ document.getElementById('sacredModal').style.display='flex'; }
  function closeSacred(){ document.getElementById('sacredModal').style.display='none'; }

  // Emotional Anchor link (update route when ready)
  function goToEmotionalAnchor(){
    window.location.href = "/emotional-anchor";
  }

  // Init + enable logic for Step 1 button
  function init(){ 
    showStep(0); 
    function checkFilterInputs() {
      const g = document.getElementById('trueGrounded')?.value.trim() || '';
      const y = document.getElementById('notMine')?.value.trim() || '';
      const r = document.getElementById('fearDriven')?.value.trim() || '';
      const saveBtn = document.getElementById('saveNoiseStep');
      if (saveBtn) saveBtn.disabled = !(g || y || r);
    }
    setTimeout(() => {
      ['trueGrounded','notMine','fearDriven'].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', checkFilterInputs);
      });
    }, 100);
  }
  if (document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
</script>
</body>
</html>
