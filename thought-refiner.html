<!DOCTYPE html><!--
Thought Refiner v1.0.0
Release Date: August 5, 2025
Author: Clarity Metabolics
Part of: Discernment Toolkit Series
Features: Multi-step thought processing, emotional regulation integration, truth discernment framework, auto-save, dark/light modes
-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thought Tracker | Discernment Toolkit by Clarity Metabolics</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
--main: #7A94A8;
--accent: #E7EEF1;
--contrast: #4A5A6A;
--bg-primary: #fff;
--bg-secondary: #E7EEF1;
--text-primary: #4A5A6A;
--text-secondary: #888;
}

[data-theme="dark"] {
--main: #9BB4C8;
--accent: #2A3441;
--contrast: #E8EDF2;
--bg-primary: #1A2028;
--bg-secondary: #2A3441;
--text-primary: #E8EDF2;
--text-secondary: #B0B8C0;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Open Sans', sans-serif;
background: var(--bg-secondary);
min-height: 100vh;
color: var(--text-primary);
line-height: 1.6;
transition: all 0.3s ease;
}

.container {
max-width: 650px;
margin: 0 auto;
padding: 20px;
min-height: 100vh;
display: flex;
flex-direction: column;
justify-content: center;
position: relative;
}

.theme-toggle {
position: fixed;
top: 20px;
right: 20px;
background: var(--main);
color: var(--bg-primary);
border: none;
border-radius: 50%;
width: 50px;
height: 50px;
font-size: 1.2rem;
cursor: pointer;
transition: all 0.3s ease;
z-index: 1000;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.theme-toggle:hover {
transform: scale(1.1);
background: var(--contrast);
}

.auto-save-notification {
position: fixed;
top: 80px;
right: 20px;
background: var(--main);
color: var(--bg-primary);
padding: 8px 16px;
border-radius: 20px;
font-size: 0.8rem;
opacity: 0;
transform: translateY(-10px);
transition: all 0.3s ease;
z-index: 999;
box-shadow: 0 4px 12px rgba(122, 148, 168, 0.3);
}

.auto-save-notification.show {
opacity: 1;
transform: translateY(0);
}

.card {
background: var(--bg-primary);
border-radius: 20px;
padding: 40px 35px;
box-shadow: 0 10px 30px rgba(74, 90, 106, 0.1);
text-align: center;
transition: all 0.3s ease;
border: 1px solid var(--accent);
}

.progress-bar {
width: 100%;
height: 6px;
background: var(--accent);
border-radius: 3px;
margin-bottom: 25px;
overflow: hidden;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, var(--main), var(--contrast));
border-radius: 3px;
transition: width 0.3s ease;
}

.progress-indicator {
text-align: center;
font-size: 0.9rem;
color: var(--text-secondary);
margin-bottom: 10px;
font-weight: 500;
}

.progress-dots {
display: flex;
justify-content: center;
gap: 8px;
margin-bottom: 20px;
}

.dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: var(--accent);
transition: all 0.3s ease;
position: relative;
}

.dot.active {
background: var(--main);
transform: scale(1.2);
}

.dot.completed {
background: #4CAF50;
transform: scale(1.1);
}

.dot.completed::after {
content: '✓';
position: absolute;
top: -2px;
left: 1px;
font-size: 10px;
color: white;
font-weight: bold;
}

.progress-note {
text-align: center;
font-size: 0.8rem;
color: var(--text-secondary);
font-style: italic;
margin-bottom: 15px;
}

.icon-header {
font-size: 3rem;
margin-bottom: 20px;
opacity: 0.8;
}

h1 {
font-family: 'Libre Baskerville', serif;
font-size: 2.2rem;
color: var(--text-primary);
margin-bottom: 15px;
line-height: 1.3;
}

.subtitle {
font-style: italic;
font-size: 1.1rem;
color: var(--main);
margin-bottom: 25px;
font-family: 'Libre Baskerville', serif;
font-weight: 500;
}

h2 {
font-family: 'Libre Baskerville', serif;
font-size: 1.8rem;
color: var(--text-primary);
margin-bottom: 20px;
}

.body-text {
font-size: 1.05rem;
color: var(--text-primary);
margin-bottom: 30px;
text-align: left;
line-height: 1.75;
}

.prompt {
font-size: 1.1rem;
margin-bottom: 20px;
color: var(--text-primary);
text-align: left;
font-weight: 600;
}

.input-group {
margin: 25px 0;
position: relative;
}

textarea {
width: 100%;
padding: 15px;
border: 2px solid var(--main);
border-radius: 12px;
font-size: 1rem;
font-family: 'Open Sans', sans-serif;
background: var(--bg-primary);
color: var(--text-primary);
transition: all 0.3s ease;
min-height: 80px;
resize: vertical;
font-size: 16px;
}

textarea:focus {
outline: none;
border-color: var(--main);
box-shadow: 0 0 0 2px rgba(122, 148, 168, 0.15);
}

.char-count {
text-align: right;
font-size: 0.8rem;
color: var(--text-secondary);
margin-top: 5px;
}

.encouragement {
background: rgba(122, 148, 168, 0.1);
color: var(--main);
padding: 8px 12px;
border-radius: 8px;
font-size: 0.9rem;
margin-top: 8px;
opacity: 0;
transform: translateY(-5px);
transition: all 0.3s ease;
font-style: italic;
}

.encouragement.show {
opacity: 1;
transform: translateY(0);
}

.typing-prompt {
color: var(--main);
font-size: 0.9rem;
font-style: italic;
margin-top: 8px;
opacity: 0;
transition: opacity 0.3s ease;
}

.typing-prompt.show {
opacity: 1;
}

.button {
background: var(--main);
color: var(--bg-primary);
border: none;
padding: 15px 30px;
border-radius: 25px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin: 10px;
min-width: 140px;
}

.button:hover:not(:disabled) {
background: var(--contrast);
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(122, 148, 168, 0.3);
}

.button:disabled {
background: var(--text-secondary);
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.button-group {
display: flex;
gap: 10px;
justify-content: center;
flex-wrap: wrap;
}

.button.secondary {
background: transparent;
color: var(--main);
border: 2px solid var(--main);
}

.button.secondary:hover:not(:disabled) {
background: var(--main);
color: var(--bg-primary);
}

.interlude-box {
background: linear-gradient(135deg, var(--accent) 0%, var(--bg-secondary) 100%);
border-left: 4px solid var(--main);
padding: 25px;
margin: 20px 0;
border-radius: 12px;
text-align: left;
}

.summary-box {
background: linear-gradient(135deg, rgba(122, 148, 168, 0.1) 0%, var(--accent) 100%);
border-left: 4px solid var(--main);
padding: 25px;
margin: 20px 0;
border-radius: 12px;
text-align: left;
}

.action-buttons {
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 15px;
margin-top: 30px;
}

.action-buttons button {
background: var(--main);
color: var(--bg-primary);
border: none;
padding: 12px 20px;
border-radius: 20px;
font-size: 0.9rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
min-width: 140px;
}

.action-buttons button:hover:not(:disabled) {
background: var(--contrast);
transform: translateY(-2px);
}

.action-buttons button:disabled {
background: var(--text-secondary);
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.question {
opacity: 1;
transition: opacity 0.3s ease-in-out;
}

.fade-out { 
opacity: 0; 
}

.fade-in {
opacity: 0;
animation: fadeIn 0.4s ease-in-out forwards;
}

@keyframes fadeIn {
to { opacity: 1; }
}

.hidden {
display: none !important;
visibility: hidden !important;
opacity: 0 !important;
}

.modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(20, 20, 20, 0.6);
display: none;
align-items: center;
justify-content: center;
z-index: 1000;
overflow-y: auto;
padding: 20px;
}

.modal:not(.hidden) {
display: flex;
}

.modal-content {
background-color: var(--bg-primary);
padding: 2rem;
border-radius: 15px;
max-width: 500px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
color: var(--text-primary);
box-shadow: 0 8px 20px rgba(0,0,0,0.2);
position: relative;
text-align: center;
animation: fadeInModal 0.3s ease-out forwards;
border: 2px solid var(--accent);
margin: auto;
}

.modal-content .body-text {
text-align: left;
line-height: 1.75;
}

.modal-content button {
background: var(--main);
color: var(--bg-primary);
border: none;
padding: 12px 24px;
border-radius: 20px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin-top: 20px;
}

.modal-content button:hover {
background: var(--contrast);
transform: translateY(-2px);
}

.close-btn {
position: absolute;
top: 0.7rem;
right: 1rem;
font-size: 1.5rem;
cursor: pointer;
color: var(--text-primary);
}

@keyframes fadeInModal {
from {
transform: scale(0.9);
opacity: 0;
}
to {
transform: scale(1);
opacity: 1;
}
}

@media (max-width: 768px) {
.container {
padding: 15px;
margin: 1rem;
}

.card {
padding: 25px 20px;
}

.theme-toggle {
top: 15px;
right: 15px;
width: 45px;
height: 45px;
font-size: 1.1rem;
}

h1 {
font-size: 1.8rem;
}

.icon-header {
font-size: 1.6rem;
margin-bottom: 0.4em;
}

textarea {
padding: 0.8rem;
resize: none;
}

.action-buttons {
flex-direction: column;
align-items: center;
}

.action-buttons button {
width: 100%;
max-width: 300px;
}

.button-group {
flex-direction: column;
align-items: center;
}

.button-group .button {
width: 100%;
max-width: 300px;
}
}
</style>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">🌙</button>
<div class="auto-save-notification" id="autoSaveNotification">Progress saved ✓</div>

<div class="container">
<!-- Intro Screen -->
<div id="intro-screen" class="card">
<div class="progress-indicator">Step 1 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 0%"></div>
</div>
<div class="progress-dots">
<div class="dot active"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
</div>
<div class="progress-note">Your progress is automatically saved as you type</div>

<div class="icon-header">🧠</div>
<h1>Thought Tracker</h1>
<p class="subtitle">Not every thought deserves your attention. Let's sort the signal from the noise.</p>

<div class="body-text">
Your mind processes thousands of thoughts daily. Some are helpful invitations to truth, others are distractions or lies masquerading as wisdom. This tool helps you discern which thoughts deserve your energy and which ones to release.
</div>

<p style="font-style: italic; color: var(--main); font-weight: 500;">What thought has been demanding your attention lately?</p>

<button class="button" onclick="nextStep('step1')">Start Tracking</button>
</div>

<!-- Step 1: Capture the Thought -->
<div id="step1" class="card hidden">
<div class="progress-indicator">Step 2 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 14%"></div>
</div>
<div class="progress-dots">
<div class="dot"></div>
<div class="dot active"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
</div>

<h2>📝 Capture the Thought</h2>
<p class="prompt">What specific thought or mental pattern has been circling in your mind?</p>

<div class="input-group">
<textarea id="thought-input" placeholder="Write the exact thought or worry as it appears in your mind..." 
aria-label="Describe the specific thought you want to examine"
oninput="updateCharCount(this, 'count1'); showEncouragement(this, 'enc1')"
onkeydown="handleKeyPress(event, 1)"></textarea>
<div class="char-count" id="count1">0 characters</div>
<div class="encouragement" id="enc1">Good. Getting it out of your head and onto the page is the first step to clarity.</div>
<div class="typing-prompt" id="prompt1">Don't edit it yet. Just capture it exactly as it shows up in your mind.</div>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('intro-screen')" id="back1">← Back</button>
<button class="button" onclick="nextStep('step2')" id="next1" disabled>Next</button>
</div>
</div>

<!-- Step 2: When does it show up? -->
<div id="step2" class="card hidden">
<div class="progress-indicator">Step 3 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 29%"></div>
</div>
<div class="progress-dots">
<div class="dot"></div>
<div class="dot"></div>
<div class="dot active"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
</div>

<h2>⏰ When does it show up?</h2>
<p class="prompt">What situations, times, or triggers tend to activate this thought pattern?</p>

<div class="input-group">
<textarea id="trigger-input" placeholder="When do you notice this thought appearing? What seems to trigger it?" 
aria-label="Describe when and how this thought typically appears"
oninput="updateCharCount(this, 'count2'); showEncouragement(this, 'enc2')"
onkeydown="handleKeyPress(event, 2)"></textarea>
<div class="char-count" id="count2">0 characters</div>
<div class="encouragement" id="enc2">Patterns often reveal themselves when we pay attention to timing and context.</div>
<div class="typing-prompt" id="prompt2">Notice the patterns. When is your mind most vulnerable to this thought?</div>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('step1')" id="back2">← Back</button>
<button class="button" onclick="nextStep('step3')" id="next2" disabled>Next</button>
</div>
</div>

<!-- Step 3: What does it promise? -->
<div id="step3" class="card hidden">
<div class="progress-indicator">Step 4 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 43%"></div>
</div>
<div class="progress-dots">
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot active"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
</div>

<h2>🎁 What does it promise?</h2>
<p class="prompt">What does this thought claim it will do for you? What problem does it promise to solve?</p>

<div class="input-group">
<textarea id="promise-input" placeholder="What benefit or protection does this thought claim to offer?" 
aria-label="Describe what this thought promises or claims to provide"
oninput="updateCharCount(this, 'count3'); showEncouragement(this, 'enc3')"
onkeydown="handleKeyPress(event, 3)"></textarea>
<div class="char-count" id="count3">0 characters</div>
<div class="encouragement" id="enc3">Even destructive thoughts often masquerade as helpers. What's this one's disguise?</div>
<div class="typing-prompt" id="prompt3">Look beneath the surface. What is this thought trying to convince you it's doing for you?</div>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('step2')" id="back3">← Back</button>
<button class="button" onclick="nextStep('step4')" id="next3" disabled>Next</button>
</div>
</div>

<!-- Step 4: What does it actually deliver? -->
<div id="step4" class="card hidden">
<div class="progress-indicator">Step 5 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 57%"></div>
</div>
<div class="progress-dots">
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot active"></div>
<div class="dot"></div>
<div class="dot"></div>
</div>

<h2>📦 What does it actually deliver?</h2>
<p class="prompt">When you follow this thought, what do you actually experience? How do you feel afterward?</p>

<div class="input-group">
<textarea id="reality-input" placeholder="What's the real outcome when you engage with this thought?" 
aria-label="Describe the actual results of engaging with this thought"
oninput="updateCharCount(this, 'count4'); showEncouragement(this, 'enc4')"
onkeydown="handleKeyPress(event, 4)"></textarea>
<div class="char-count" id="count4">0 characters</div>
<div class="encouragement" id="enc4">Truth is found in the fruit. What has this thought actually produced in your life?</div>
<div class="typing-prompt" id="prompt4">Be honest about the gap between promise and reality.</div>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('step3')" id="back4">← Back</button>
<button class="button" onclick="nextStep('step5')" id="next4" disabled>Next</button>
</div>
</div>

<!-- Step 5: What's truer? -->
<div id="step5" class="card hidden">
<div class="progress-indicator">Step 6 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 71%"></div>
</div>
<div class="progress-dots">
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot active"></div>
<div class="dot"></div>
</div>

<h2>✨ What's truer?</h2>
<p class="prompt">What would a truer, kinder, more helpful thought sound like? What does wisdom whisper instead?</p>

<div class="input-group">
<textarea id="truth-input" placeholder="What's a more truthful or helpful way to think about this situation?" 
aria-label="Describe a truer or more helpful thought to replace the unhelpful one"
oninput="updateCharCount(this, 'count5'); showEncouragement(this, 'enc5')"
onkeydown="handleKeyPress(event, 5)"></textarea>
<div class="char-count" id="count5">0 characters</div>
<div class="encouragement" id="enc5">Truth doesn't need to shout. It can be gentle and still be powerful.</div>
<div class="typing-prompt" id="prompt5">What would love say instead of fear? What would wisdom say instead of worry?</div>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('step4')" id="back5">← Back</button>
<button class="button" onclick="nextStep('step6')" id="next5" disabled>Next</button>
</div>
</div>

<!-- Step 6: How will you redirect? -->
<div id="step6" class="card hidden">
<div class="progress-indicator">Step 7 of 7</div>
<div class="progress-bar">
<div class="progress-fill" style="width: 85%"></div>
</div>
<div class="progress-dots">
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot"></div>
<div class="dot active"></div>
</div>

<h2>🧭 How will you redirect?</h2>
<p class="prompt">When this thought shows up again, what's your plan? How will you redirect your attention?</p>

<div class="input-group">
<textarea id="redirect-input" placeholder="What will you do next time this thought appears?" 
aria-label="Describe your strategy for redirecting this thought pattern"
oninput="updateCharCount(this, 'count6'); showEncouragement(this, 'enc6')"
onkeydown="handleKeyPress(event, 6)"></textarea>
<div class="char-count" id="count6">0 characters</div>
<div class="encouragement" id="enc6">Having a plan makes all the difference. You're not at the mercy of every thought.</div>
<div class="typing-prompt" id="prompt6">Simple works. What's one concrete thing you can do when this thought returns?</div>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('step5')" id="back6">← Back</button>
<button class="button" onclick="nextStep('breathing-pause')" id="next6" disabled>Complete</button>
</div>
</div>

<!-- Breathing Pause -->
<div id="breathing-pause" class="card hidden">
<div class="progress-bar">
<div class="progress-fill" style="width: 95%"></div>
</div>

<div class="icon-header">🌬️</div>
<h2>Take a Breath</h2>

<div class="body-text">
You've done important work examining your thought patterns. Before we continue to your reflection, take a moment to breathe and let this new awareness settle.
</div>

<div class="interlude-box">
<p style="text-align: center; font-style: italic;">
"Finally, brothers and sisters, whatever is true, whatever is noble, whatever is right, whatever is pure, whatever is lovely, whatever is admirable—if anything is excellent or praiseworthy—think about such things." <br>
<span style="font-size: 0.9rem; opacity: 0.8;">- Philippians 4:8</span>
</p>
</div>

<div class="button-group">
<button class="button secondary" onclick="previousStep('step6')">← Back</button>
<button class="button" onclick="nextStep('final')">Continue to Reflection</button>
</div>
</div>

<!-- Final Summary -->
<div id="final" class="card hidden">
<div class="progress-bar">
<div class="progress-fill" style="width: 100%"></div>
</div>

<div class="icon-header">🌿</div>
<h2>Thought Pattern Mapped</h2>

<div class="body-text">Below is a map of the thought pattern you've examined. Save or print if you wish — but more importantly, notice what feels clearer now.</div>

<div class="summary-box" id="personalized-summary">
<!-- Personalized summary will be populated -->
</div>

<div class="action-buttons">
<button onclick="downloadResults()" aria-label="Download your reflection as a text file">Download .txt</button>
<button onclick="printResults()" aria-label="Print or save your reflection">Save/Print</button>
<button onclick="showTrinityModal()" aria-label="Let the Trinity speak into this">✨ Trinity Speaks</button>
<button onclick="resetTool()" aria-label="Clear all responses and start over">Start Over</button>
</div>
</div>

</div>

<!-- Trinity Modal -->
<div id="trinityModal" class="modal hidden">
<div class="modal-content">
<span class="close-btn" onclick="closeTrinityModal()">&times;</span>
<h2>✨ Let the Trinity Speak Into This</h2>
<div class="body-text">
<p>The <strong>Father</strong> knows every thought before you think it and loves you regardless. The <strong>Son</strong> takes captive every thought to make it obedient to Christ. The <strong>Spirit</strong> guides you into all truth and renews your mind.</p>
<br>
<p>You are not at the mercy of every thought that crosses your mind. You have divine help in choosing which thoughts deserve your attention.</p>
<br>
<blockquote style="font-style: italic; color: var(--main); border-left: 3px solid var(--main); padding-left: 15px; margin: 20px 0;">
"We demolish arguments and every pretension that sets itself up against the knowledge of God, and we take captive every thought to make it obedient to Christ." <br>
<span style="font-size: 0.9rem; opacity: 0.8;">- 2 Corinthians 10:5</span>
</blockquote>
<blockquote style="font-style: italic; color: var(--main); border-left: 3px solid var(--main); padding-left: 15px; margin: 20px 0;">
"Do not conform to the pattern of this world, but be transformed by the renewing of your mind." <br>
<span style="font-size: 0.9rem; opacity: 0.8;">- Romans 12:2</span>
</blockquote>
<br>
<p style="font-style: italic; text-align: center;">Take a moment to pray: "Father, You know every thought before it forms. Help me distinguish between thoughts that come from You and those that don't. Give me wisdom to choose what deserves my attention. Amen."</p>
</div>
<button onclick="closeTrinityModal()">Amen</button>
</div>
</div>

<script>
let userResponses = {
thought: '',
trigger: '',
promise: '',
reality: '',
truth: '',
redirect: ''
};

let typingTimers = {};
let completedSteps = [];

function showAutoSaveNotification() {
const notification = document.getElementById('autoSaveNotification');
notification.classList.add('show');
setTimeout(() => {
notification.classList.remove('show');
}, 2000);
}

function toggleTheme() {
const html = document.documentElement;
const themeToggle = document.querySelector('.theme-toggle');

if (html.getAttribute('data-theme') === 'dark') {
html.removeAttribute('data-theme');
themeToggle.textContent = '🌙';
themeToggle.setAttribute('aria-label', 'Toggle dark mode');
} else {
html.setAttribute('data-theme', 'dark');
themeToggle.textContent = '☀️';
themeToggle.setAttribute('aria-label', 'Toggle light mode');
}
}

function handleKeyPress(event, step) {
if (event.key === 'Enter' && event.ctrlKey) {
const nextButton = document.getElementById(`next${step}`);
if (nextButton && !nextButton.disabled) {
event.preventDefault();
nextButton.click();
}
}

const promptId = `prompt${step}`;
const promptElement = document.getElementById(promptId);
if (promptElement) {
clearTimeout(typingTimers[promptId]);
promptElement.classList.remove('show');

typingTimers[promptId] = setTimeout(() => {
if (document.activeElement.id === event.target.id) {
promptElement.classList.add('show');
}
}, 10000);
}
}

function updateCharCount(textarea, countId) {
const count = textarea.value.length;
const countElement = document.getElementById(countId);
if (countElement) {
countElement.textContent = `${count} characters`;
}

const stepNum = countId.replace('count', '');
const nextButton = document.getElementById(`next${stepNum}`);
if (nextButton) {
nextButton.disabled = count < 1;
}

if (count > 0) {
showAutoSaveNotification();
}
}

function showEncouragement(textarea, encId) {
const encouragement = document.getElementById(encId);
if (encouragement) {
if (textarea.value.length > 20) {
encouragement.classList.add('show');
} else {
encouragement.classList.remove('show');
}
}
}

function saveCurrentStep() {
const thoughtInput = document.getElementById('thought-input');
if (thoughtInput) userResponses.thought = thoughtInput.value;

const triggerInput = document.getElementById('trigger-input');
if (triggerInput) userResponses.trigger = triggerInput.value;

const promiseInput = document.getElementById('promise-input');
if (promiseInput) userResponses.promise = promiseInput.value;

const realityInput = document.getElementById('reality-input');
if (realityInput) userResponses.reality = realityInput.value;

const truthInput = document.getElementById('truth-input');
if (truthInput) userResponses.truth = truthInput.value;

const redirectInput = document.getElementById('redirect-input');
if (redirectInput) userResponses.redirect = redirectInput.value;
}

function nextStep(stepId) {
saveCurrentStep();
markStepCompleted();

if (stepId === 'final') {
populatePersonalizedSummary();
}

const currentStep = document.querySelector('.card:not(.hidden)');
if (currentStep) {
currentStep.classList.add('fade-out');
setTimeout(() => {
currentStep.classList.add('hidden');
currentStep.classList.remove('fade-out');
}, 300);
}

setTimeout(() => {
const nextStepElement = document.getElementById(stepId);
nextStepElement.classList.remove('hidden');
nextStepElement.classList.add('fade-in');

const textarea = nextStepElement.querySelector('textarea');
if (textarea) {
textarea.focus();
}
}, 400);
}

function previousStep(stepId) {
saveCurrentStep();

const currentStep = document.querySelector('.card:not(.hidden)');
if (currentStep) {
currentStep.classList.add('fade-out');
setTimeout(() => {
currentStep.classList.add('hidden');
currentStep.classList.remove('fade-out');
}, 300);
}

setTimeout(() => {
const prevStepElement = document.getElementById(stepId);
prevStepElement.classList.remove('hidden');
prevStepElement.classList.add('fade-in');
}, 400);
}

function markStepCompleted() {
const currentStep = document.querySelector('.card:not(.hidden)');
if (currentStep) {
const stepId = currentStep.id;
const stepNumber = getStepNumber(stepId);
if (stepNumber && !completedSteps.includes(stepNumber)) {
completedSteps.push(stepNumber);
updateProgressDots();
}
}
}

function getStepNumber(stepId) {
const stepMap = {
'intro-screen': 1,
'step1': 2,
'step2': 3,
'step3': 4,
'step4': 5,
'step5': 6,
'step6': 7
};
return stepMap[stepId];
}

function updateProgressDots() {
document.querySelectorAll('.dot').forEach((dot, index) => {
const stepNumber = index + 1;
if (completedSteps.includes(stepNumber)) {
dot.classList.add('completed');
dot.classList.remove('active');
}
});
}

function populatePersonalizedSummary() {
const summaryBox = document.getElementById('personalized-summary');

summaryBox.innerHTML = `
<h3 style="color: var(--contrast); margin-bottom: 15px;">Your Thought Pattern Analysis</h3>
<p><strong>The thought:</strong> ${userResponses.thought || 'Not specified'}</p>
<br>
<p><strong>When it shows up:</strong> ${userResponses.trigger || 'Not specified'}</p>
<br>
<p><strong>What it promises:</strong> ${userResponses.promise || 'Not specified'}</p>
<br>
<p><strong>What it actually delivers:</strong> ${userResponses.reality || 'Not specified'}</p>
<br>
<p><strong>What's truer:</strong> ${userResponses.truth || 'Not specified'}</p>
<br>
<p><strong>Your redirect plan:</strong> ${userResponses.redirect || 'Not specified'}</p>
<br>
<p style="font-style: italic; color: var(--main);">You now have a map of this thought pattern and a plan for redirecting it. That's real progress toward mental freedom.</p>
`;
}

function showTrinityModal() {
const modal = document.getElementById('trinityModal');
modal.classList.remove('hidden');
document.body.style.overflow = 'hidden';
document.body.style.position = 'fixed';
document.body.style.width = '100%';
}

function closeTrinityModal() {
const modal = document.getElementById('trinityModal');
modal.classList.add('hidden');
document.body.style.overflow = 'auto';
document.body.style.position = 'static';
document.body.style.width = 'auto';
}

function downloadResults() {
const content = `THOUGHT PATTERN ANALYSIS
========================

The thought:
${userResponses.thought || 'Not specified'}

When it shows up:
${userResponses.trigger || 'Not specified'}

What it promises:
${userResponses.promise || 'Not specified'}

What it actually delivers:
${userResponses.reality || 'Not specified'}

What's truer:
${userResponses.truth || 'Not specified'}

Your redirect plan:
${userResponses.redirect || 'Not specified'}

---

The Father knows every thought before you think it and loves you regardless.
The Son takes captive every thought to make it obedient to Christ.
The Spirit guides you into all truth and renews your mind.

You are not at the mercy of every thought that crosses your mind.
You have divine help in choosing which thoughts deserve your attention.

-- Clarity Metabolics

Date: ${new Date().toLocaleDateString()}`;

const blob = new Blob([content], { type: 'text/plain' });
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'thought-pattern-analysis.txt';
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
window.URL.revokeObjectURL(url);
}

function printResults() {
try {
const button = event.target;
const originalText = button.textContent;
button.textContent = 'Opening print...';
button.disabled = true;

setTimeout(() => {
window.print();
setTimeout(() => {
button.textContent = originalText;
button.disabled = false;
}, 500);
}, 200);
} catch (error) {
console.error('Print error:', error);
const button = event.target;
button.textContent = 'Save/Print';
button.disabled = false;
alert('Print function encountered an error. Please use the Download .txt option instead.');
}
}

function resetTool() {
if (!resetTool.firstClick) {
resetTool.firstClick = true;
const button = event.target;
const originalText = button.textContent;
button.textContent = 'Click Again to Confirm';
button.style.background = '#d73027';

setTimeout(() => {
resetTool.firstClick = false;
button.textContent = originalText;
button.style.background = '';
}, 3000);
return;
}

resetTool.firstClick = false;
const button = event.target;
button.textContent = 'Start Over';
button.style.background = '';

userResponses = {
thought: '',
trigger: '',
promise: '',
reality: '',
truth: '',
redirect: ''
};

completedSteps = [];

document.querySelectorAll('input[type="text"], textarea').forEach(input => input.value = '');
document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
document.querySelectorAll('.show').forEach(el => el.classList.remove('show'));

document.querySelectorAll('.char-count').forEach(el => el.textContent = '0 characters');
document.querySelectorAll('button[id^="next"]').forEach(btn => btn.disabled = true);

document.querySelectorAll('.dot').forEach(dot => {
dot.classList.remove('completed', 'active');
});
document.querySelector('.dot').classList.add('active');

const personalizedSummary = document.getElementById('personalized-summary');
if (personalizedSummary) personalizedSummary.innerHTML = '';

document.querySelectorAll('.card').forEach(card => {
card.classList.add('hidden');
card.classList.remove('fade-in', 'fade-out');
});

const introScreen = document.getElementById('intro-screen');
if (introScreen) {
introScreen.classList.remove('hidden');
}
}

document.addEventListener('click', function(event) {
const trinityModal = document.getElementById('trinityModal');
if (event.target === trinityModal) {
closeTrinityModal();
}
});

document.addEventListener('keydown', function(event) {
if (event.key === 'Escape') {
const trinityModal = document.getElementById('trinityModal');
if (!trinityModal.classList.contains('hidden')) {
closeTrinityModal();
}
}
});
</script>
</body>
</html>
