<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Thought Refiner - Interactive Discernment Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            font-weight: 300;
            line-height: 1.6;
            background: linear-gradient(135deg, #F1EFE9 0%, #A89E90 100%);
            min-height: 100vh;
            color: #5C5649;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .screen {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 10px 30px rgba(92, 86, 73, 0.1);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(168, 158, 144, 0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .screen.active {
            opacity: 1;
            transform: translateY(0);
        }

        .icon {
            font-size: 3em;
            margin-bottom: 20px;
            display: block;
        }

        h1 {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.8em;
            margin-bottom: 15px;
            color: #5C5649;
            font-weight: 400;
        }

        .prompt {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #5C5649;
            line-height: 1.7;
        }

        .save-notice {
            background: rgba(168, 158, 144, 0.1);
            border: 1px solid #A89E90;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #5C5649;
            text-align: center;
            font-style: italic;
        }

        .thought-input {
            width: 100%;
            min-height: 80px;
            padding: 20px;
            border: 2px solid #F1EFE9;
            border-radius: 12px;
            font-family: 'Open Sans', sans-serif;
            font-size: 1.1em;
            color: #5C5649;
            background: rgba(241, 239, 233, 0.3);
            resize: vertical;
            margin-bottom: 20px;
        }

        .thought-input:focus {
            outline: none;
            border-color: #A89E90;
            background: rgba(241, 239, 233, 0.5);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .option {
            background: #F1EFE9;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            color: #5C5649;
            text-align: left;
        }

        .option:hover {
            border-color: #A89E90;
            background: rgba(168, 158, 144, 0.1);
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: #A89E90;
            background: rgba(168, 158, 144, 0.2);
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #A89E90;
        }

        .journal-box {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 2px solid #F1EFE9;
            border-radius: 12px;
            font-family: 'Open Sans', sans-serif;
            font-size: 1em;
            color: #5C5649;
            background: rgba(241, 239, 233, 0.3);
            resize: vertical;
            margin-bottom: 20px;
        }

        .journal-box:focus {
            outline: none;
            border-color: #A89E90;
            background: rgba(241, 239, 233, 0.5);
        }

        .prompt-list {
            background: rgba(241, 239, 233, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            text-align: left;
        }

        .prompt-list ul {
            margin-left: 20px;
        }

        .prompt-list li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .anchor-question {
            background: rgba(168, 158, 144, 0.1);
            border: 2px solid #A89E90;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-style: italic;
            font-weight: 500;
            color: #5C5649;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: #5C5649;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Open Sans', sans-serif;
            font-weight: 400;
        }

        .btn:hover {
            background: #A89E90;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #F1EFE9;
            color: #A89E90;
            cursor: not-allowed;
            transform: none;
        }

        .btn-accent {
            background: #F1EFE9;
            color: #5C5649;
            border: 2px solid #A89E90;
        }

        .btn-accent:hover {
            background: #A89E90;
            color: white;
        }

        .icon-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .icon-option {
            background: rgba(241, 239, 233, 0.5);
            border: 1px solid #F1EFE9;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
            user-select: none;
        }

        .icon-option:hover {
            background: rgba(168, 158, 144, 0.2);
            border-color: #A89E90;
            transform: translateY(-2px);
        }

        .icon-option.selected {
            background: rgba(168, 158, 144, 0.3);
            border-color: #A89E90;
        }

        .icon-option .emoji {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .footer-text {
            font-style: italic;
            font-size: 0.9em;
            color: #A89E90;
            margin-top: 20px;
            text-align: center;
        }

        .export-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(168, 158, 144, 0.2);
        }

        .btn-export {
            background: #A89E90;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Open Sans', sans-serif;
            margin-right: 10px;
        }

        .btn-export:hover {
            background: #5C5649;
            transform: translateY(-1px);
        }

        .learn-more {
            background: rgba(241, 239, 233, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #A89E90;
        }

        .learn-more a {
            color: #5C5649;
            text-decoration: none;
            font-weight: 500;
        }

        .learn-more a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .screen {
                padding: 30px 20px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Screen 1: What thought keeps looping? -->
        <div id="screen1" class="screen active" role="main">
            <span class="icon">🧠</span>
            <h1>What thought keeps returning?</h1>
            <p class="prompt">Is there a sentence that's been running in the background?<br><br>Something that stirs up frustration, sadness, fear — or keeps you distracted?</p>
            <div class="save-notice">
                Your progress is saved in this browser. You can return later and pick up where you left off.
            </div>
            <textarea class="thought-input" id="thoughtInput" placeholder="No one listens to me." aria-label="Enter your recurring thought"></textarea>
            <button class="btn" id="continueBtn1" aria-label="Put this thought to the test">Put it to the test →</button>
        </div>

        <!-- Screen 2: Where did this thought come from? -->
        <div id="screen2" class="screen" style="display: none;" role="main">
            <span class="icon">🌱</span>
            <h1>What's this thought rooted in?</h1>
            <p class="prompt">Choose all that feel true.</p>
            <div class="options" role="group" aria-label="Select the roots of this thought (multiple selections allowed)">
                <div class="checkbox-option">
                    <input type="checkbox" id="recent" value="recent" aria-describedby="recent-label">
                    <label for="recent" id="recent-label">Something I saw or heard recently</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="past" value="past" aria-describedby="past-label">
                    <label for="past" id="past-label">Something from my past</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="story" value="story" aria-describedby="story-label">
                    <label for="story" id="story-label">A story someone told me</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="fear" value="fear" aria-describedby="fear-label">
                    <label for="fear" id="fear-label">A fear I haven't spoken aloud</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="emotion" value="emotion" aria-describedby="emotion-label">
                    <label for="emotion" id="emotion-label">An emotion that hasn't passed</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="belief" value="belief" aria-describedby="belief-label">
                    <label for="belief" id="belief-label">A belief I was taught (but never questioned)</label>
                </div>
            </div>
            <button class="btn" id="continueBtn2" aria-label="Continue to next step">Keep going →</button>
        </div>

        <!-- Screen 3: What happens when you believe this thought? -->
        <div id="screen3" class="screen" style="display: none;" role="main">
            <span class="icon">⚡</span>
            <h1>What happens when this thought takes over?</h1>
            <div class="prompt-list">
                <ul>
                    <li>How does it affect your body?</li>
                    <li>What emotions show up with it?</li>
                    <li>How do you treat others when you believe it?</li>
                    <li>How do you treat yourself?</li>
                    <li>What do you lose sight of?</li>
                </ul>
            </div>
            <textarea class="journal-box" id="effects" placeholder="When I believe this thought..." aria-label="Reflect on the effects of believing this thought"></textarea>
            <div class="anchor-question">
                "Does this thought bring you closer to peace — or further away?"
            </div>
            <button class="btn" id="continueBtn3" aria-label="Find what's more true">Let's find what's more true →</button>
        </div>

        <!-- Screen 4: Is there something deeper — or more true? -->
        <div id="screen4" class="screen" style="display: none;" role="main">
            <span class="icon">💎</span>
            <h1>If this thought isn't the whole truth… what might be?</h1>
            <p class="prompt">Use these nudges to go deeper.</p>
            <div class="options" role="group" aria-label="Explore deeper truths (multiple selections allowed)">
                <div class="checkbox-option">
                    <input type="checkbox" id="god" value="god" aria-describedby="god-label">
                    <label for="god" id="god-label">What might God say about this?</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="softer" value="softer" aria-describedby="softer-label">
                    <label for="softer" id="softer-label">Could there be a softer or more grounded version of this thought?</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="protect" value="protect" aria-describedby="protect-label">
                    <label for="protect" id="protect-label">What does this thought protect you from — or keep you tied to?</label>
                </div>
                <div class="checkbox-option">
                    <input type="checkbox" id="both" value="both" aria-describedby="both-label">
                    <label for="both" id="both-label">Can two things be true at once?</label>
                </div>
            </div>
            <p class="prompt">Rewrite the thought with more clarity or compassion:</p>
            <textarea class="journal-box" id="rewrite" placeholder='"No one listens to me" → "Some don't, but God hears me. And I can listen to myself, too."' aria-label="Rewrite your thought with more truth and compassion"></textarea>
            <button class="btn" id="continueBtn4" aria-label="Bring it to the light">Bring it to the Light →</button>
        </div>

        <!-- Screen 5: Truth lives in stillness -->
        <div id="screen5" class="screen" style="display: none;" role="main">
            <span class="icon">🕊️</span>
            <h1>Truth isn't loud. It's steady. It's safe.</h1>
            <p class="prompt">Let's bring this thought into the quiet — where clarity lives.<br><br>You don't have to believe everything perfectly.<br>Just be willing to ask for what's real.</p>
            
            <div class="icon-options" role="group" aria-label="Choose how to bring this to the light">
                <div class="icon-option" data-value="pray" tabindex="0" role="radio" aria-checked="false">
                    <span class="emoji">🙏</span>
                    <span>Ask God to show you what's true beneath the noise</span>
                </div>
                <div class="icon-option" data-value="imagine" tabindex="0" role="radio" aria-checked="false">
                    <span class="emoji">🕊️</span>
                    <span>Imagine placing this thought before the One who knows you fully — what do you sense in return?</span>
                </div>
                <div class="icon-option" data-value="write" tabindex="0" role="radio" aria-checked="false">
                    <span class="emoji">✍️</span>
                    <span>Write a prayer, or a sentence of truth you're willing to stand on</span>
                </div>
            </div>

            <div id="prayerSection" style="display: none;">
                <textarea class="journal-box" id="prayer" placeholder="God, if this isn't true, help me see what is. I want to walk in light — not illusion." aria-label="Write your prayer or truth statement"></textarea>
            </div>

            <div class="footer-text">
                You don't have to fix everything right now.<br>
                But you can walk forward with truth. One thought at a time.
            </div>

            <div class="export-section">
                <button class="btn-export" id="exportBtn" aria-label="Download your insights">Save these reflections</button>
                <button class="btn btn-accent" id="beginAgainBtn" aria-label="Begin again with a new thought">Begin Again</button>
            </div>

            <div class="learn-more">
                Want deeper truth? <a href="#" onclick="return false;">Explore how the Trinity reframes this thought</a>
            </div>
        </div>
    </div>

    <script>
        let selectedData = {
            thought: '',
            roots: [],
            effects: '',
            deeper: [],
            rewrite: '',
            lightChoice: '',
            prayer: ''
        };

        // Load saved progress from localStorage
        function loadProgress() {
            try {
                const saved = localStorage.getItem('thoughtRefinerProgress');
                if (saved) {
                    const data = JSON.parse(saved);
                    selectedData = { ...selectedData, ...data };
                    restoreUIState();
                }
            } catch (e) {
                console.log('No saved progress found');
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            try {
                localStorage.setItem('thoughtRefinerProgress', JSON.stringify(selectedData));
            } catch (e) {
                console.log('Unable to save progress');
            }
        }

        // Restore UI state from saved data
        function restoreUIState() {
            if (selectedData.thought) {
                document.getElementById('thoughtInput').value = selectedData.thought;
            }
        }

        // Clear saved progress
        function clearProgress() {
            try {
                localStorage.removeItem('thoughtRefinerProgress');
            } catch (e) {
                console.log('Unable to clear progress');
            }
        }

        // Screen 1 Logic
        document.getElementById('thoughtInput').addEventListener('input', function() {
            selectedData.thought = this.value.trim();
            saveProgress();
        });

        document.getElementById('continueBtn1').addEventListener('click', function() {
            const thought = document.getElementById('thoughtInput').value.trim();
            if (thought) {
                selectedData.thought = thought;
                saveProgress();
                showScreen('screen2');
            } else {
                // Gentle reminder to enter a thought
                document.getElementById('thoughtInput').focus();
                document.getElementById('thoughtInput').placeholder = 'Please enter a thought that keeps returning to you...';
            }
        });

        // Screen 2 Logic
        document.querySelectorAll('#screen2 input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                selectedData.roots = Array.from(document.querySelectorAll('#screen2 input[type="checkbox"]:checked'))
                    .map(cb => cb.value);
                saveProgress();
            });
        });

        document.getElementById('continueBtn2').addEventListener('click', function() {
            showScreen('screen3');
        });

        // Screen 3 Logic
        document.getElementById('effects').addEventListener('input', function() {
            selectedData.effects = this.value.trim();
            saveProgress();
        });

        document.getElementById('continueBtn3').addEventListener('click', function() {
            showScreen('screen4');
        });

        // Screen 4 Logic
        document.querySelectorAll('#screen4 input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                selectedData.deeper = Array.from(document.querySelectorAll('#screen4 input[type="checkbox"]:checked'))
                    .map(cb => cb.value);
                saveProgress();
            });
        });

        document.getElementById('rewrite').addEventListener('input', function() {
            selectedData.rewrite = this.value.trim();
            saveProgress();
        });

        document.getElementById('continueBtn4').addEventListener('click', function() {
            showScreen('screen5');
        });

        // Screen 5 Logic
        document.querySelectorAll('.icon-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.icon-option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.setAttribute('aria-checked', 'false');
                });
                this.classList.add('selected');
                this.setAttribute('aria-checked', 'true');
                selectedData.lightChoice = this.dataset.value;
                
                // Show prayer section and update placeholder based on choice
                const prayerSection = document.getElementById('prayerSection');
                const prayerBox = document.getElementById('prayer');
                
                prayerSection.style.display = 'block';
                
                // Update placeholder based on selection
                if (this.dataset.value === 'pray') {
                    prayerBox.placeholder = 'God, if this isn\'t true, help me see what is. I want to walk in light — not illusion.';
                } else if (this.dataset.value === 'imagine') {
                    prayerBox.placeholder = 'When I place this thought before God, I sense...';
                } else if (this.dataset.value === 'write') {
                    prayerBox.placeholder = 'The truth I\'m willing to stand on is...';
                }
                
                // Focus on the prayer box
                setTimeout(() => prayerBox.focus(), 300);
                
                saveProgress();
            });

            option.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });

        document.getElementById('prayer').addEventListener('input', function() {
            selectedData.prayer = this.value.trim();
            saveProgress();
        });

        // Export functionality
        document.getElementById('exportBtn').addEventListener('click', function() {
            const reflections = [];
            
            if (selectedData.thought) {
                reflections.push(`RECURRING THOUGHT:\n"${selectedData.thought}"\n`);
            }
            
            if (selectedData.roots && selectedData.roots.length > 0) {
                reflections.push(`ROOTS:\n${selectedData.roots.map(root => `• ${root}`).join('\n')}\n`);
            }
            
            if (selectedData.effects) {
                reflections.push(`EFFECTS:\n${selectedData.effects}\n`);
            }
            
            if (selectedData.rewrite) {
                reflections.push(`REWRITTEN WITH TRUTH:\n${selectedData.rewrite}\n`);
            }
            
            if (selectedData.prayer) {
                reflections.push(`PRAYER/TRUTH STATEMENT:\n${selectedData.prayer}\n`);
            }
            
            const content = reflections.join('\n') + '\n---\nGenerated by The Thought Refiner\nClarityMetabolics.com';
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `thought-refiner-reflections-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Begin Again functionality
        document.getElementById('beginAgainBtn').addEventListener('click', function() {
            selectedData = {
                thought: '',
                roots: [],
                effects: '',
                deeper: [],
                rewrite: '',
                lightChoice: '',
                prayer: ''
            };
            
            // Clear saved progress
            clearProgress();
            
            // Reset all forms
            document.getElementById('thoughtInput').value = '';
            document.getElementById('thoughtInput').placeholder = 'No one listens to me.';
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('textarea').forEach(ta => ta.value = '');
            document.querySelectorAll('.icon-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.setAttribute('aria-checked', 'false');
            });
            document.getElementById('prayerSection').style.display = 'none';
            
            showScreen('screen1');
        });

        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
                screen.classList.remove('active');
            });
            
            // Show target screen with animation
            const targetScreen = document.getElementById(screenId);
            targetScreen.style.display = 'block';
            
            // Force reflow before adding active class for animation
            targetScreen.offsetHeight;
            targetScreen.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Focus management for accessibility
            const firstFocusable = targetScreen.querySelector('button, [tabindex="0"], input, textarea');
            if (firstFocusable) {
                setTimeout(() => firstFocusable.focus(), 100);
            }
        }

        // Load progress when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
        });
    </script>
</body>
</html>
